<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µì¸ê²€ì‚¬ê¸°ê´€ ì•ˆì „ê´€ë¦¬ì‹œìŠ¤í…œ</title>
    
     <!-- ì•„ì´ì½˜ ì„¤ì • -->
<link rel="icon" type="image/png" href="kgt-logo-192.png">
<link rel="apple-touch-icon" href="kgt-logo-192.png">
<meta name="theme-color" content="#5B4FCF">
 
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=c8f5719a2be48f3875087006ce782934&libraries=services&autoload=false"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
   
    <style>
   
    <style>
        .scroll-x-auto { -webkit-overflow-scrolling: touch; }
        .table-cell-input { width: 100%; padding: 2px 4px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .no-cell { cursor: pointer; user-select: none; }
        .no-cell:hover { background-color: #dbeafe !important; }
        th { resize: horizontal; overflow: hidden; min-width: 50px; }
        td { overflow: hidden; text-overflow: ellipsis; }
       @media print {
                body * { visibility: hidden; }
                #certificatePrintArea, #certificatePrintArea * { 
                    visibility: visible !important; 
                }
                #certificatePrintArea {
                position: absolute;
                top: 12mm;
                left: 10mm;
                width: 190mm !important;
               min-height: 260mm !important;
                padding: 7mm 18mm 15mm 18mm
                margin: 0 !important;
                border: 3px solid #000 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                background: white !important;
            }
                .fixed.inset-0 { 
                    position: absolute; 
                    top: 0; 
                    left: 0; 
                    visibility: visible; 
                    padding: 0 !important; 
                    background: white !important; 
                }
                .fixed.inset-0 * { visibility: visible; }
                .fixed.inset-0 > div { 
                    width: 100% !important; 
                    height: 100vh !important; 
                    max-width: 100% !important; 
                    margin: 0 !important; 
                    padding: 0 !important; 
                    box-shadow: none !important; 
                    border-radius: 0 !important; 
                }
                #mapContainer { height: calc(100vh - 80px) !important; flex: 1 !important; }
                #mapLoadingBar { display: none !important; }
                .p-2.bg-gray-50 { padding: 2px !important; max-height: 50px !important; }
                .flex.gap-2.justify-end { display: none !important; }
                #mapFacilityOverlay { display: block !important; }
                .print\\:hidden { display: none !important; }
                @page { size: A4; margin: 0; }
            }
                  
                  @media print {
    body * {
        visibility: hidden;
    }
    #inspectionSheetPrintArea,
    #inspectionSheetPrintArea * { 
        visibility: visible !important; 
    }
    #inspectionSheetPrintArea { 
        position: absolute !important; 
        top: 0 !important; 
        left: 0 !important;
        width: 210mm !important;
        overflow: visible !important;
    }
    #inspectionSheetPrintArea .insp-page { 
        position: relative !important;
        width: 210mm !important; 
        height: 297mm !important; 
        padding: 2mm 10mm 8mm 10mm !important; 
        margin: 0 !important;
        overflow: visible !important;
        page-break-after: always !important;
        page-break-inside: avoid !important;
        -webkit-print-color-adjust: exact !important; 
        print-color-adjust: exact !important; 
    }
    #inspectionSheetPrintArea .insp-page:last-child { 
        page-break-after: avoid !important; 
    }
    .fixed.inset-0 {
        position: absolute !important;
        overflow: visible !important;
        height: auto !important;
    }
}
                        size: A4;
                        margin: 0;
                    }
                }   
                </style>
            </head>
            <body class="bg-gradient-to-b from-sky-400 to-sky-200 min-h-screen">
                <div id="app"></div>

                <script>
                    const GOOGLE_CONFIG = {
                        SPREADSHEET_ID: '1s_rI5f5rb65o0sDW7KMDGbPSuHc0jJ-mwlT-ZDZ3Imo',
                        WEB_APP_URL: 'https://script.google.com/macros/s/AKfycbyyJdTWamI83Bet-w07pGIWh26rn_4NrrW15Bi2HfsYxV62sQHxuSr8HcXf7LZ9SaxQ8Q/exec'
                    };

            const state = {
            currentYear: new Date().getFullYear(),
            activeTab: 'í†µí•©',
            selectedYear: new Date().getFullYear(),
            data: {},
            filteredData: [],
            applicationData: {},
            quarterData: {},
            cancellationData: {},
            pathwayData: {},
            resourceData: {}, 
            currentPage: 1,
            selectedRows: new Set(),
            isLoading: false,
            loadingProgress: 0,
            searchTerm: '',
            isEditing: false,
            showAdmin: false,
            adminPassword: '',
            showWelcome: true,
            lastSaved: null,
            showDownloadMenu: false,
            showAppDownloadMenu: false,
            uploadedFileName: '',
            showDuplicateModal: false,
            duplicateInfo: { duplicates: [], selectedData: [] },
            inspectionYear: new Date().getFullYear(),
            targetYear: new Date().getFullYear(),
            applicationFilters: {
                region: [], inspector: '', receiptLocation: '', inspectionResult: '',
                applicationDateFrom: '', applicationDateTo: '', inspectionDateFrom: '', inspectionDateTo: '',
                baseMonth: '', fee: '', facilityCert: '', certificateStatus: '', insuranceStatus: ''
            },
            applicationSearchTerm: '',
            selectedApplicationRows: new Set(),
            isEditingApplication: false,
            currentApplicationPage: 1,
            selectedQuarterRows: new Set(),
            isEditingQuarter: false,
            currentQuarterPage: 1,
            isEditingCancellation: false,
            selectedCancellationRows: new Set(),
            showDeleteModal: false,
            showAppDeleteModal: false,
            showDetailModal: false,
            detailModalData: {},
            detailModalSelectedIdx: null,
            showAppDetailModal: false,
            appDetailModalData: {},
            appDetailModalSelectedIdx: null,
            filters: { region: [], month: '', inspectionHistory: '' },
            showRegionDropdown: false,
            showMonthDropdown: false,
            showInspectionDropdown: false,
            settings: { companyName: 'ê³µì¸ê²€ì‚¬ê¸°ê´€', maxFileSize: 100, autoSave: true, autoSaveInterval: 30 },
            itemsPerPage: 50,
            inspectors: ['ìµœì¤‘ìˆ˜', 'ê¹€íƒì‹ ', 'ê¹€ì¶˜ì‹', 'ê¹€ì •ë§Œ'],
            receiptLocations: ['ì§€ë¡œ', 'êµ­ë¯¼', 'ë¶€ì‚°', 'ë†í˜‘', 'ê²½ë‚¨', 'í›„ë‚©', 'ê¸°íƒ€'],
            inspectionResults: ['í•©ê²©', 'ë¶ˆí•©ê²©', 'ì´ì¤‘ë‚©ë¶€','ê³µë€', 'ê¸°íƒ€'],
            yearRange: Array.from({ length: 37 }, (_, i) => 2014 + i),
            cancelReasons: ['ì…ê¸ˆ ë¯¸í™•ì¸', 'ê³ ê° ìš”ì²­', 'ì¤‘ë³µ ì‹ ì²­', 'ê¸°íƒ€'],
            showMapModal: false,
            mapData: [],
            isLoadingMap: false,
            mapLoadingProgress: 0,
            quarter: {
                selectedQuarter: 'Q1',
                selectedRecipient: '',
                quarters: ['1ë¶„ê¸°', '2ë¶„ê¸°', '3ë¶„ê¸°', '4ë¶„ê¸°'],
                recipients: {
                    'ë¶€ì‚°ì‹œì²­': ['ë¶€ì‚° ê°•ì„œêµ¬', 'ë¶€ì‚° ë‚¨êµ¬', 'ë¶€ì‚° ë™êµ¬', 'ë¶€ì‚° ë¶€ì‚°ì§„êµ¬', 'ë¶€ì‚° ì‚¬ìƒêµ¬', 'ë¶€ì‚° ì‚¬í•˜êµ¬', 'ë¶€ì‚° ì„œêµ¬', 'ë¶€ì‚° ìˆ˜ì˜êµ¬', 'ë¶€ì‚° ì˜ë„êµ¬', 'ë¶€ì‚° ì¤‘êµ¬', 'ë¶€ì‚° í•´ìš´ëŒ€êµ¬', 'ë¶€ì‚° ê¸ˆì •êµ¬', 'ë¶€ì‚° ê¸°ì¥êµ°', 'ë¶€ì‚° ë™ë˜êµ¬', 'ë¶€ì‚° ì—°ì œêµ¬', 'ë¶€ì‚° ë¶êµ¬'],
                    'ê°•ì„œêµ¬ì²­ì¥': ['ë¶€ì‚° ê°•ì„œêµ¬'], 'ë‚¨êµ¬ì²­ì¥': ['ë¶€ì‚° ë‚¨êµ¬'], 'ë™êµ¬ì²­ì¥': ['ë¶€ì‚° ë™êµ¬'],
                    'ë¶€ì‚°ì§„êµ¬ì²­ì¥': ['ë¶€ì‚° ë¶€ì‚°ì§„êµ¬'], 'ì‚¬ìƒêµ¬ì²­ì¥': ['ë¶€ì‚° ì‚¬ìƒêµ¬'], 'ì‚¬í•˜êµ¬ì²­ì¥': ['ë¶€ì‚° ì‚¬í•˜êµ¬'],
                    'ì„œêµ¬ì²­ì¥': ['ë¶€ì‚° ì„œêµ¬'], 'ìˆ˜ì˜êµ¬ì²­ì¥': ['ë¶€ì‚° ìˆ˜ì˜êµ¬'], 'ì˜ë„êµ¬ì²­ì¥': ['ë¶€ì‚° ì˜ë„êµ¬'],
                    'ì¤‘êµ¬ì²­ì¥': ['ë¶€ì‚° ì¤‘êµ¬'], 'í•´ìš´ëŒ€êµ¬ì²­ì¥': ['ë¶€ì‚° í•´ìš´ëŒ€êµ¬'], 'ê¸ˆì •êµ¬ì²­ì¥': ['ë¶€ì‚° ê¸ˆì •êµ¬'],
                    'ê¸°ì¥êµ°ìˆ˜': ['ë¶€ì‚° ê¸°ì¥êµ°'], 'ë™ë˜êµ¬ì²­ì¥': ['ë¶€ì‚° ë™ë˜êµ¬'], 'ì—°ì œêµ¬ì²­ì¥': ['ë¶€ì‚° ì—°ì œêµ¬'],
                    'ë¶êµ¬ì²­ì¥': ['ë¶€ì‚° ë¶êµ¬'], 'ìš¸ì‚°ê´‘ì—­ì‹œ ë¶êµ¬ì²­ì¥': ['ìš¸ì‚° ë¶êµ¬'],
                    'ê¹€í•´ì‹œì²­': ['ê²½ë‚¨ ê¹€í•´ì‹œ'], 'ì–‘ì‚°ì‹œì²­': ['ê²½ë‚¨ ì–‘ì‚°ì‹œ'], 'ì‚¬ì²œì‹œì²­': ['ê²½ë‚¨ ì‚¬ì²œì‹œ'],
                    'í†µì˜ì‹œì²­': ['ê²½ë‚¨ í†µì˜ì‹œ'], 'ê±°ì œì‹œì²­': ['ê²½ë‚¨ ê±°ì œì‹œ'], 'í¬í•­ì‹œì²­': ['ê²½ë¶ í¬í•­ì‹œ'],
                    'ê²½ì£¼ì‹œì²­': ['ê²½ë¶ ê²½ì£¼ì‹œ'], 'êµ¬ë¯¸ì‹œì²­': ['ê²½ë¶ êµ¬ë¯¸ì‹œ'],
                    'í•œêµ­ê°€ìŠ¤ì•ˆì „ê³µì‚¬ ë¶€ì‚°ì§€ì—­ë³¸ë¶€': ['ë¶€ì‚° ê°•ì„œêµ¬', 'ë¶€ì‚° ë‚¨êµ¬', 'ë¶€ì‚° ë™êµ¬', 'ë¶€ì‚° ë¶€ì‚°ì§„êµ¬', 'ë¶€ì‚° ì‚¬ìƒêµ¬', 'ë¶€ì‚° ì‚¬í•˜êµ¬', 'ë¶€ì‚° ì„œêµ¬', 'ë¶€ì‚° ìˆ˜ì˜êµ¬', 'ë¶€ì‚° ì˜ë„êµ¬', 'ë¶€ì‚° ì¤‘êµ¬'],
                    'í•œêµ­ê°€ìŠ¤ì•ˆì „ê³µì‚¬ ë¶ë¶€ì§€ì‚¬': ['ë¶€ì‚° í•´ìš´ëŒ€êµ¬', 'ë¶€ì‚° ê¸ˆì •êµ¬', 'ë¶€ì‚° ê¸°ì¥êµ°', 'ë¶€ì‚° ë™ë˜êµ¬', 'ë¶€ì‚° ì—°ì œêµ¬', 'ë¶€ì‚° ë¶êµ¬'],
                    'í•œêµ­ê°€ìŠ¤ì•ˆì „ê³µì‚¬ ìš¸ì‚°ì§€ì‚¬': ['ìš¸ì‚° ë¶êµ¬'],
                    'í•œêµ­ê°€ìŠ¤ì•ˆì „ê³µì‚¬ ì°½ì›ì§€ì‚¬': ['ê²½ë‚¨ ê¹€í•´ì‹œ', 'ê²½ë‚¨ ì–‘ì‚°ì‹œ', 'ê²½ë‚¨ í†µì˜ì‹œ', 'ê²½ë‚¨ ê±°ì œì‹œ'],
                    'í•œêµ­ê°€ìŠ¤ì•ˆì „ê³µì‚¬ ì§„ì£¼ì§€ì‚¬': ['ê²½ë‚¨ ì‚¬ì²œì‹œ'],
                    'í•œêµ­ê°€ìŠ¤ì•ˆì „ê³µì‚¬ ê²½ë¶ë™ë¶€ì§€ì‚¬': ['ê²½ë¶ í¬í•­ì‹œ', 'ê²½ë¶ ê²½ì£¼ì‹œ'],
                    'í•œêµ­ê°€ìŠ¤ì•ˆì „ê³µì‚¬ ëŒ€êµ¬ê²½ë¶ì§€ì—­ë³¸ë¶€': ['ê²½ë¶ êµ¬ë¯¸ì‹œ'],
                    'ì–‘ì‚°ì‹œì²­ ì›…ìƒì¶œì¥ì†Œ ê²½ì¬í™˜ê²½ê³¼': ['ê²½ë‚¨ ì–‘ì‚°ì‹œ']
                }
            },
            pathway: { searchTerm: '', selectedRows: new Set(), isEditing: false, currentPage: 1, filters: { region: '' }, showDownloadMenu: false },
            resource: { files: [], selectedFiles: new Set(), currentFolder: '', searchTerm: '', fileStorage: {} },
            salesUnlocked: false,
            resourceUnlocked: false,
            showCertificateModal: false,
            showCertSaveMenu: false,
            certificateData: {},
            showInspectionSheetModal: false,
            inspectionSheetData: {}
            };
                    
        const columns = ['ì‹œì„¤ë²ˆí˜¸', 'ì‹œì„¤ëª…', 'í–‰ì •êµ¬ì—­', 'ìƒˆì£¼ì†Œ', 'êµ¬ì£¼ì†Œ', 'ì‚¬ìš©ëŸ‰', 'ì „í™”ë²ˆí˜¸', 'ê¸°ì¤€ì¼', 'ì•ˆì „ê´€ë¦¬ìëª…', 'ìê²©ì¦ë²ˆí˜¸', 'ë³´í—˜ì‚¬', 'ë³´í—˜ë§Œê¸°ì¼', 'ë©”ëª¨','ë©”ëª¨1', 'ì‚¬ì—…ìë²ˆí˜¸', 'ëŒ€í‘œìëª…', 'ì—…íƒœ', 'ì¢…ëª©', 'ì´ë©”ì¼', 'ë©´ì œëŒ€ìƒ', 'ê²€ì‚¬ì´ë ¥'];
        const applicationColumns = ['ì‹œì„¤ë²ˆí˜¸', 'ì‹œì„¤ëª…', 'í–‰ì •êµ¬ì—­', 'ìƒˆì£¼ì†Œ', 'êµ¬ì£¼ì†Œ', 'ì‚¬ìš©ëŸ‰', 'ì „í™”ë²ˆí˜¸', 'ê¸°ì¤€ì¼', 'ì•ˆì „ê´€ë¦¬ìëª…', 'ìê²©ì¦ë²ˆí˜¸', 'ë³´í—˜ì‚¬', 'ë³´í—˜ë§Œê¸°ì¼', 'ë©”ëª¨', 'ê²€ì‚¬ì¼', 'ì‹ ì²­ì¼', 'ê²€ì‚¬ì›', 'ê²€ì‚¬ê²°ê³¼', 'í•„ì¦ë²ˆí˜¸', 'ìˆ˜ìˆ˜ë£Œ', 'ì ‘ìˆ˜ì²˜', 'ê³„ì‚°ì„œë°œí–‰ì¼', 'ë©”ëª¨2', 'ê²€ì‚¬í™•ì¸'];
        const quarterColumns = ['ë¶„ê¸°', 'ì‹œì„¤ë²ˆí˜¸', 'ì‹œì„¤ëª…', 'í–‰ì •êµ¬ì—­', 'ì‹ ì²­ì¼', 'ê²€ì‚¬ì¼', 'ê²€ì‚¬ì›', 'ê²€ì‚¬ê²°ê³¼', 'í•„ì¦ë²ˆí˜¸', 'ë©”ëª¨'];
        const cancellationColumns = ['ì‹œì„¤ë²ˆí˜¸', 'ì‹œì„¤ëª…', 'í–‰ì •êµ¬ì—­', 'ìƒˆì£¼ì†Œ', 'ì‹ ì²­ì¼', 'ì·¨ì†Œì‚¬ìœ ', 'ì·¨ì†Œì¼', 'ìˆ˜ìˆ˜ë£Œ', 'ì ‘ìˆ˜ì²˜','ê³„ì¢Œ', 'ë¹„ê³ '];
        const pathwayColumns = ['ì‹œì„¤ë²ˆí˜¸', 'ì‹œì„¤ëª…', 'í–‰ì •êµ¬ì—­', 'ìë©´ë™', 'ìƒˆì£¼ì†Œ', 'ì „í™”ë²ˆí˜¸', 'ì‚¬ìš©ê°€ìŠ¤', 'ì°¨ë‹¨ê¸°', 'íƒ€ì´ë¨¸', 'COê²½ë³´ê¸°', 'ëˆ„ì„¤', 'ì ê²€ì¼', 'ì ê²€ì', 'ë¹„ê³ ', 'ì°¸ì¡°'];
        const pathwayOptions = { regions: ['ìš¸ì£¼êµ°', 'ë¶êµ¬', 'ë‚¨êµ¬', 'ì¤‘êµ¬', 'ë™êµ¬'], gas: ['LPG', 'ë„ì‹œê°€ìŠ¤', 'LPG+ë„ì‹œê°€ìŠ¤'], device: ['ì„¤ì¹˜', 'ë¯¸ì„¤ì¹˜', 'ë¶ˆëŸ‰', 'í•´ë‹¹ì—†ìŠ´'], leak: ['ìœ ', 'ë¬´'], inspectors: ['ìµœì¤‘ìˆ˜', 'ê¹€íƒì‹ ', 'ê¹€ì¶˜ì‹'] };
        const columnWidths = { 'ì‹œì„¤ë²ˆí˜¸': '120px', 'ì‹œì„¤ëª…': '150px', 'í–‰ì •êµ¬ì—­': '100px', 'ìƒˆì£¼ì†Œ': '200px', 'êµ¬ì£¼ì†Œ': '120px', 'ì›”ì‚¬ìš©ì˜ˆì •ëŸ‰': '100px', 'ì „í™”ë²ˆí˜¸': '110px', 'ê¸°ì¤€ì¼': '100px', 'ì•ˆì „ê´€ë¦¬ìëª…': '90px', 'ìê²©ì¦ë²ˆí˜¸': '120px', 'ë³´í—˜ì‚¬': '70px', 'ë³´í—˜ë§Œê¸°ì¼': '100px', 'ë©”ëª¨': '150px', 'ê²€ì‚¬ì¼': '100px', 'ì‹ ì²­ì¼': '100px', 'ê²€ì‚¬ì›': '90px', 'ê²€ì‚¬ê²°ê³¼': '70px', 'í•„ì¦ë²ˆí˜¸': '140px', 'ìˆ˜ìˆ˜ë£Œ': '80px', 'ì ‘ìˆ˜ì²˜': '70px', 'ê³„ì‚°ì„œë°œí–‰ì¼': '110px', 'ë©”ëª¨2': '150px', 'ê²€ì‚¬í™•ì¸': '70px', 'ì·¨ì†Œë²ˆí˜¸': '120px', 'ì·¨ì†Œì‚¬ìœ ': '150px', 'ì·¨ì†Œì¼': '100px', 'ì²˜ë¦¬ì': '90px', 'ë¹„ê³ ': '150px' };

// ======================== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ========================
        function formatCurrency(value) {
            if (!value || value === '') return '';
            const num = parseInt(String(value).replace(/,/g, ''));
            if (isNaN(num)) return value;
            return num.toLocaleString();
        }

        function generateCertificateNumber(applicationDate, currentIdx) {
            if (!applicationDate) return '';
            const appYear = parseInt(applicationDate.substring(0, 4));
            const appYY = applicationDate.substring(2, 4);
            const appMM = applicationDate.substring(5, 7);
            const appDD = applicationDate.substring(8, 10);
            const currentAppData = state.applicationData[state.targetYear] || [];
            
            if (appYear !== state.inspectionYear) {
                const inspYY = String(state.inspectionYear).substring(2, 4);
                const prefix = `KGT${inspYY}0101-`;
                let maxNum = 0;
                currentAppData.forEach((row, idx) => {
                    if (idx !== currentIdx && row['í•„ì¦ë²ˆí˜¸'] && row['í•„ì¦ë²ˆí˜¸'].startsWith(prefix)) {
                        const numPart = parseInt(row['í•„ì¦ë²ˆí˜¸'].split('-')[1]);
                        if (!isNaN(numPart) && numPart > maxNum) maxNum = numPart;
                    }
                });
                return prefix + String(maxNum + 1).padStart(3, '0');
            }
            
            const prefix = `KGT${appYY}${appMM}${appDD}-`;
            let maxNum = 0;
            currentAppData.forEach((row, idx) => {
                if (idx !== currentIdx && row['í•„ì¦ë²ˆí˜¸'] && row['í•„ì¦ë²ˆí˜¸'].startsWith(prefix)) {
                    const numPart = parseInt(row['í•„ì¦ë²ˆí˜¸'].split('-')[1]);
                    if (!isNaN(numPart) && numPart > maxNum) maxNum = numPart;
                }
            });
            return prefix + String(maxNum + 1).padStart(3, '0');
        }

        async function saveToGoogleSheet(dataToSave) {
    try {
        const jsonData = JSON.stringify({ action: 'bulkSave', allData: dataToSave });
        const sizeInMB = (new Blob([jsonData]).size / (1024 * 1024)).toFixed(2);
        console.log(`ğŸ“¤ êµ¬ê¸€ ì‹œíŠ¸ ì €ì¥ ì‹œë„: ${sizeInMB}MB`);
        
        if (parseFloat(sizeInMB) > 500) {
            console.error('âŒ ë°ì´í„°ê°€ 500MBë¥¼ ì´ˆê³¼');
            alert('âŒ ë°ì´í„°ê°€ 500MBë¥¼ ì´ˆê³¼í–ˆìë‹ˆë‹¤ .');
            return false;
        }
        
       const response = await fetch(GOOGLE_CONFIG.WEB_APP_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'text/plain' },
    body: jsonData
});
        console.log('âœ… êµ¬ê¸€ ì‹œíŠ¸ ì €ì¥ ìš”ì²­ ì™„ë£Œ');
        return true;
    } catch (e) {
        console.error('êµ¬ê¸€ ì‹œíŠ¸ ì €ì¥ ì˜¤ë¥˜:', e);
        alert('âŒ êµ¬ê¸€ ì‹œíŠ¸ ì €ì¥ ì‹¤íŒ¨: ' + e.message);
        return false;
    }
}

        async function loadFromGoogleSheet() {
            try {
                const response = await fetch(GOOGLE_CONFIG.WEB_APP_URL + '?action=getAllData', {
                    method: 'GET'
                });
                const result = await response.json();
                if (result && result.data) {
                    if (result.data.data) state.data = result.data.data;
                    if (result.data.applicationData) state.applicationData = result.data.applicationData;
                    if (result.data.quarterData) state.quarterData = result.data.quarterData;
                    if (result.data.cancellationData) state.cancellationData = result.data.cancellationData;
                    if (result.data.pathwayData) state.pathwayData = result.data.pathwayData;
                    if (result.data.resourceData) state.resourceData = result.data.resourceData;
                    if (result.data.settings) state.settings = result.data.settings;
                    if (result.data.uploadedFileName) state.uploadedFileName = result.data.uploadedFileName;
                    if (result.data.selectedYear) state.selectedYear = result.data.selectedYear;
                    if (result.data.lastSaved) state.lastSaved = new Date(result.data.lastSaved);
                    const totalData = Object.values(state.data).reduce((sum, yearData) => sum + (yearData ? yearData.length : 0), 0);
                    if (totalData > 0) state.showWelcome = false;
                    console.log('âœ… êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                    return true;
                }
                return false;
            } catch (e) {
                console.error('êµ¬ê¸€ ì‹œíŠ¸ ë¡œë“œ ì˜¤ë¥˜:', e);
                return false;
            }
        }

        function saveToLocalStorage(dataToSave) {
    try {
        const jsonString = JSON.stringify(dataToSave);
        const sizeInMB = (new Blob([jsonString]).size / (1024 * 1024)).toFixed(2);
        if (parseFloat(sizeInMB) > 4.5) {
            console.warn(`âš ï¸ localStorage í¬ê¸° ì´ˆê³¼ (${sizeInMB}MB) - êµ¬ê¸€ ì‹œíŠ¸ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.`);
            return 'google_only';
        }
        localStorage.setItem('safetySystemData', jsonString);
        console.log(`âœ… localStorage ì €ì¥ ì™„ë£Œ (${sizeInMB}MB)`);
        return true;
    } catch (e) {
        if (e.name === 'QuotaExceededError') {
            console.warn('âš ï¸ localStorage ê³µê°„ ì´ˆê³¼ - êµ¬ê¸€ ì‹œíŠ¸ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.');
            return 'google_only';
        }
        console.error('ì €ì¥ ì˜¤ë¥˜:', e);
        return 'google_only';
    }
}
        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('safetySystemData');
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    if (parsed.data) state.data = parsed.data;
                    if (parsed.applicationData) state.applicationData = parsed.applicationData;
                    if (parsed.quarterData) state.quarterData = parsed.quarterData;
                    if (parsed.cancellationData) state.cancellationData = parsed.cancellationData;
                    if (parsed.pathwayData) state.pathwayData = parsed.pathwayData;
                    if (parsed.resourceData) state.resourceData = parsed.resourceData;
                    if (parsed.resourceFileStorage) state.resource.fileStorage = parsed.resourceFileStorage;
                    if (parsed.settings) state.settings = parsed.settings;
                    if (parsed.uploadedFileName) state.uploadedFileName = parsed.uploadedFileName;
                    if (parsed.selectedYear) state.selectedYear = parsed.selectedYear;
                    if (parsed.lastSaved) state.lastSaved = new Date(parsed.lastSaved);
                    const totalData = Object.values(state.data).reduce((sum, yearData) => sum + (yearData ? yearData.length : 0), 0);
                    if (totalData > 0) {
                        state.showWelcome = false;
                        const sizeInMB = (new Blob([savedData]).size / (1024 * 1024)).toFixed(2);
                        console.log(`âœ… ì €ì¥ëœ ë°ì´í„° ë³µì›: ${totalData}ê±´ (${sizeInMB}MB)`);
                    }
                } else {
                    console.log('âŒ localStorageì— ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (e) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
                alert('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + e.message);
            }
        }

        function getStorageSize() {
            try {
                const savedData = localStorage.getItem('safetySystemData');
                if (savedData) return (new Blob([savedData]).size / (1024 * 1024)).toFixed(2);
                return '0.00';
            } catch (e) { return 'N/A'; }
        }

        function normalizeDate(dateValue) {
            if (!dateValue || dateValue === '') return '';
            if (typeof dateValue === 'number') {
                const date = new Date((dateValue - 25569) * 86400 * 1000);
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            }
            const dateStr = String(dateValue).trim();
            if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) return dateStr;
            if (/^\d{4}\.\d{1,2}\.\d{1,2}$/.test(dateStr)) {
                const parts = dateStr.split('.');
                return `${parts[0]}-${String(parts[1]).padStart(2, '0')}-${String(parts[2]).padStart(2, '0')}`;
            }
            if (/^\d{4}\/\d{1,2}\/\d{1,2}$/.test(dateStr)) {
                const parts = dateStr.split('/');
                return `${parts[0]}-${String(parts[1]).padStart(2, '0')}-${String(parts[2]).padStart(2, '0')}`;
            }
            if (/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dateStr)) {
                const parts = dateStr.split('/');
                return `${parts[2]}-${String(parts[0]).padStart(2, '0')}-${String(parts[1]).padStart(2, '0')}`;
            }
            return dateStr;
        }

        function parseExcelFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onerror = () => reject(new Error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨'));
                reader.onload = (e) => {
                    try {
                        state.loadingProgress = 60;
                        render();
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        state.loadingProgress = 70;
                        render();
                        let targetSheet = null;
                        let maxRows = 0;
                        if (workbook.SheetNames.includes('ì ‘ìˆ˜')) {
                            targetSheet = workbook.Sheets['ì ‘ìˆ˜'];
                        } else {
                            workbook.SheetNames.forEach(sheetName => {
                                const sheet = workbook.Sheets[sheetName];
                                const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                                if (data.length > maxRows) { maxRows = data.length; targetSheet = sheet; }
                            });
                        }
                        if (!targetSheet) targetSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(targetSheet, { header: 1 });
                        if (jsonData.length < 2) { reject(new Error('ë°ì´í„°ê°€ ì—†ê±°ë‚˜ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.')); return; }
                        state.loadingProgress = 85;
                        render();
                        const headers = jsonData[0].map(h => String(h || '').trim());
                        const dateColumns = ['ê¸°ì¤€ì¼', 'ê²€ì‚¬ì¼', 'ì‹ ì²­ì¼', 'ë³´í—˜ë§Œê¸°ì¼', 'ê³„ì‚°ì„œë°œí–‰ì¼'];
                        const parsedData = [];
                        for (let i = 1; i < jsonData.length; i++) {
                            const hasData = jsonData[i].some(cell => cell !== undefined && cell !== null && String(cell).trim() !== '');
                            if (!hasData) continue;
                            const obj = {};
                            headers.forEach((header, idx) => {
                                let value = jsonData[i][idx];
                                if (value === undefined || value === null) obj[header] = '';
                                else obj[header] = dateColumns.includes(header) ? normalizeDate(value) : String(value).trim();
                            });
                            parsedData.push(obj);
                        }
                        state.loadingProgress = 100;
                        render();
                        resolve(parsedData);
                    } catch (error) { reject(error); }
                };
                reader.readAsArrayBuffer(file);
            });
        }

        function parseCSVFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onerror = () => reject(new Error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨'));
                reader.onload = (e) => {
                    try {
                        state.loadingProgress = 60;
                        render();
                        const text = e.target.result;
                        if (!text || text.trim() === '') { reject(new Error('íŒŒì¼ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.')); return; }
                        const rows = [];
                        let currentRow = '';
                        let insideQuotes = false;
                        const chars = text.replace(/\r\n/g, '\n').split('');
                        for (let i = 0; i < chars.length; i++) {
                            const char = chars[i];
                            if (char === '"') { insideQuotes = !insideQuotes; currentRow += char; }
                            else if (char === '\n' && !insideQuotes) { if (currentRow.trim()) rows.push(currentRow); currentRow = ''; }
                            else currentRow += char;
                        }
                        if (currentRow.trim()) rows.push(currentRow);
                        const lines = rows;
                        if (lines.length < 2) { reject(new Error('ë°ì´í„°ê°€ ì—†ê±°ë‚˜ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.')); return; }
                        state.loadingProgress = 80;
                        render();
                        const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
                        const dateColumns = ['ê¸°ì¤€ì¼', 'ê²€ì‚¬ì¼', 'ì‹ ì²­ì¼', 'ë³´í—˜ë§Œê¸°ì¼', 'ê³„ì‚°ì„œë°œí–‰ì¼'];
                        const parsedData = [];
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i];
                            if (!line.trim()) continue;
                            const values = [];
                            let currentValue = '';
                            let insideQuotes = false;
                            for (let j = 0; j < line.length; j++) {
                                const char = line[j];
                                if (char === '"') insideQuotes = !insideQuotes;
                                else if (char === ',' && !insideQuotes) { values.push(currentValue.trim().replace(/^"|"$/g, '')); currentValue = ''; }
                                else currentValue += char;
                            }
                            values.push(currentValue.trim().replace(/^"|"$/g, ''));
                            while (values.length < headers.length) values.push('');
                            const hasData = values.some(v => v && String(v).trim() !== '');
                            if (!hasData) continue;
                            const obj = {};
                            headers.forEach((header, idx) => {
                                let value = (values[idx] || '').replace(/[\\]/g, '').trim();
                                obj[header] = dateColumns.includes(header) ? normalizeDate(value) : value;
                            });
                            parsedData.push(obj);
                        }
                        state.loadingProgress = 100;
                        render();
                        resolve(parsedData);
                    } catch (error) { reject(error); }
                };
                reader.readAsText(file, 'EUC-KR');
            });
        }

        async function handleFileUpload(file) {
            if (!file) return;
            const maxSize = state.settings.maxFileSize * 1024 * 1024;
            if (file.size > maxSize) { alert(`íŒŒì¼ í¬ê¸°ê°€ ${state.settings.maxFileSize}MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`); return; }
            state.isLoading = true;
            state.loadingProgress = 30;
            state.uploadedFileName = file.name;
            render();
            try {
                let parsedData;
                const fileExt = file.name.split('.').pop().toLowerCase();
                if (fileExt === 'xlsx' || fileExt === 'xls') parsedData = await parseExcelFile(file);
                else if (fileExt === 'csv') parsedData = await parseCSVFile(file);
                else throw new Error('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤. (.xlsx, .xls, .csvë§Œ ê°€ëŠ¥)');
                if (parsedData.length === 0) { alert('ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); state.isLoading = false; render(); return; }
                if (!state.data[state.selectedYear]) state.data[state.selectedYear] = [];
                state.data[state.selectedYear] = parsedData;
                state.lastSaved = new Date();
                setTimeout(() => {
                    state.isLoading = false;
                    const storageSize = getStorageSize();
                    let message = `âœ… ${parsedData.length}ê°œì˜ ë°ì´í„°ê°€ ${state.selectedYear}ë…„ë„ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.\níŒŒì¼ëª…: ${file.name}`;
                    if (parseFloat(storageSize) > 3) message += `\n\nâš ï¸ ì €ì¥ ê³µê°„: ${storageSize}MB/5MB\nê³µê°„ì´ ë¶€ì¡±í•˜ë©´ ìë™ ì €ì¥ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
                    alert(message);
                    saveDataToStorage();
                    render();
                }, 300);
            } catch (error) {
                console.error('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                state.isLoading = false;
                render();
            }
        }

        function downloadAsExcel() {
            const dataToDownload = state.selectedRows.size > 0 ? state.filteredData.filter((_, idx) => state.selectedRows.has(idx)) : state.filteredData;
            if (dataToDownload.length === 0) { alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
            const worksheet = XLSX.utils.json_to_sheet(dataToDownload, { header: columns });
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'ì•ˆì „ê´€ë¦¬');
            XLSX.writeFile(workbook, `ì•ˆì „ê´€ë¦¬_${new Date().toISOString().split('T')[0]}.xlsx`);
            state.showDownloadMenu = false;
            render();
        }

        function downloadAsCSV() {
            const dataToDownload = state.selectedRows.size > 0 ? state.filteredData.filter((_, idx) => state.selectedRows.has(idx)) : state.filteredData;
            if (dataToDownload.length === 0) { alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
            const csvContent = [columns.join(','), ...dataToDownload.map(row => columns.map(col => { const value = row[col] || ''; return value.includes(',') || value.includes('"') ? `"${value.replace(/"/g, '""')}"` : value; }).join(','))].join('\n');
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ì•ˆì „ê´€ë¦¬_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            state.showDownloadMenu = false;
            render();
        }

        function createSampleData() {
            const sampleData = [
                { 'ì‹œì„¤ë²ˆí˜¸': '00458912-0001', 'ì‹œì„¤ëª…': 'ì¥ìˆ˜ë§ˆì„ëª©ìš•íƒ•', 'í–‰ì •êµ¬ì—­': 'ë¶€ì‚°', 'ìƒˆì£¼ì†Œ': 'ë¶€ì‚°ê´‘ì—­ì‹œ ê¸°ì¥êµ° ê¸°ì¥ì êµë¦¬ 334-6ë²ˆì§€', 'êµ¬ì£¼ì†Œ': '', 'ì›”ì‚¬ìš©ì˜ˆì •ëŸ‰': '6,334.00ã¡', 'ì „í™”ë²ˆí˜¸': '051-724-2552', 'ê¸°ì¤€ì¼': '2025-02-03', 'ì•ˆì „ê´€ë¦¬ìëª…': '', 'ìê²©ì¦ë²ˆí˜¸': '', 'ë³´í—˜ì‚¬': '', 'ë³´í—˜ë§Œê¸°ì¼': '2028-11-22', 'ë©”ëª¨': '', 'ê²€ì‚¬ì¼': '2002-01-30', 'ì‹ ì²­ì¼': '', 'ê²€ì‚¬ì›': 'ë¬¸ì„œì˜', 'ê²€ì‚¬ê²°ê³¼': '', 'í•„ì¦ë²ˆí˜¸': '', 'ìˆ˜ìˆ˜ë£Œ': '', 'ì ‘ìˆ˜ì²˜': 'ë¹„ëŒ€ìƒ', 'ê³„ì‚°ì„œë°œí–‰ì¼': '', 'ë¹„ê³ ': '', 'ê²€ì‚¬í™•ì¸': '', 'ì‚¬ì—…ìë²ˆí˜¸': '', 'ëŒ€í‘œìëª…': '', 'ì—…íƒœ': '', 'ì¢…ëª©': '', 'ì´ë©”ì¼': '', 'ë©´ì œëŒ€ìƒ': '', 'ê²€ì‚¬ì´ë ¥': 'Y' },
                { 'ì‹œì„¤ë²ˆí˜¸': '01525996-0001', 'ì‹œì„¤ëª…': 'í”¼í”ŒëŸ¬í•œì˜ì›', 'í–‰ì •êµ¬ì—­': 'ë¶€ì‚°', 'ìƒˆì£¼ì†Œ': 'ë¶€ì‚°ê´‘ì—­ì‹œ ê¸°ì¥êµ° ì •ê´€ì ìš©ìˆ˜ë¦¬ 12 83-3ë²ˆì§€', 'êµ¬ì£¼ì†Œ': '', 'ì›”ì‚¬ìš©ì˜ˆì •ëŸ‰': '1,322.00ã¡', 'ì „í™”ë²ˆí˜¸': '051-728-6999', 'ê¸°ì¤€ì¼': '2025-05-07', 'ì•ˆì „ê´€ë¦¬ìëª…': '', 'ìê²©ì¦ë²ˆí˜¸': '', 'ë³´í—˜ì‚¬': '', 'ë³´í—˜ë§Œê¸°ì¼': '', 'ë©”ëª¨': '', 'ê²€ì‚¬ì¼': '2011-01-05', 'ì‹ ì²­ì¼': '', 'ê²€ì‚¬ì›': '', 'ê²€ì‚¬ê²°ê³¼': '', 'í•„ì¦ë²ˆí˜¸': '', 'ìˆ˜ìˆ˜ë£Œ': '', 'ì ‘ìˆ˜ì²˜': 'ë¹„ëŒ€ìƒ', 'ê³„ì‚°ì„œë°œí–‰ì¼': '', 'ë¹„ê³ ': '', 'ê²€ì‚¬í™•ì¸': '', 'ì‚¬ì—…ìë²ˆí˜¸': '', 'ëŒ€í‘œìëª…': '', 'ì—…íƒœ': '', 'ì¢…ëª©': '', 'ì´ë©”ì¼': '', 'ë©´ì œëŒ€ìƒ': '', 'ê²€ì‚¬ì´ë ¥': '' }
            ];
            if (!state.data[state.selectedYear]) state.data[state.selectedYear] = [];
            state.data[state.selectedYear] = sampleData;
            state.uploadedFileName = 'ìƒ˜í”Œë°ì´í„°.xlsx';
            state.lastSaved = new Date();
            state.showWelcome = false;
            alert('ìƒ˜í”Œ ë°ì´í„° 2ê±´ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
            saveDataToStorage();
            updateFilters();
            render();
        }

        function updateFilters() {
            let result = [...(state.data[state.selectedYear] || [])];
            if (state.filters.region.length > 0) {
                result = result.filter(row => {
                    const region = (row['í–‰ì •êµ¬ì—­'] || '').replace(/[\\\/]/g, '').trim();
                    return state.filters.region.includes(region);
                });
            }
            if (state.filters.month) {
            result = result.filter(row => {
                const baseDate = row['ê¸°ì¤€ì¼'];
                if (!baseDate) return false;
                const month = parseInt(baseDate.split('-')[1]);
                return month === parseInt(state.filters.month);
            });
        }
            if (state.filters.inspectionHistory) {
                result = result.filter(row => {
                    const history = row['ê²€ì‚¬ì´ë ¥'];
                    if (state.filters.inspectionHistory === 'Y') return history === 'Y';
                    if (state.filters.inspectionHistory === 'N') return !history || history === '' || history === 'N';
                    return true;
                });
            }
            if (state.searchTerm) {
                result = result.filter(row => Object.values(row).some(val => String(val).toLowerCase().includes(state.searchTerm.toLowerCase())));
            }
            state.filteredData = result;
            
        }

       async function saveDataToStorage() {
    const toSave = {
        data: state.data, applicationData: state.applicationData, quarterData: state.quarterData,
        cancellationData: state.cancellationData, pathwayData: state.pathwayData, resourceData: state.resourceData,
        resourceFileStorage: state.resource.fileStorage, settings: state.settings, uploadedFileName: state.uploadedFileName,
        selectedYear: state.selectedYear, lastSaved: new Date().toISOString(), timestamp: new Date().toISOString()
    };
    saveToLocalStorage(toSave);
    await saveToGoogleSheet(toSave);
    state.lastSaved = new Date();
    return true;
}

        function confirmDuplicateCopy() {
            if (!state.applicationData[state.targetYear]) state.applicationData[state.targetYear] = [];
            state.applicationData[state.targetYear] = [...state.duplicateInfo.selectedData, ...state.applicationData[state.targetYear]];
            state.showDuplicateModal = false;
            state.activeTab = 'ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥';
            state.selectedRows = new Set();
            alert(`${state.duplicateInfo.selectedData.length}ê°œ í•­ëª©ì´ ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥ìœ¼ë¡œ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            saveDataToStorage();
            render();
        }

        function moveToCancel() {
            const currentAppData = state.applicationData[state.targetYear] || [];
            const selectedData = currentAppData.filter((_, idx) => state.selectedApplicationRows.has(idx));
            if (selectedData.length === 0) { alert('ì·¨ì†Œí•  ë°ì´í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
            if (!state.cancellationData[state.targetYear]) state.cancellationData[state.targetYear] = [];
            const cancellationItems = selectedData.map((item) => ({ 'ì‹œì„¤ë²ˆí˜¸': item['ì‹œì„¤ë²ˆí˜¸'], 'ì‹œì„¤ëª…': item['ì‹œì„¤ëª…'], 'í–‰ì •êµ¬ì—­': item['í–‰ì •êµ¬ì—­'], 'ìƒˆì£¼ì†Œ': item['ìƒˆì£¼ì†Œ'] || '', 'í•„ì¦ë²ˆí˜¸': item['í•„ì¦ë²ˆí˜¸'], 'ì‹ ì²­ì¼': item['ì‹ ì²­ì¼'], 'ì·¨ì†Œì‚¬ìœ ': '', 'ì·¨ì†Œì¼': '', 'ìˆ˜ìˆ˜ë£Œ': '', 'ì ‘ìˆ˜ì²˜': '', 'ê³„ì¢Œ': '', 'ë¹„ê³ ': '' }));
            state.cancellationData[state.targetYear] = [...cancellationItems, ...state.cancellationData[state.targetYear]];
            const remainingApplicationData = currentAppData.filter((_, idx) => !state.selectedApplicationRows.has(idx));
            state.applicationData[state.targetYear] = remainingApplicationData;
            state.selectedApplicationRows = new Set();
            alert(`${selectedData.length}ê°œ í•­ëª©ì´ ì·¨ì†ŒëŒ€ì¥ìœ¼ë¡œ ì´ë™ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            saveDataToStorage();
            render();
        }

        function cutToInspectionYear() {
            if (state.targetYear === state.inspectionYear) { alert('âš ï¸ í•´ë‹¹ë…„ë„ì™€ ê²€ì‚¬ì˜ˆì •ë…„ë„ê°€ ê°™ìŠµë‹ˆë‹¤.\nì˜ë¼ë‚´ê¸°ê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
            if (state.selectedApplicationRows.size === 0) { alert('ì˜ë¼ë‚¼ ë°ì´í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
            const currentAppData = state.applicationData[state.targetYear] || [];
            const selectedIndices = Array.from(state.selectedApplicationRows).sort((a, b) => b - a);
            const selectedData = selectedIndices.map(idx => ({...currentAppData[idx]}));
            const cutCount = selectedData.length;
            const targetInspectionYear = state.inspectionYear;
            if (!state.applicationData[state.inspectionYear]) state.applicationData[state.inspectionYear] = [];
            state.applicationData[state.inspectionYear] = [...selectedData, ...state.applicationData[state.inspectionYear]];
            selectedIndices.forEach(idx => { state.applicationData[state.targetYear].splice(idx, 1); });
            state.targetYear = state.inspectionYear;
            state.selectedApplicationRows = new Set();
            alert(`âœ‚ï¸ ${cutCount}ê°œ í•­ëª©ì´ ${targetInspectionYear}ë…„ë„ë¡œ ì´ë™ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            saveDataToStorage();
            render();
        }

        function clearAllData() {
            if (confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì €ì¥ëœ ë°ì´í„°ë„ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤)')) {
                localStorage.removeItem('safetySystemData');
                state.data = {}; state.applicationData = {}; state.quarterData = {}; state.cancellationData = {};
                state.pathwayData = {}; state.resourceData = {}; state.uploadedFileName = ''; state.lastSaved = null;
                state.showWelcome = true; state.showAdmin = false;
                alert('âœ… ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                render();
            }
        }
        function copyToApplication() {
                if (state.selectedRows.size === 0) { alert('ë³µì‚¬í•  ë°ì´í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
                const selectedData = state.filteredData.filter((_, idx) => state.selectedRows.has(idx)).map(item => ({...item}));
                const existingFacilityNumbers = (state.applicationData[state.targetYear] || []).map(row => row['ì‹œì„¤ë²ˆí˜¸']);
                const duplicates = selectedData.filter(item => existingFacilityNumbers.includes(item['ì‹œì„¤ë²ˆí˜¸']));
                if (duplicates.length > 0) {
                    state.duplicateInfo = { duplicates, selectedData };
                    state.showDuplicateModal = true;
                    render();
                    return;
                }
                if (!state.applicationData[state.targetYear]) state.applicationData[state.targetYear] = [];
                state.applicationData[state.targetYear] = [...selectedData, ...state.applicationData[state.targetYear]];
                state.activeTab = 'ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥';
                state.selectedRows = new Set();
                alert(`${selectedData.length}ê°œ í•­ëª©ì´ ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥ìœ¼ë¡œ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                saveDataToStorage();
                render();
            }
        function deleteSelectedRows() {
            if (state.selectedRows.size === 0) { alert('ì‚­ì œí•  í–‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
            state.showDeleteModal = true;
            render();
        }

        function confirmDelete() {
            const selectedData = state.filteredData.filter((_, idx) => state.selectedRows.has(idx));
            selectedData.forEach(selectedItem => { state.data[state.selectedYear] = state.data[state.selectedYear].filter(item => item !== selectedItem); });
            state.selectedRows = new Set();
            state.showDeleteModal = false;
            alert(`${selectedData.length}ê°œ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            saveDataToStorage();
            updateFilters();
            render();
        }

        function addApplicationRow() {
            const newRow = {};
            applicationColumns.forEach(col => { newRow[col] = ''; });
            if (!state.applicationData[state.targetYear]) state.applicationData[state.targetYear] = [];
            state.applicationData[state.targetYear] = [newRow, ...state.applicationData[state.targetYear]];
            saveDataToStorage();
            render();
        }

        function deleteSelectedApplicationRows() {
            if (state.selectedApplicationRows.size === 0) { alert('ì‚­ì œí•  í–‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
            state.showAppDeleteModal = true;
            render();
        }

        function confirmAppDelete() {
            const currentAppData = state.applicationData[state.targetYear] || [];
            const selectedIndices = Array.from(state.selectedApplicationRows);
            const newData = currentAppData.filter((_, idx) => !selectedIndices.includes(idx));
            state.applicationData[state.targetYear] = newData;
            state.selectedApplicationRows = new Set();
            state.showAppDeleteModal = false;
            alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            saveDataToStorage();
            render();
        }
        // ======================== ëª¨ë‹¬ ë Œë”ë§ í•¨ìˆ˜ ========================
        function renderDetailModal() {
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-auto">
                    <div class="bg-white rounded-lg shadow-2xl my-8 w-full max-w-4xl mx-4 max-h-[95vh] overflow-y-auto">
                        <div class="bg-pink-600 text-white px-6 py-4 flex items-center justify-between sticky top-0 z-10">
                            <h3 class="text-xl font-bold flex items-center gap-2">
                                <span class="text-2xl">ğŸ‘ï¸</span>
                                ${state.detailModalSelectedIdx !== null ? 'ìƒì„¸ë³´ê¸°' : 'ìƒˆ ë°ì´í„° ì¶”ê°€'}
                            </h3>
                            <button id="detailCloseBtn" class="text-white hover:text-gray-200 text-2xl">âœ•</button>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                ${columns.map(col => `
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">${col}</label>
                                        <input type="text" id="detail-${col}" value="${state.detailModalData[col] || ''}" 
                                               class="w-full px-3 py-2 border rounded text-sm" 
                                               ${col.includes('ì¼') ? 'type="date"' : ''} />
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="bg-gray-50 px-6 py-4 flex gap-3 justify-end border-t sticky bottom-0 z-10">
                            <button id="detailCancelBtn" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 font-semibold">ì·¨ì†Œ</button>
                            ${state.detailModalSelectedIdx !== null ? `
                                <button id="detailSaveBtn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">ğŸ’¾ ìˆ˜ì •</button>
                            ` : `
                                <button id="detailAddBtn" class="px-6 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 font-semibold">â• ì¶”ê°€</button>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAppDetailModal() {
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-auto">
                    <div class="bg-white rounded-lg shadow-2xl my-8 w-full max-w-4xl mx-4 max-h-[95vh] overflow-y-auto">
                        <div class="bg-pink-600 text-white px-6 py-4 flex items-center justify-between sticky top-0 z-10">
                            <h3 class="text-xl font-bold flex items-center gap-2">
                                <span class="text-2xl">ğŸ‘ï¸</span>
                                ${state.appDetailModalSelectedIdx !== null ? 'ìƒì„¸ë³´ê¸° (ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥)' : 'ìƒˆ ë°ì´í„° ì¶”ê°€ (ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥)'}
                            </h3>
                            <button id="appDetailCloseBtn" class="text-white hover:text-gray-200 text-2xl">âœ•</button>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                ${applicationColumns.map(col => `
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">${col}</label>
                                        ${col === 'ê²€ì‚¬ì›' ? `
                                            <select id="appDetail-${col}" class="w-full px-3 py-2 border rounded text-sm">
                                                <option value="">ì„ íƒ</option>
                                                ${state.inspectors.map(i => `<option value="${i}" ${i === state.appDetailModalData[col] ? 'selected' : ''}>${i}</option>`).join('')}
                                            </select>
                                        ` : col === 'ê²€ì‚¬ê²°ê³¼' ? `
                                            <select id="appDetail-${col}" class="w-full px-3 py-2 border rounded text-sm">
                                                <option value="">ì„ íƒ</option>
                                                ${state.inspectionResults.map(r => `<option value="${r}" ${r === state.appDetailModalData[col] ? 'selected' : ''}>${r}</option>`).join('')}
                                            </select>
                                        ` : col === 'ì ‘ìˆ˜ì²˜' ? `
                                            <select id="appDetail-${col}" class="w-full px-3 py-2 border rounded text-sm">
                                                <option value="">ì„ íƒ</option>
                                                ${state.receiptLocations.map(l => `<option value="${l}" ${l === state.appDetailModalData[col] ? 'selected' : ''}>${l}</option>`).join('')}
                                            </select>
                                        ` : col.includes('ì¼') ? `
                                            <input type="date" id="appDetail-${col}" value="${state.appDetailModalData[col] || ''}" class="w-full px-3 py-2 border rounded text-sm" />
                                        ` : `
                                            <input type="text" id="appDetail-${col}" value="${state.appDetailModalData[col] || ''}" class="w-full px-3 py-2 border rounded text-sm" />
                                        `}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="bg-gray-50 px-6 py-4 flex gap-3 justify-end border-t sticky bottom-0 z-10">
                            <button id="appDetailCancelBtn" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 font-semibold">ì·¨ì†Œ</button>
                            ${state.appDetailModalSelectedIdx !== null ? `
                                <button id="appDetailSaveBtn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">ğŸ’¾ ìˆ˜ì •</button>
                            ` : `
                                <button id="appDetailAddBtn" class="px-6 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 font-semibold">â• ì¶”ê°€</button>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        function openAppDetailModal() {
            if (state.selectedApplicationRows.size === 1) {
                const selectedIdx = Array.from(state.selectedApplicationRows)[0];
                const currentAppData = state.applicationData[state.targetYear] || [];
                const selectedData = currentAppData[selectedIdx];
                state.appDetailModalData = { ...selectedData };
                state.appDetailModalSelectedIdx = selectedIdx;
            } else {
                state.appDetailModalData = {};
                state.appDetailModalSelectedIdx = null;
                applicationColumns.forEach(col => { state.appDetailModalData[col] = ''; });
            }
            state.showAppDetailModal = true;
            render();
        }

        function closeAppDetailModal() { state.showAppDetailModal = false; render(); }

        function saveFromAppDetailModal() {
            applicationColumns.forEach(col => {
                const input = document.getElementById(`appDetail-${col}`);
                if (input) state.appDetailModalData[col] = input.value;
            });
            if (state.appDetailModalSelectedIdx !== null && state.appDetailModalSelectedIdx >= 0) {
                state.applicationData[state.targetYear][state.appDetailModalSelectedIdx] = { ...state.appDetailModalData };
            }
            state.lastSaved = new Date();
            saveDataToStorage();
            state.showAppDetailModal = false;
            alert('ğŸ’¾ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            render();
        }

        function addFromAppDetailModal() {
            applicationColumns.forEach(col => {
                const input = document.getElementById(`appDetail-${col}`);
                if (input) state.appDetailModalData[col] = input.value;
            });
            const newRow = { ...state.appDetailModalData };
            if (!state.applicationData[state.targetYear]) state.applicationData[state.targetYear] = [];
            state.applicationData[state.targetYear] = [newRow, ...state.applicationData[state.targetYear]];
            state.lastSaved = new Date();
            saveDataToStorage();
            state.showAppDetailModal = false;
            alert('ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            render();
        }

        function renderMapModal() {
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 overflow-auto p-4 pt-8">
                    <div class="bg-white rounded-lg shadow-2xl my-8" style="width: 210mm; max-width: 210mm; height: 297mm; display: flex; flex-direction: column; overflow: hidden;">
                        <div class="flex items-center justify-between p-6 border-b sticky top-0 bg-white z-10">
                            <h3 class="text-2xl font-bold">ğŸ—ºï¸ ì‹œì„¤ ìœ„ì¹˜ ì§€ë„</h3>
                            <button id="mapCloseBtn" class="text-gray-600 hover:text-gray-900 text-3xl font-bold">âœ•</button>
                        </div>
                        <div style="position: relative;">
                            <div id="mapContainer" style="width: 100%; height: 800px; background: #f0f0f0; border: 1px solid #ccc;"></div>
                            <div id="mapFacilityOverlay" style="position: absolute; top: 10px; left: 10px; right: 10px; background: rgba(255,255,255,0.95); padding: 10px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); z-index: 100; display: none;">
                                <h4 style="margin: 0 0 8px 0; font-weight: bold; font-size: 14px; color: #333;">ğŸ“ ì‹œì„¤ ëª©ë¡</h4>
                                ${state.mapData.map((item, idx) => `
                                    <div style="padding: 4px 0; border-bottom: 1px solid #eee; font-size: 12px;">
                                        <strong>${idx + 1}. ${item['ì‹œì„¤ëª…']}</strong>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div id="mapLoadingBar" style="padding: 1.5rem; background: #eff6ff; border-top: 1px solid #bfdbfe; ${state.isLoadingMap ? '' : 'display: none;'}">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-semibold text-blue-700">ì§€ë„ ë¡œë”© ì¤‘...</span>
                                <span id="mapProgressText" class="text-sm font-bold text-blue-600">${state.mapLoadingProgress}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div id="mapProgressBar" class="bg-blue-600 h-3 rounded-full transition-all" style="width: ${state.mapLoadingProgress}%;"></div>
                            </div>
                        </div>
                        <div class="p-2 bg-gray-50 border-t max-h-24 overflow-y-auto">
                            <h4 class="font-bold mb-1 text-sm">ğŸ“ ì„ íƒëœ ì‹œì„¤ ì£¼ì†Œ</h4>
                            <div class="space-y-3">
                                ${state.mapData.map((item) => `
                                    <div class="bg-white p-4 rounded border-l-4 border-blue-500">
                                        <p class="font-semibold">${item['ì‹œì„¤ëª…']}</p>
                                        <p class="text-sm text-gray-600">ì‹œì„¤ë²ˆí˜¸: ${item['ì‹œì„¤ë²ˆí˜¸']}</p>
                                        <p class="text-sm text-gray-700">ğŸ“® ${item['ìƒˆì£¼ì†Œ']}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="flex gap-2 justify-end p-2 border-t bg-white">
                            <button id="mapPrintBtn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">ğŸ–¨ï¸ ì¸ì‡„</button>
                            <button id="mapCancelBtn" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 font-semibold">ë‹«ê¸°</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function openDetailModal() {
            if (state.selectedRows.size === 1) {
                const selectedIdx = Array.from(state.selectedRows)[0];
                const selectedData = state.filteredData[selectedIdx];
                state.detailModalData = { ...selectedData };
                state.detailModalSelectedIdx = (state.data[state.selectedYear] || []).indexOf(selectedData);
            } else {
                state.detailModalData = {};
                state.detailModalSelectedIdx = null;
                columns.forEach(col => { state.detailModalData[col] = ''; });
            }
            state.showDetailModal = true;
            render();
        }

        function closeDetailModal() { state.showDetailModal = false; render(); }

        function saveFromDetailModal() {
            columns.forEach(col => {
                const input = document.getElementById(`detail-${col}`);
                if (input) state.detailModalData[col] = input.value;
            });
            if (state.detailModalSelectedIdx !== null && state.detailModalSelectedIdx >= 0) {
                state.data[state.selectedYear][state.detailModalSelectedIdx] = { ...state.detailModalData };
            } else {
                if (!state.data[state.selectedYear]) state.data[state.selectedYear] = [];
                state.data[state.selectedYear] = [{ ...state.detailModalData }, ...state.data[state.selectedYear]];
            }
            state.lastSaved = new Date();
            saveDataToStorage();
            state.showDetailModal = false;
            alert('ğŸ’¾ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            updateFilters();
            render();
        }

        function addFromDetailModal() {
            const newRow = { ...state.detailModalData };
            if (!state.data[state.selectedYear]) state.data[state.selectedYear] = [];
            state.data[state.selectedYear] = [newRow, ...state.data[state.selectedYear]];
            state.lastSaved = new Date();
            saveDataToStorage();
            state.showDetailModal = false;
            alert('ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            updateFilters();
            render();
        }

        function renderLoadingModal() {
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white p-8 rounded-lg shadow-xl text-center">
                        <div class="animate-pulse text-4xl mb-4">â³</div>
                        <p class="text-lg font-semibold mb-2">íŒŒì¼ ì²˜ë¦¬ ì¤‘...</p>
                        <div class="w-64 bg-gray-200 rounded-full h-4 mb-2">
                            <div class="bg-blue-600 h-4 rounded-full transition-all" style="width: ${state.loadingProgress}%;"></div>
                        </div>
                        <p class="text-sm text-gray-600">${state.loadingProgress}%</p>
                    </div>
                </div>
            `;
        }

        function renderDuplicateModal() {
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full mx-4">
                        <div class="bg-orange-500 text-white px-6 py-4">
                            <h3 class="text-xl font-bold">âš ï¸ ì¤‘ë³µëœ ì‹œì„¤ë²ˆí˜¸ ë°œê²¬</h3>
                        </div>
                        <div class="p-6">
                            <p class="text-gray-700 mb-4">ì¤‘ë³µëœ ì‹œì„¤ë²ˆí˜¸ê°€ <strong class="text-orange-600">${state.duplicateInfo.duplicates.length}ê°œ</strong> ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                        </div>
                        <div class="bg-gray-50 px-6 py-4 flex gap-3 justify-end border-t">
                            <button id="cancelDupBtn" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 font-semibold">ì·¨ì†Œ</button>
                            <button id="confirmDupBtn" class="px-6 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 font-semibold">ê³„ì† ì§„í–‰</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDeleteModal() {
            const selectedData = state.filteredData.filter((_, idx) => state.selectedRows.has(idx));
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full mx-4">
                        <div class="bg-red-500 text-white px-6 py-4">
                            <h3 class="text-xl font-bold">ğŸ—‘ï¸ ë°ì´í„° ì‚­ì œ í™•ì¸</h3>
                        </div>
                        <div class="p-6">
                            <p class="text-gray-700 mb-4">ì„ íƒëœ <strong class="text-red-600">${selectedData.length}ê°œ</strong>ì˜ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                            <div class="bg-yellow-50 border border-yellow-200 rounded p-3">
                                <p class="text-sm text-yellow-800"><strong>âš ï¸ ì£¼ì˜:</strong> ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                        <div class="bg-gray-50 px-6 py-4 flex gap-3 justify-end border-t">
                            <button id="cancelDeleteBtn" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 font-semibold">ì·¨ì†Œ</button>
                            <button id="confirmDeleteBtn" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold">ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAppDeleteModal() {
            const currentAppData = state.applicationData[state.targetYear] || [];
            const selectedData = currentAppData.filter((_, idx) => state.selectedApplicationRows.has(idx));
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full mx-4">
                        <div class="bg-red-500 text-white px-6 py-4">
                            <h3 class="text-xl font-bold">ğŸ—‘ï¸ ë°ì´í„° ì‚­ì œ í™•ì¸</h3>
                        </div>
                        <div class="p-6">
                            <p class="text-gray-700 mb-4">ì„ íƒëœ <strong class="text-red-600">${selectedData.length}ê°œ</strong>ì˜ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                        </div>
                        <div class="bg-gray-50 px-6 py-4 flex gap-3 justify-end border-t">
                            <button id="cancelAppDeleteBtn" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 font-semibold">ì·¨ì†Œ</button>
                            <button id="confirmAppDeleteBtn" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold">ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            `;
        }

        
        function renderCertificateModal() {
    const d = state.certificateData;
    const formatInspDate = (dateStr) => { 
        if (!dateStr) return '\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0ë…„\u00A0\u00A0\u00A0\u00A0\u00A0ì›”\u00A0\u00A0\u00A0\u00A0\u00A0ì¼'; 
        const parts = dateStr.split('-'); 
        return parts[0] + 'ë…„ ' + parseInt(parts[1]) + 'ì›” ' + parseInt(parts[2]) + 'ì¼'; 
    };
    const formatCertNumber = (certNum) => {
        if (!certNum) return '';
        if (certNum.includes('-')) {
            const parts = certNum.split('-');
            if (parts[0].startsWith('KGT')) {
                const numPart = parts[0].replace('KGT', '');
                const year = '20' + numPart.substring(0, 2);
                const monthDay = numPart.substring(2);
                const seq = parts[1] ? parts[1].replace(/^0+/, '') : '';
                return `KGT - ${year}${monthDay} - ${seq.padStart(2, '0')}`;
            }
        }
        return certNum;
    };
    const sealImage = 'data:image/webp;base64,UklGRhASAABXRUJQVlA4WAoAAAAgAAAAkgAAXwAASUNDUMgBAAAAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADZWUDggIhAAAHA3AJ0BKpMAYAA+USCNRCOiIRZor1Q4BQSyjgB77nCsS27+Bw/a3rMOG93gT7efnVHJd+sfXTwV8kPs33C9e7F316f13oh9VHx/9a/cz4wfuv+6/v3i78B/67+zewR66/vv5jehb/c9t1rX+R/43qF+x/0L/T/2T93P8z8Jv1nmN9j/YA/WX0b/7Pg7fe/+R7Av6l9Hj6Y87P2R/5f8Z8BP5peuv66/3W///vAJy1u2yHvnCh2/cfseh/MQaDSO8q2M66/WXtgreYfwuF5cqwax1HqwtgHWmcbqmgFwMrK/iuIpja18vYjiKhCGeYqXRoVPRLZoQmmixAeuHn4A8LC4dHIJgr4I9bLrbI4Rbo9yoTDYc2LlqPI3O0lBi+pqu/Gryec6x+NfSOuRLl24eTLQUaRd3xdJtHMvcak1z+KxD5fWLnGA0x8phqwSpbodYrkVVbATuZsX38KLJfZ3X5/F3mB7qJyNAG18nE5wXP1Wkv9G/g/fwaRDxLyD1jqhFrNw336B6J9wfjDtv8dI1V1nhU7I76Wf3zZSzSM3Cr37XfDfkJXucGCGsacInFO+J/3cShoiO31xg186R8goWystGHQAAP7/mARvhxth//uuZad8YDp2RG7TA/y++T5XfAfTbrgpiKVmK1YbObkRLaoY9JDNCWBxzrW01Um+l63vFJ8rslrYDChBSSE1Nzv8+Zdrt4IwIKulw0ODSJOidjMgSKGLToyzX05vbliZT6J9f/5PD8CzNCzla6V3BUOSYJyvawUZhUmK698U1BPKQ2v0Tk3dFld9DlfUQE5PecYhnO2Oax0nG5ciz4IYCLUK2uzfbuPktgrhf7u44xyn5xOfgejKoKGjdaFTf3aDnDYo9TKdLOcSmNwbsAU96/u6+ZP8fh1TsWgkYT/i6B38QgQ4sIOWQhftqY2qclWgNkxqGWOSDnhow5SQoRa2PpRMZ2G5PtxXuoeVEjNIWmc/E4ajqyuoH8REoZgO94jw/GOXX+2mHVSfWa/iOr9QcipDrCYiah28LJR3kN2mWKj1KUZUI19k4Qg0pqDs6d+5FKm60j79jmbvdgdm67vCB2UltTAAHkFGwWOk/Eo8zOCXAPn2Ia7ExNNsbsn53Vk1uy6vr6lGmb4Loi5yIdpBTFFurubgiSWMsPsFWYfU1iCRzJrlZAVEeAfaPvBLgluyOwBb6oO+x5v/tEOvklKnOOYhgPqr/hwDLBeDoj6pWL07jemZodNfXgNMLn38yEojSs4KDtZQ1RHQ7U/i6pZhaIJYVEvtyAFdcskSawHOvXif/C86f/GUxu4SObhn5vOrhsSU/moxfMT6khFvPZfQAn/h8Ai/1ySQeZWCW3cFPNpEAt/R7/K/2Y+fDiuddu9WY1kULh/zlKVRtGfUC/oiTbAwCMfbIJ57GhEtYKWx1u8tnE740iqZHHqXTux55HVYF/DcgANZwWwFL7fHGjoejT+CAAdpY696B5eKCJxYDO/4JGs9RMz0XbPu7AEo3utP4GiBGS3LEGR1dTDeQqlolKa/ZZA0aDluFSoS/LJUeuYbsItq/6C2e4W3nxAh4MVLI4/KD5pd9sJAW2y3i+U+OnHNInyTj/+0nXI80CXFgmq4vTzXdhLYyUnXGsgLnvl/8moikG94bEoBR2yL3kufr/TW4/lMu8Z12RzF13ArctsWifyVAnYaLRPStkcXhkZLe1k/8Ptrv2ojm6siI526hbzQpmx+M0pLBRuM35ZBk2odwrUgUheprI7DcDIi6x9KijsgvnA8QaXXWF8PXA3NRTt0n3jl5lF/gfM3AyW918NzWVg6+5v7oXNwbTA96EmJaTSeeK2irQIoHG6ATLsiLmE7ZtMhJ+esMx0TYXxG6FIPdfS5LXjZegazglfwnar6IGYYRmkhlzwvrO3fKmrfIzusqUGiCGsj2+CNZwaEUqmmqbbkQZvmg7QW0v4QVk0t+bLxcvCwKA+go4ZGl+qPHiMU5GS0xoci5UEYYcMC1bDNjXpKBGqgb98jxfAYx5JNXYh/7KI4m6nPsaJqjwGP30wnbLNbtCryEIE+sHXKteR7pEUs/AmHQ8R+hTdBOyWiG+n0VB+Ot3DyUi9ja/2TMKNGq9RL9SQ5Uq1sIcauNvmz0fz5T5fxhTSt8WFzJ1ObMZKAcyRF7M6ITg/N5Rpv75ymUPvEAm9Ojx38h7gf4olLNoXcwRXbzr1fSRmdUDsZSTA2M7iNFNc+J5YnAzXwnKVrRCiB78sOlGuuLwBkindfqAOHfal2YiPkSTNsezDp0mTDWOv+sRxYCU6FL+/T3G+yx7LyoqWS/acN9O32p5X2rCafVgVaOIgtJpuhuwjSqC3O1Nizn/EwjzblaX988QZsN1wQPhoi1rwCc/BSlFnuaJXPGnmdN/boTHt7a93/pQrN+PqThX8i3PonItr19wd3EFUyz7fu8CS2+IR6KTSDNrdLLCES6NsgiQWvovG4ce9Pxos8mSqGv7ZsavUgzFswSZWkylGLry7ny9EcF6eRrtnpdBcabiTEaP3EcZ8EDYcg+6EIguEzKbCB76QPFwG6H5zCw40jxb3Woz2U6P6mY5OHK3GpVCtCifuztZBKdWOZFeh6RgI6QtTDSHS0fJ+GjLt/CNF6pWoKuio12i7766KKWYMqenYCKHXI0a5CsZzG2PsBMEoT8ye2HnItARLifImKTtEYg/Hw9Wq0vC0r+iUeL1BB5pBHUai26M9I0hOJoszKMYUchsuR+T5kbkhWtRvIHg9tp70AhggAxK/o5B4iKEQ402H+tf8SCDKyQZ3ExMiAsXNvep+gnbm6hqLdzeTy+IpoMgY3J8apGDkXbb4Hb7aYQmrTE6CbgPI2eBuUEii/O6w8k44wUAKq3AP+XoyDmdRUJX/sjSQpK1HZGsTtipgRJDD2soWHw3y6SlWIetPf9DeOh6w1FiWCJs/VsHoXNXLTewU9V1g7qYWovlGxwi9JMOeSs7xzLjBtZBlujvA3+WYKMhjgH6gH1rsCFsgfJx2xt4wbmSwcCdGsN5oRuZUOPjke6fHcw9uJjJKZJXxP6ZJR+kRzI1OI8O+WdKy3VI3XaL2vHSnLXevA2nP0ykPVwlN+BSWzbNCptHcOPqTPtQrJJZU2Ii+lssM6IiMFivTPHeYUW/eDYX5vgNczkCo9ANy5KpiWucQHsG3DBQ4KgiTINhBcOuF1KF66dWehEf3OTu4WTT4JBYljUViCZcCqcI8+AQgXZWwXJt6QcQ9uNyLJJvvMhIruaqEGpZzklVAvbokl/yB2Q96kv4faqJUGftgD+5mQ/t2QTB7F9fAfr6vfrZF9M35Rt4EVIklXvqJB8elEmESlNbbLmRQujSfLJg9KtYQ2jrA+xxpYbNmCOTT+mFzWCd2/eCYVz/1Ios5KeApN6qzM32iHFidYF7+plhYtAKUS9GOPv5U8T+9IKvj8wAz6O58iDGmx2mbDSb7hRO+kkocevzB9Oa73WSQsuuCcNQEWo+Ezqdr7aAt96uum1dWldVKKsHjbCnN9pe2ywFiQenoTKBJhcP9Bq6GF8ldzcwYvE8Js6jta0UN3pIR9vk/K1qiRKT+1F+vGVyTNJDHkKhzM31xf+RoBt+SHpBOZ3mq6rtQqq98IECGafs2aMVYs+B2hYN10yPOrKVjjfBPTYaDuYvDotCFY0eeBMJeXoE1KUQssyXRIeyqibddOy/9GhvE02FCqE+v3nogktcEqZF/h5XpBVgIb90ebwDA9r/2joOeS4B1BFjMgy0LkbSU0qIwXFWlDOriHfGRGl0tpwM22X3/1IcbaxTasQsbMH5yHo8maN6gM1e4ZB8LDqfIfH7tH6OGWiy0Dx6xDqQSXdCFoNIT2xFp0LhwebohaOi4AiKOeIXGQ64+LqNnsrZiKpHRgVx1Vb5TL4evByIKQlDPNrt6b1yClEnKUMPuaYlgcBM5YMz++8Z27IVxG5IHglXkMd0zPLQWfE691a0iJ5hAwdAmwZB6e/nv6s0NRSewqvgeO0/VMS3ypUzzC54J6hTrGd7jWPfP28RvmqkLj30kr5jVwycYTZW0SLTQixaNVCJ7GIvOxVf4XNcXFyw5FuFDZRS1d4TxpA5xTC0oIZrlT/E1aCcTj3E8AaIhT8ZWSlSC7Ke+gOeKJldilQFV1gKbZqfvUU3hkuV8wVga5J+O+pJTfaQ2pldX2vb+ltqnxUyiJOw8qiPyb+45C7cS8MwqI9zUp/HFiQA+t8MGezPVtAVWk5+gCswnay27yBUZmOkKKFWkps+TEA+zo7lqAs5xR53BgFfiVbHB4ynDARfD9MPvSGKCNhg/2vj2GRNhlmlMp7Mmthesxb51v1zkRztMaSHZQodyjjB4MymZojg7wl1vNbV5r4WQtzFB3vu8goirtoCKI2pBo3kSCJqwCROkzj++GO5lGz2mgNryLh47Dt2rBMTVqj+khAjHaVuYfz68gfxIxsMiz4Yfph7DfRESq2eisKe7OD7tuS+oSXJq9TCUgPVztcTalkbxZRHhmbPtPsTbuHNsRDiy93lP3eiEyLyD/saUVC7upx7wkOYw4wQMjWXgalqRqUieP9rxjGvCCfDfNr1BEWT7TI0YXEUT/8nkN4s1z9QUNeosFBnmtyjsuGCOcOeTCphMiTJbSVvpUlPt3tSTrz6CsWlRc488ZKx0ihLVHtggOTjYC3t41EZKtNgZkmotZOIjITepktWMyB+FDaKV5xzyaEjlwq6BHvdn3spONMRyseLvLVY87lf9/d2hVBGdxGakFGtotfycdwnnEN27fbdZA5Eblp17W7Sb6+ubK4U2UbcxXD4HAV5X2J4Nf+RB5UZ6HzhxQfP3uVGysQ7ofdxRzD44CsKIPW68U2F8vx7YZhXoCT+ySWOxAXXQdiuuSlOTXMWpBi9pt4LOV4l+WGhkEKjAJ4i133hxU+QsDiDpcbvW+2aimaaOJMG61s0gSw2GabjcczYhsHi/jvpM/WrH+P5zLOeNpFq2QfBrU1SZJNkVtHc47myYX9iIeCfbj3UbkdZOh+ZuXXavLi4h4F/qGcXvS66Ev/zkeQezurhppVOUHoq/o8JfH5BjVyzaNy9QbrZDPws3kltuGOd4aH+s6lSnF9lrZYDljlpX5NoPzhLYoHwgrzZLBnjba8Acsu+roPWqSxYyezXpPtEqSjPi4r6uc8RXxclU7xJgiLq/Gd67lDAcR2INPDISOSGmbLp4Hp7I0hoRWmpXF6B8Jc+rBJ4APvNareCkFtNOrZZBKe8/YN08SaZ0xDYbZJYMNjWKCcUkOAlicqL4wRSfs0CrIb8FpZVKwYNAZ8ohaok0HqMjNSXnkGKTidfjfrnSGbdQIdw08YtouWOOA4LRyqsCgLNcQ841qpnSaS06XJjCiFkRpR3H7CjfJhEB21RCNOe0CtEwJDTlaVYcwFuv0Vtjgd1RkZ1SBd89qSB4wi3RGPZHulBVNXc3K5GBWqyRz+M16tio9C9po3NOZrQ8PM6oN0S5CSk+aTTG03gAA';
    return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 overflow-auto p-4 pt-8 print:p-0 print:pt-0 print:bg-white">
            <div class="bg-white shadow-2xl print:shadow-none" style="width: 210mm; min-height: 297mm;">
                <div id="certificatePrintArea" style="width: 190mm; margin: 12mm auto 10mm auto; padding: 3mm 12mm 3mm 12mm; box-sizing: border-box; font-family: 'ë§‘ì€ ê³ ë”•', 'Malgun Gothic', sans-serif; background: #fff; border: 3px solid #000;">
                    <div style="display: flex; justify-content: flex-end; margin-top: -3mm; margin-bottom: 2mm;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 14px; font-weight: bold;">ì‹œì„¤ë²ˆí˜¸</span>
                            <span style="font-size: 14px; font-weight: bold; min-width: 150px; text-align: center;">${d['ì‹œì„¤ë²ˆí˜¸'] || ''}</span>
                        </div>
                    </div>
                    
                    <!-- ë²•ë ¹ ì •ë³´ -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4mm;">
                        <div style="font-size: 11px; color: #000; font-weight: bold;">â–  ë„ì‹œê°€ìŠ¤ì‚¬ì—…ë²• ì‹œí–‰ê·œì¹™ [ë³„ì§€ ì œ22í˜¸ì˜2ì„œì‹] &lt;ê°œì • 2012.10.5&gt;</div>
                        <div style="font-size: 12px; font-weight: bold;">(ì• ìª½)</div>
                    </div>
                    
                    <!-- ì œ í˜¸ / ê¸°ì¤€ì¼ -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8mm;">
                        <div style="display: flex; align-items: center;">
                            <span style="font-size: 14px; font-weight: bold;">ì œ</span>
                            <span style="font-size: 14px; font-weight: bold; margin: 0 5px; padding: 3px 10px; border-bottom: 2px solid #000; min-width: 180px; text-align: center;">${formatCertNumber(d['í•„ì¦ë²ˆí˜¸'])}</span>
                            <span style="font-size: 14px; font-weight: bold;">í˜¸</span>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <span style="font-size: 14px; font-weight: bold; margin-right: 8px;">ê¸°ì¤€ì¼</span>
                            <span style="font-size: 14px; font-weight: bold; padding: 3px 10px; border-bottom: 2px solid #000; min-width: 120px; text-align: center;">${d['ê¸°ì¤€ì¼'] || ''}</span>
                        </div>
                    </div>
                    
                    <!-- ì œëª© -->
                    <h1 style="text-align: center; font-size: 36px; font-weight: bold; margin: 6mm 0; letter-spacing: 10px; color: #000;">ì •ê¸°ê²€ì‚¬ì¦ëª…ì„œ</h1>
                    
                    <!-- ë©”ì¸ í…Œì´ë¸” -->
                    <table style="width: 100%; border-collapse: collapse; border: 2px solid #000;">
                        <tr>
                            <td style="border: 1px solid #000; width: 18%; text-align: center; padding: 12px 5px; font-size: 14px; font-weight: bold; background: #f8f8f8;">ìƒ í˜¸</td>
                            <td style="border: 1px solid #000; width: 37%; text-align: center; padding: 12px 5px; font-size: 14px; font-weight: bold;">${d['ì‹œì„¤ëª…'] || ''}</td>
                            <td style="border: 1px solid #000; width: 15%; text-align: center; padding: 12px 5px; font-size: 14px; font-weight: bold; background: #f8f8f8;">ì‚¬ì—…ì˜ ì¢…ë¥˜</td>
                            <td style="border: 1px solid #000; width: 30%; text-align: center; padding: 12px 5px; font-size: 14px;">íŠ¹ì •ì‚¬ìš©</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px; font-weight: bold; background: #f8f8f8;">ì‚¬ë¬´ì†Œ ì†Œì¬ì§€</td>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 13px;">${d['êµ¬ì£¼ì†Œ'] || ''}</td>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px; font-weight: bold; background: #f8f8f8;">ì„±ëª…(ëŒ€í‘œì)</td>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px;">${d['ëŒ€í‘œìëª…'] || ''}</td>
                        </tr>
                        <tr>
                                <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px; font-weight: bold; background: #f8f8f8;">ì‚¬ì—…ì†Œ ì†Œì¬ì§€</td>
                                <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 12px;" colspan="3">${d['í–‰ì •êµ¬ì—­'] || ''} ${d['ìƒˆì£¼ì†Œ'] || ''}</td>
                            </tr>
                        <tr>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px; font-weight: bold; background: #f8f8f8;" rowspan="2">ê²€ì‚¬ê¸°ê´€ ì£¼ì†Œ</td>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 12px;" rowspan="2">ë¶€ì‚°ê´‘ì—­ì‹œ í•´ìš´ëŒ€êµ¬ ì„ ìˆ˜ì´Œë¡œ 169-8</td>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px; font-weight: bold; background: #f8f8f8;">ë‹´ ë‹¹ ë¶€ ì„œ</td>
                            <td style="border: 1px solid #000; text-align: right; padding: 12px 10px; font-size: 13px;">ì•ˆì „ ê²€ì‚¬íŒ€</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px; font-weight: bold; background: #f8f8f8;"></td>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px;"><span style="font-size: 16px;">â˜</span> 051) 784 - 8848</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px; font-weight: bold; background: #f8f8f8;">ê²€ ì‚¬ ì› ì„± ëª…</td>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px;">${d['ê²€ì‚¬ì›'] || ''}</td>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px; font-weight: bold; background: #f8f8f8;">ê²€ì‚¬ ì—°ì›”ì¼</td>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px;">${formatInspDate(d['ê²€ì‚¬ì¼'])}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px; font-weight: bold; background: #f8f8f8;">ì›”ì‚¬ìš©ì˜ˆì •ëŸ‰</td>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px;">${d['ì‚¬ìš©ëŸ‰'] || ''} M<sup>3</sup></td>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px; font-weight: bold; background: #f8f8f8;">ì „í™”ë²ˆí˜¸</td>
                            <td style="border: 1px solid #000; text-align: center; padding: 12px 5px; font-size: 14px;">${d['ì „í™”ë²ˆí˜¸'] || ''}</td>
                        </tr>
                    </table>
                    
                    <!-- ë²•ì  ë¬¸êµ¬ -->
                    <div style="margin-top: 12mm; padding: 8mm 5mm; text-align: center; font-size: 15px; line-height: 2.2;">
                        ã€Œë„ì‹œê°€ìŠ¤ì‚¬ì—…ë²•ã€ ì œ17ì¡°ì œ1í•­ ë° ê°™ì€ ë²• ì‹œí–‰ê·œì¹™ ì œ25ì¡°ì œ7í•­ì— ë”°ë¼<br>
                        íŠ¹ì •ê°€ìŠ¤ì‚¬ìš©ì‹œì„¤ì— ëŒ€í•˜ì—¬ ì •ê¸°ê²€ì‚¬ë¥¼ ë§ˆì³¤ìœ¼ë¯€ë¡œ ì •ê¸°ê²€ì‚¬ì¦ëª…ì„œë¥¼ ë°œê¸‰í•©ë‹ˆë‹¤.
                    </div>
                    
                    <!-- KGT ì›Œí„°ë§ˆí¬ ë¡œê³  -->
                    <div style="position: relative; margin-top: 6mm; text-align: center; height: 70px;">
                        <div style="font-size: 75px; font-weight: bold; color: rgba(180, 180, 180, 0.35); font-family: Arial, sans-serif; letter-spacing: 25px;">K G T</div>
                    </div>
                    
                    <!-- í•˜ë‹¨ ì„œëª… ì˜ì—­ -->
                    <div style="margin-top: 4mm; text-align: center; position: relative;">
                        <div style="display: inline-flex; align-items: center; gap: 15px;">
                            <span style="font-size: 22px; font-weight: bold; letter-spacing: 3px;">í•œêµ­ê°€ìŠ¤ê¸°ìˆ  ëŒ€í‘œì´ì‚¬</span>
                            <img src="${sealImage}" alt="ì§ì¸" style="width: 65px; height: 65px; vertical-align: middle;" />
                        </div>
                        <div style="margin-top: 2mm; font-size: 15px;">051) 784 - 8848</div>
                    </div>
                    
                    <!-- í•˜ë‹¨ ì—°ë½ì²˜ -->
                   <div style="margin-top: 2mm; text-align: center; font-size: 13px; padding-top: 1mm;">
                    FAX : 051 - 793 - 0665 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; E-MAIL : bskgt@naver.com
                </div>
                </div>
                
                <!-- ë²„íŠ¼ ì˜ì—­ -->
                <div class="flex gap-3 justify-center py-4 bg-gray-100 border-t print:hidden">
                    <button id="certPrintBtn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">ğŸ–¨ï¸ ì¸ì‡„</button>
                    <div class="relative">
                        <button id="certSaveBtn" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold">ğŸ’¾ ì €ì¥</button>
                     ${state.showCertSaveMenu ? `
                    <div class="absolute bottom-full mb-2 left-0 bg-white border rounded shadow-lg z-30 w-48">
                        <button id="certSavePDFBtn" class="flex items-center gap-2 w-full px-4 py-3 hover:bg-gray-100 text-left text-gray-800">ğŸ“• PDFë¡œ ì €ì¥</button>
                        <button id="certSaveExcelBtn" class="flex items-center gap-2 w-full px-4 py-3 hover:bg-gray-100 text-left border-t text-gray-800">ğŸ“Š Excelë¡œ ì €ì¥</button>
                        <button id="certSaveCSVBtn" class="flex items-center gap-2 w-full px-4 py-3 hover:bg-gray-100 text-left border-t text-gray-800">ğŸ“„ CSVë¡œ ì €ì¥</button>
                    </div>
                ` : ''}   
                    </div>
                    <button id="certCloseBtn" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-semibold">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    `;
}
       
         
        function renderInspectionSheetModal() {
    const d = state.inspectionSheetData;
    return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 overflow-auto p-2 print:p-0 print:bg-white print:overflow-visible">
    <div class="bg-white shadow-2xl print:shadow-none" style="width: 210mm; max-width: 210mm; overflow: visible;">
                <!-- ë²„íŠ¼ ì˜ì—­ -->
                <div class="flex gap-3 justify-center py-3 bg-gray-100 border-b print:hidden sticky top-0 z-10">
                    <button id="inspSheetPrintBtn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">ğŸ–¨ï¸ ì¸ì‡„</button>
                    <button id="inspSheetCloseBtn" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-semibold">ë‹«ê¸°</button>
                </div>
                
                <!-- ê²€ì‚¬í‘œ ë‚´ìš© -->
                <div id="inspectionSheetPrintArea" style="font-family: 'ë§‘ì€ ê³ ë”•', 'Malgun Gothic', sans-serif; overflow: visible;">
                    
                    <!-- 1í˜ì´ì§€ -->
                    <div class="insp-page" style="width: 210mm; height: 297mm; margin: 0 auto; padding: 3mm 10mm; box-sizing: border-box; background: #fff; page-break-after: always;">
                        <!-- ìƒë‹¨ í—¤ë” -->
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 2mm;">
                            <tr>
                                <td style="width: 50%; font-size: 12px; font-weight: bold;">${d['í•„ì¦ë²ˆí˜¸'] || ''}</td>
                                <td style="width: 50%; text-align: right;">
                                    <span style="font-size: 11px;">ê¸°ì¤€ì¼</span>
                                    <span style="font-size: 12px; font-weight: bold; margin-left: 10px;">${d['ê¸°ì¤€ì¼'] || ''}</span>
                                </td>
                            </tr>
                        </table>
                        
                        <!-- ì œëª© ë° ê²°ì¬ë€ -->
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 2mm;">
                            <tr>
                                <td style="vertical-align: middle;">
                                    <div style="font-size: 20px; font-weight: bold; text-align: center; letter-spacing: 0.1em;">íŠ¹ì •ê°€ìŠ¤ì‚¬ìš©ì‹œì„¤ ì •ê¸°ê²€ì‚¬í‘œ</div>
                                </td>
                                <td style="width: 120px; vertical-align: top;">
                                    <table style="border-collapse: collapse; font-size: 9px; float: right;">
                                        <tr>
                                            <td rowspan="2" style="border: 1px solid #000; padding: 2px 4px; background: #f0f0f0; text-align: center; writing-mode: vertical-lr;">ê²°ì¬</td>
                                            <td style="border: 1px solid #000; padding: 2px 6px; text-align: center; width: 40px;">ê²€ì‚¬ì›</td>
                                            <td style="border: 1px solid #000; padding: 2px 6px; text-align: center; width: 50px;">ê¸°ìˆ  ì±…ì„ì</td>
                                        </tr>
                                        <tr>
                                            <td style="border: 1px solid #000; height: 20px;"></td>
                                            <td style="border: 1px solid #000; height: 20px;"></td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                        
                        <!-- ì—…ì†Œ ì •ë³´ í…Œì´ë¸” -->
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 1mm; font-size: 14px;">
                            <tr>
                                <td style="border: 1px solid #000; padding: 3px 5px; width: 10%; background: #e8f5e9; font-weight: bold;">ì‹œì„¤ë²ˆí˜¸</td>
                                <td style="border: 1px solid #000; padding: 3px 5px; width: 35%;">${d['ì‹œì„¤ë²ˆí˜¸'] || ''}</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 3px 5px; background: #e8f5e9; font-weight: bold;">ì—…ì†Œëª…</td>
                                <td style="border: 1px solid #000; padding: 3px 5px; width: 35%;">${d['ì‹œì„¤ëª…'] || ''}</td>
                                <td style="border: 1px solid #000; padding: 3px 5px; width: 8%; background: #e8f5e9; font-weight: bold;">ëŒ€í‘œì</td>
                                <td style="border: 1px solid #000; padding: 3px 5px; width: 12%;">${d['ëŒ€í‘œìëª…'] || ''}</td>
                                <td style="border: 1px solid #000; padding: 3px 5px; width: 8%; background: #e8f5e9; font-weight: bold;">ì „í™”ë²ˆí˜¸</td>
                                <td style="border: 1px solid #000; padding: 3px 5px; width: 15%;">${d['ì „í™”ë²ˆí˜¸'] || ''}</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 3px 5px; background: #e8f5e9; font-weight: bold;">ì†Œì¬ì§€</td>
                                <td style="border: 1px solid #000; padding: 3px 5px; font-size: 12px;" colspan="3">${d['í–‰ì •êµ¬ì—­'] || ''} ${d['ìƒˆì£¼ì†Œ'] || ''}</td>
                                <td style="border: 1px solid #000; padding: 3px 5px; background: #e8f5e9; font-weight: bold; font-size: 9px;">(ì›”ì‚¬ìš©<br>ì˜ˆì •ëŸ‰)</td>
                                <td style="border: 1px solid #000; padding: 3px 5px;">${d['ì‚¬ìš©ëŸ‰'] || ''} m3</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 3px 5px; background: #e8f5e9; font-weight: bold;">ì•ˆì „ê´€ë¦¬ì</td>
                                <td style="border: 1px solid #000; padding: 3px 5px;">ì„±ëª… : ${d['ì•ˆì „ê´€ë¦¬ìëª…'] || ''}</td>
                                <td style="border: 1px solid #000; padding: 3px 5px; background: #e8f5e9; font-weight: bold;">ìê²©ì¦:</td>
                                <td style="border: 1px solid #000; padding: 3px 5px;">${d['ìê²©ì¦ë²ˆí˜¸'] || ''}</td>
                                <td style="border: 1px solid #000; padding: 3px 5px; background: #e8f5e9; font-weight: bold;">ë³´í—˜ê°€ì…</td>
                                <td style="border: 1px solid #000; padding: 3px 5px;">ë³´í—˜ì‚¬: ${d['ë³´í—˜ì‚¬'] || ''}</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 3px 5px; font-size: 14px;" colspan="4">${d['ë©”ëª¨'] || ''}</td>
                                <td style="border: 1px solid #000; padding: 3px 5px; background: #e8f5e9; font-weight: bold;">ê°€ì…ê¸°ê°„ :</td>
                                <td style="border: 1px solid #000; padding: 3px 5px;">${d['ë³´í—˜ë§Œê¸°ì¼'] || ''}</td>
                            </tr>
                        </table>
                        
                        <!-- ì—…ì†Œ í˜„í™© -->
                        <div style="text-align: center; font-weight: bold; font-size: 14px; margin: 2mm 0;">[ì—…ì†Œ í˜„í™©]</div>
                        <div style="text-align: center; font-weight: bold; font-size: 14px; margin-bottom: 1mm;">[ê²€ì‚¬ê¸°ì¤€,ë°©ë²• ë° ê²€ì‚¬ê²°ê³¼]</div>
                        
                        <!-- ê²€ì‚¬ í•­ëª© í…Œì´ë¸” 1í˜ì´ì§€ -->
                        <table style="width: 100%; border-collapse: collapse; font-size: 16px; line-height: 1.4;">
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">ë°°ì¹˜ê¸°ì¤€ : ë„ë²•ì‹œí–‰ê·œì¹™ ë³„í‘œ7 ì œ1í˜¸ ê°€ëª©1)</td>
                                <td style="border: 1px solid #000; padding: 2px; width: 30px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; width: 18px; text-align: center;">1.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê°€ìŠ¤ê³„ëŸ‰ê¸° ì„¤ì¹˜(í™”ê¸°ì™€ 2mì´ìƒ ì´ê²©í•˜ê³  ìˆ˜ì‹œí™˜ê¸° ê°€ëŠ¥í•œ ì¥ì†Œì— ì„¤ì¹˜í•˜ë˜ ì§ì‚¬ê´‘ì„  ë° ë¹—ë¬¼ì„ ë°›ëŠ” ê³³ì€ ê²©ë‚©ìƒì ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">2.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê°€ìŠ¤ê³„ëŸ‰ê¸° ì„¤ì¹˜ë†’ì´(ê°€ìŠ¤ê³„ëŸ‰ê¸°(30ã¥/hrë¯¸ë§Œ)ëŠ”ë°”ë‹¥ì—ì„œ 1.6mì´ìƒ 2m ì´ë‚´ì— ì„¤ì¹˜í•˜ê³  ê³ ì •ì¥ì¹˜ë¡œ ê³ ì •, ë‹¨, ê²©ë‚©ìƒì ë‚´ ì„¤ì¹˜ì‹œ ë†’ì´ì œí•œ ì—†ìŒ)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">3.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê°€ìŠ¤ê³„ëŸ‰ê¸°ì™€ ì „ê¸°ì„¤ë¹„ì™€ ì´ê²©ê±°ë¦¬(ê°€ìŠ¤ê³„ëŸ‰ê¸°ì™€ ì „ê¸°ê°œíê¸° 60Cm ì´ìƒ, ë‹¨ì—´ì¡°ì¹˜ë˜ì§€ ì•Šì€ êµ´ëš, ì „ê¸°ì „ë©¸ê¸° ë° ì „ê¸°ì ‘ì†ê¸°ì™€ 30Cm ì´ìƒ, ë¹„ ì ˆì—°ì „ì„ ê³¼ 15Cm ì´ìƒ ì´ê²©ì—¬ë¶€ í™•ì¸) ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">4.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì…ìƒê´€(í™”ê¸°ì™€ 2m ì´ìƒ ìœ ì§€, ì…ìƒê´€ ë°¸ë¸ŒëŠ” ë¶„ë¦¬ê°€ëŠ¥í•œ ê²ƒìœ¼ë¡œ ë°”ë‹¥ì—ì„œ 1.6m ì´ìƒ 2m ì´ë‚´ ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">ê°€ìŠ¤ì„¤ë¹„ê¸°ì¤€: ë„ë²•ì‹œí–‰ê·œì¹™ ë³„í‘œ7 ì œ1í˜¸ ê°€ëª©2)</td>
                                <td style="border: 1px solid #000; padding: 2px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">5.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì§€í•˜ê³µê¸‰ ì°¨ë‹¨ë°¸ë¸Œ(ì§€í•˜ì—ì„œ ê°€ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì§€ìƒì—ì„œ ì°¨ë‹¨í•  ìˆ˜ ìˆëŠ” ì¥ì¹˜ ì„¤ì¹˜, ë‹¤ë§Œ, ê±´ë¬¼ì™¸ë²½ìœ¼ë¡œ ë¶€í„° 50m ì´ë‚´ ì§€ìƒì°¨ë‹¨í•  ìˆ˜ ìˆëŠ” ì¥ì¹˜ ì„¤ì¹˜í•  ê²½ìš° ì œì™¸) FU551 2.4.1</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">6.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì••ë ¥ì¡°ì •ê¸° ì„¤ì¹˜ì¥ì†Œ(ì‹¤ì™¸ì— ì„¤ì¹˜í•  ê²ƒ ë‹¨, ë¶€ë“ì´í•˜ì—¬ ì‹¤ë‚´ì— ì„¤ì¹˜ì‹œ ìˆ˜ì‹œë¡œ í™˜ê¸° ê°€ëŠ¥í•œ ì¥ì†Œì— ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">7.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì••ë ¥ì¡°ì •ê¸° ê°€ìŠ¤ë°©ì¶œêµ¬(ë¦´ë¦¬í”„ì‹ ì•ˆì „ì¥ì¹˜ ë‚´ì¥ëœ ì¡°ì •ê¸°ë¥¼ ê±´ì¶•ë¬¼ë‚´ì— ì„¤ì¹˜ì‹œ ì‹¤ì™¸ì˜ ì•ˆì „í•œ ì¥ì†Œì— ê°€ìŠ¤ ë°©ì¶œêµ¬ ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">8.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì¤‘ê°„ë°¸ë¸Œ ì„¤ì¹˜(ì—°ì†Œê¸° ê°ê°ì— í“¨ì¦ˆì½• ì„¤ì¹˜, ë‹¤ë§Œ, ê°€ìŠ¤ì†Œë¹„ëŸ‰ 19,400kcal/hë¥¼ ì´ˆê³¼í•˜ëŠ” ì—°ì†Œê¸° ì—°ê²°ë°°ê´€ì—ëŠ” í˜¸ìŠ¤ì½• ë˜ëŠ” ë°°ê´€ìš©ë°¸ë¸Œ ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">9.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë°°ê´€ìš©ë°¸ë¸Œ ì„¤ì¹˜(ë°°ê´€ ë¶„ê¸°ì‹œ ì£¼ë°°ê´€ì— ë°°ê´€ìš©ë°¸ë¸Œ ì„¤ì¹˜, 2ê°œì´ìƒì˜ ì‹¤ë¡œ ë¶„ê¸°ì‹œ ê° ì‹¤ì˜ ì£¼ë°°ê´€ ë§ˆë‹¤ ë°°ê´€ìš© ë°¸ë¸Œ ì„¤ì¹˜, ì¤‘ê°„ë°¸ë¸Œ ë° í“¨ì¦ˆì½• ë“±ì€ ì‚¬ìš©ì••ë ¥ ë° ìœ ëŸ‰ì— ì í•©í•  ê²ƒ)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">10.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">í˜¸ìŠ¤(í˜¸ìŠ¤ì˜ ê¸¸ì´ëŠ” 3m ì´ë‚´, í˜¸ìŠ¤ "T" ì—°ê²° ë¶ˆìš©, í˜¸ìŠ¤ì˜ ì ‘ì†ë¶€ëŠ” í˜¸ìŠ¤ë°´ë“œ ë“±ìœ¼ë¡œ ê²¬ê³ íˆ ì¡°ì„)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">ë°°ê´€ì„¤ë¹„ê¸°ì¤€ : ë„ë²• ì‹œí–‰ê·œì¹™ ë³„í‘œ7 ì œ1í˜¸ ê°€ëª© 3)</td>
                                <td style="border: 1px solid #000; padding: 2px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">11.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë°°ê´€ ì´ìŒì‡ (ì£¼ì¡°í’ˆì¸ ê²½ìš° ê°€ë‹¨ì£¼ì² ì œì´ê±°ë‚˜ ì£¼ê°•ì œë¡œì„œ KS í—ˆê°€ì œí’ˆë“± ì‚¬ìš©)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">12.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì§€ë°˜ì¹¨í•˜ ìš°ë ¤ì§€ì—­(ê³¼ê±° ì§€ë°˜ì¹¨í•˜ê°€ ìš°ë ¤ë˜ëŠ” ê³³ì—ëŠ” ì„¤ì¹˜í•˜ì§€ ì•„ë‹ˆí•˜ê±°ë‚˜, ì§€ë°˜ì´ ì•½í•œ ê³³ì— ë°°ê´€ì´ ì†ìƒë˜ì§€ ì•„ë‹ˆí•˜ë„ë¡ í•„ìš”í•œ ì¡°ì¹˜ì—¬ë¶€ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- 2í˜ì´ì§€ -->
                    <div class="insp-page" style="width: 210mm; height: 297mm; margin: 0 auto; padding: 8mm 10mm; box-sizing: border-box; background: #fff; page-break-after: always;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px; line-height: 1.4;">
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">[ê²€ì‚¬ê¸°ì¤€,ë°©ë²• ë° ê²€ì‚¬ê²°ê³¼]</td>
                                <td style="border: 1px solid #000; padding: 2px; width: 30px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; width: 18px; text-align: center;">13.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">í•˜ì²œ ë˜ëŠ” ì•”ê±°ë‚´ ì„¤ì¹˜ ì œí•œ(í•˜ì²œ ë˜ëŠ” í•˜ìˆ˜êµ¬ ë“± ì•”ê±°ë‚´ ì„¤ì¹˜í•˜ì§€ ì•„ë‹ˆí•˜ë©° KGS FU551.2.5.4.3ê¸°ì¤€ì— ë”°ë¼ ì„¤ì¹˜ì—¬ë¶€ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">14.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê±´ì¶•ë¬¼ë‚´ ë°°ê´€(ë…¸ì¶œì‹œê³µ, ë‹¤ë§Œ ìŠ¤í…Œì¸ë¦¬ìŠ¤ê°•,ê¸ˆì†ì œì˜ ë³´í˜¸ê´€ ë˜ëŠ” ë³´í˜¸íŒìœ¼ë¡œ ë³´í˜¸ì¡°ì¹˜í•œ ë™ê´€,ê°€ìŠ¤ìš©ê¸ˆì†í”Œë ‰ì‹œë¸”í˜¸ìŠ¤ ë“±ì´(ìš©ì ‘ì´ìŒë§¤ë¥¼ ì œì™¸)ì—†ì´ ì„¤ì¹˜í•˜ëŠ” ê²½ìš°ëŠ” ë§¤ì„¤ ì‹œê³µê°€ëŠ¥)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">15.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">í™˜ê¸°ë¶ˆì–‘ì¥ì†Œ ì„¤ì¹˜(ìŠ¤í…Œì¸ë¦¬ìŠ¤ê°•ê´€,ë™ê´€(ë³´í˜¸ê´€ì¡°ì¹˜),ê°€ìŠ¤ìš©ê¸ˆì†í”Œë ‰ì‹œë¸”í˜¸ìŠ¤(ê¸ˆì†ì œ ë³´í˜¸ê´€ ë˜ëŠ” ë³´í˜¸íŒìœ¼ë¡œ ë³´í˜¸ì¡°ì¹˜)ë¥¼ ì´ìŒë§¤ ì—†ì´ ì„¤ì¹˜ ì‹œ ì²œì •,ë²½,ë°”ë‹¥ì— ì„¤ì¹˜ ê°€ëŠ¥)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">16.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì „ê¸°ì„¤ë¹„ì™€ ì´ê²©ê±°ë¦¬(ë°°ê´€ì´ìŒë§¤(ìš©ì ‘ì´ìŒë§¤ ì œì™¸)ì™€ ì „ê¸°ê³„ëŸ‰ê¸°ë° ì „ê¸°ê°œíê¸°: 60Cm ì´ìƒ, ë‹¨ì—´ì¡°ì¹˜ë˜ì§€ ì•Šì€ êµ´ëš, ì „ê¸°ì „ë©¸ê¸° ë° ì „ê¸°ì ‘ì†ê¸° : 15Cm ì´ìƒ, ë¹„ ì ˆì—°ì „ì„  : 15Cm ì´ìƒ ìœ ì§€ ì—¬ë¶€ë¥¼ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">17.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë°°ê´€ì˜ ê³ ì •(ë°°ê´€ì€ ê´€ê²½ 13ãœë¯¸ë§Œì€ 1më§ˆë‹¤, 13ãœì´ìƒ 33ãœë¯¸ë§Œì€ 2m ë§ˆë‹¤, 33ãœì´ìƒì€ 3më§ˆë‹¤ ê³ ì •, í˜¸ì¹­ì§€ë¦„ 100mm ì´ìƒì˜ ê²ƒì—ëŠ” KGS FU551 2.5.4.3.4 ì— ë”°ë¼ 3m ì´ˆê³¼í•˜ì—¬ ì„¤ì¹˜ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">18.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë°©í˜¸ì¡°ì¹˜ë“±(ì°¨ëŸ‰ì˜ í†µí–‰ ê·¸ ë°–ì˜ ì¶©ê²© ë“±ì— ì˜í•˜ì—¬ ì†ìƒë  ìš°ë ¤ê°€ ìˆëŠ” ê³³ì˜ ë…¸ì¶œëœ ë°°ê´€ì— ëŒ€í•˜ì—¬ KGS FU551 2.5.4.3.3. ê¸°ì¤€ì— ë”°ë¼ ë°©í˜¸ì¡°ì¹˜, ë²½ì„ í†µê³¼í•˜ëŠ” ê²½ìš° ë³´í˜¸ê´€ ë° ë¶€ì‹ë°©ì§€ í”¼ë³µì—¬ë¶€ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">19.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê¸°ë°€ì‹œí—˜(ì‚¬ìš©ì••ë ¥ ì´ìƒìœ¼ë¡œ ëˆ„ì¶œê²€ì‚¬ ì‹¤ì‹œ)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">20.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë°°ê´€ ì™¸ë¶€ì˜ í‘œì‹œì—¬ë¶€ í™•ì¸(ê°€ìŠ¤ëª…,ìµœê³ ì‚¬ìš©ì••ë ¥,ê°€ìŠ¤íë¦„ë°©í–¥ í‘œì‹œì—¬ë¶€ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">21.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë°°ê´€ì˜ ìƒ‰ìƒ(ì§€ìƒë°°ê´€:í™©ìƒ‰, ì§€í•˜ë°°ê´€:ì €ì••(í™©ìƒ‰),ì¤‘ì••(ì ìƒ‰)í™•ì¸,ì§€ìƒë°°ê´€ìœ¼ë¡œì„œ ë°”ë‹¥ì—ì„œ 1më†’ì´ì— í­ 3Cmì˜ ì´ì¤‘ë  í‘œì‹œ ê²½ìš° ìƒ‰ìƒ ì œí•œì—†ìŒ)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">ì‚¬ê³ ì˜ˆë°©ì„¤ë¹„ê¸°ì¤€ : ë„ë²• ì‹œí–‰ê·œì¹™ ë³„í‘œ7 ì œ1í˜¸ ê°€ëª©4)</td>
                                <td style="border: 1px solid #000; padding: 2px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">22.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê°€ìŠ¤ëˆ„ì¶œì°¨ë‹¨ì¥ì¹˜ ì„¤ì¹˜(ì›”ì‚¬ìš©ì˜ˆì •ëŸ‰ 2ì²œmÂ³ ë¯¸ë§Œìœ¼ë¡œ í“¨ì¦ˆì½•,ìƒìì½•ì´ ì„¤ì¹˜ë˜ì–´ ìˆê³  ê° ì—°ì†Œê¸°ì— ì†Œí™”ì•ˆì „ì¥ì¹˜ê°€ ì„¤ì¹˜ëœ ê²½ìš° ì œì™¸, ê°€ìŠ¤ëˆ„ì¶œê²½ë³´ê¸° ì—°ë™ì°¨ë‹¨ê¸°ëŠ¥ì˜ ë‹¤ê¸°ëŠ¥ê°€ìŠ¤ì•ˆì „ê³„ëŸ‰ê¸° ì„¤ì¹˜í•  ê²½ìš°ëŠ” ì œì™¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">23.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê²½ë³´ê¸° ê²€ì§€ë¶€(ì—°ì†Œê¸° ë²„ë„ˆì˜ ì¤‘ì‹¬ë¶€ë¡œë¶€í„° ìˆ˜í‰ê±°ë¦¬ 4m ì´ë‚´(ê³µê¸°ë³´ë‹¤ ê°€ë²¼ìš´ ê°€ìŠ¤ëŠ” 8m ì´ë‚´)ì— 1ê°œ ì´ìƒ ì„¤ì¹˜,ì—°ì†Œê¸° ì„¤ì¹˜ì‹¤ì´ ë³„ë„ë¡œ êµ¬ë¶„ëœ ê²½ìš° ì‹¤ë³„ë¡œ ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">24.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì°¨ë‹¨ë¶€(ì°¨ë‹¨ë¶€ëŠ” ë°°ê´€ìƒí™©ì— ë”°ë¼ ê°ê°ì˜ ì£¼ë°°ê´€ì— ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">25.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì œì–´ë¶€(ì—°ì†Œê¸° ì£¼ìœ„ì—ì„œ ì¡°ì‘í•˜ê¸° ì‰¬ìš´ ìœ„ì¹˜ì— ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">26.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì„¤ì¹˜ì œì™¸ëŒ€ìƒ(ê°€ìŠ¤ê³µê¸‰ì´ ë¶ˆì‹œì— ìë™ì°¨ë‹¨ë˜ë¯€ë¡œì„œ ì¬í•´ ë° ì†ì‚´ì´ í´ ìš°ë ¤ê°€ ìˆëŠ” ì‹œì„¤ ë“± KGS FU551 2.8.2.2.3.(4)ê¸°ì¤€ì— ë”°ë¼ ì í•© ì—¬ë¶€ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">27.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë¶€ì‹ë°©ì§€ì„¤ë¹„(ì§€í•˜ì— ë§¤ì„¤í•˜ëŠ” ê°•ê´€ì—ëŠ” ë¶€ì‹ì— ì˜í•œ ì•…ì˜í–¥ì„ ë°©ì§€í•˜ê¸° ìœ„í•˜ì—¬ KGS GC202(ê°€ìŠ¤ì‹œì„¤ ì „ê¸°ë°©ì‹ ê¸°ì¤€)ì— ë”°ë¼ ì „ê¸°ë¶€ì‹ë°©ì§€ì¡°ì¹˜ ì—¬ë¶€ í™•ì¸ T/Bì„¤ì¹˜ í™•ì¸: í¬ìƒì–‘ê·¹ë²•, ë°°ë¥˜ë²•: 300m/ê°œì†Œ, ì™¸ë¶€ì „ì›ë²• : 500m/ê°œì†Œ, ë°©ì‹ì „ìœ„ -0.85Vì´í•˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">ë‹¨ë…ì‚¬ìš©ììš©ì •ì••ê¸° ë°°ì¹˜ê¸°ì¤€ : ë„ë²• ì‹œí–‰ê·œì¹™ ë³„í‘œ7 ì œ2í˜¸ ê°€ëª© 1)</td>
                                <td style="border: 1px solid #000; padding: 2px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">28.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì„¤ì¹˜ìœ„ì¹˜(ê±´ì¶•ë¬¼ ë‚´ë¶€ ë˜ëŠ” ê¸°ì´ˆë°‘ì— ì„¤ì¹˜ ë¶ˆê°€,(ë‹¤ë§Œ, ë¶€ë“ì´í•˜ê²Œ ê±´ì¶•ë¬¼ì™¸ë¶€ì— ì„¤ì¹˜í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ë¡œì„œ ì™¸ë¶€ì— í™˜ê¸°ê°€ ì˜ ë˜ëŠ” ì§€ìƒì¸µì— ì„¤ì¹˜í•˜ê±°ë‚˜ ì™¸ë¶€ì— í™˜ê¸°ê°€ ì˜ ë˜ê³  ê¸°ê³„í™˜ê¸°ì„¤ë¹„ë¥¼ ê°–ì¶˜ ì§€í•˜ì¸µì— ì„¤ì¹˜ ê°€ëŠ¥)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">ë‹¨ë…ì‚¬ìš©ììš©ì •ì••ê¸° ê°€ìŠ¤ì„¤ë¹„ê¸°ì¤€ : ë„ë²• ì‹œí–‰ê·œì¹™ ë³„í‘œ7 ì œ2í˜¸ ê°€ëª© 2)</td>
                                <td style="border: 1px solid #000; padding: 2px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">29.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì •ì••ê¸°ì‹¤ì˜ êµ¬ì¡° ë° ì¬ë£Œ ë“±(ì² ê·¼ì½˜í¬ë¦¬íŠ¸ ë“± ë¶ˆì—°ì¬ë£Œ ì‚¬ìš©í•˜ê³ , ë‚´ë¶€ëŠ” ê·¸ ì¡°ì‘ì— í•„ìš”í•œ ê³µê°„ í™•ë³´)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">30.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">íƒ€ì‹œì„¤ë¬¼ ì„¤ì¹˜ê¸ˆì§€(ì •ì••ê¸°ì‹¤ì—ëŠ” ê°€ìŠ¤ê³µê¸‰ì‹œì„¤ ì™¸ì˜ ì‹œì„¤ë¬¼ ì„¤ì¹˜ê¸ˆì§€)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- 3í˜ì´ì§€ -->
                    <div class="insp-page" style="width: 210mm; height: 297mm; margin: 0 auto; padding: 8mm 10mm; box-sizing: border-box; background: #fff; page-break-after: always;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px; line-height: 1.4;">
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">[ê²€ì‚¬ê¸°ì¤€,ë°©ë²• ë° ê²€ì‚¬ê²°ê³¼]</td>
                                <td style="border: 1px solid #000; padding: 2px; width: 30px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; width: 18px; text-align: center;">31.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì¹¨ìˆ˜ë°©ì§€ì¡°ì¹˜(ì§€í•˜ì— ì„¤ì¹˜í•˜ëŠ” ì •ì••ê¸°ì‹¤ì€ ì¹¨ìˆ˜ë°©ì§€ì¡°ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">32.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ëˆ„ì¶œê²€ì‚¬(ì‚¬ìš©ì••ë ¥ ì´ìƒìœ¼ë¡œ ëˆ„ì¶œê²€ì‚¬ ì‹¤ì‹œ)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">ë‹¨ë…ì‚¬ìš©ììš©ì •ì••ê¸° ì‚¬ê³ ì˜ˆë°©ì„¤ë¹„ê¸°ì¤€ : ë„ë²• ì‹œí–‰ê·œì¹™ ë³„í‘œ7 ì œ2í˜¸ ê°€ëª© 3)</td>
                                <td style="border: 1px solid #000; padding: 2px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">33.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê³¼ì••ì•ˆì „ì¥ì¹˜(ì •ì••ê¸°ì—ëŠ” ì•ˆì „ë°¸ë¸Œ ë° ê°€ìŠ¤ë°©ì¶œê´€ì„ ì„¤ì¹˜í•˜ê³  ê°€ìŠ¤ë°©ì¶œê´€ì˜ ë°©ì¶œêµ¬ëŠ” ì£¼ìœ„ì— ë¶ˆ ë“±ì´ ì—†ëŠ” ì•ˆì „í•œ ìœ„ì¹˜ë¡œì„œ ì§€ë©´ì—ì„œ 5m ì´ìƒì˜ ë†’ì´ì— ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">34.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê°€ìŠ¤ëˆ„ì¶œê²€ì§€í†µë³´ì„¤ë¹„(ê²€ì§€ë¶€ëŠ” ë°”ë‹¥ë©´ì  ë‘˜ë ˆ 20m ë‹¹ 1ê°œ ì´ìƒì˜ ìˆ˜ëŸ‰(ì•ˆì „ê´€ë¦¬ìê°€ ìƒì£¼í•˜ëŠ” ê³³ì— í†µë³´í•  ìˆ˜ ìˆëŠ” ì„¤ë¹„ë¥¼ ê°–ì¶”ê³  ì •ê¸°ì ìœ¼ë¡œ ì ê²€)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">35.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê²½ë³´ì¥ì¹˜(ì´ìƒì••ë ¥ í†µë³´ì„¤ë¹„ë¥¼ ì•ˆì „ê´€ë¦¬ìê°€ ìƒì£¼í•˜ëŠ” ê³³ì— ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">36.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì „ê¸°ë°©í­ì„¤ë¹„(ì •ì••ê¸°ì‹¤ì˜ ì „ê¸°ì„¤ë¹„ëŠ” KGS GC201(ê°€ìŠ¤ì‹œì„¤ ì „ê¸°ë°©í­ ê¸°ì¤€)ì— ë”°ë¼ì í•©í•˜ê²Œ ì„¤ì¹˜ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">37.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">í™˜ê¸°ì„¤ë¹„(í†µí’êµ¬ëŠ” ë°”ë‹¥ë©´ì— ì ‘í•˜ê³  ì™¸ê¸°ì— ë©´í•˜ì—¬ ì„¤ì¹˜ëœ í™˜ê¸°êµ¬ì˜ í†µí’ ê°€ëŠ¥ë©´ì ì˜ í•©ê³„ê°€ ë°”ë‹¥ë©´ì  1mÂ² ë§ˆë‹¤ 300CmÂ²(ì² ë§ì´ ì°¨ì§€í•˜ëŠ” ë©´ì  ì œí•¨)ì˜ ë¹„ìœ¨ë¡œ ê³„ì‚°ëœ ë©´ì ì´ìƒ)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">38.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë¶ˆìˆœë¬¼ì œê±°(ì •ì••ê¸° ì…êµ¬ì— ë¶ˆìˆœë¬¼ì œê±°ì¥ì¹˜ ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">39.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë™ê²°ë°©ì§€ì¥ì¹˜(ê°€ìŠ¤ì¤‘ ìˆ˜ë¶„ì´ ë™ê²°ë¡œ ì¸í•´ ì •ì••ê¸°ëŠ¥ì„ ì €í•´í•  ìš°ë ¤ê°€ ìˆëŠ” ê²½ìš° ë™ê²°ë°©ì§€ì¥ì¹˜ ë“± í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">ë‹¨ë…ì‚¬ìš©ììš©ì •ì••ê¸° í”¼í•´ì €ê°ì„¤ë¹„ê¸°ì¤€ : ë„ë²• ì‹œí–‰ê·œì¹™ ë³„í‘œ7 ì œ2í˜¸ ê°€ëª© 4)</td>
                                <td style="border: 1px solid #000; padding: 2px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">40.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê°€ìŠ¤ì°¨ë‹¨ì¥ì¹˜ ì„¤ì¹˜(ì •ì••ê¸°ì˜ ì…êµ¬,ì¶œêµ¬ì—ëŠ” ê°€ìŠ¤ì°¨ë‹¨ì¥ì¹˜ë¥¼ ì„¤ì¹˜ ì—¬ë¶€ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">41.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì§€ìƒì°¨ë‹¨ì¥ì¹˜(ì§€í•˜ì •ì••ê¸°ì‹¤ì˜ ê²½ìš° ì™¸ë¶€ì— ì¶”ê°€ë¡œ, ì§€ìƒì°¨ë‹¨ì¥ì¹˜ ì„¤ì¹˜, ì •ì••ê¸°ì‹¤ ì™¸ë²½ìœ¼ë¡œë¶€í„° 50mì´ë‚´ ê°€ìŠ¤ê³µê¸‰ì„ ì§€ìƒì—ì„œ ì‰½ê²Œ ì°¨ë‹¨í•  ìˆ˜ ìˆëŠ” ì¥ì¹˜ë¥¼ ì„¤ì¹˜í•  ê²½ìš°ì—ëŠ” ì œì™¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">ë‹¨ë…ì‚¬ìš©ììš©ì •ì••ê¸° ë¶€ëŒ€ì„¤ë¹„ê¸°ì¤€ : ë„ë²• ì‹œí–‰ê·œì¹™ ë³„í‘œ7 ì œ2í˜¸ ê°€ëª© 5), 6)</td>
                                <td style="border: 1px solid #000; padding: 2px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">42.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë°”ì´íŒ¨ìŠ¤ê´€(ì •ì••ê¸°ì— ë°”ì´íŒ¨ìŠ¤ê´€ì„ ì„¤ì¹˜í•˜ëŠ” ê²½ìš°ì— ë°¸ë¸Œì„¤ì¹˜, ë°¸ë¸Œì— ì ê¸ˆì¡°ì¹˜ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">43.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì••ë ¥ê¸°ë¡ì¥ì¹˜(ì •ì••ê¸° ì¶œêµ¬ì— ê°€ìŠ¤ì••ë ¥ ì¸¡ì • ê¸°ë¡ì¥ì¹˜ ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">44.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì •ì••ê¸°ì™€ í•„í„° ë¶„í•´ì ê²€(ìµœì´ˆ 3ë…„ì— 1íšŒ ì´ìƒ&lt;ê·¸ ì´í›„ 4ë…„ì— 1íšŒì´ìƒ&gt;ë¶„í•´ì ê²€ ë° ì‘ë™ìƒí™© ì ê²€ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">ì—°ì†Œê¸° ì„¤ì¹˜ê¸°ì¤€ : ë„ë²• ì‹œí–‰ê·œì¹™ ë³„í‘œ7 ì œ3í˜¸</td>
                                <td style="border: 1px solid #000; padding: 2px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">45.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê°€ìŠ¤ì˜¨ìˆ˜ê¸° ë˜ëŠ” ê°€ìŠ¤ë³´ì¼ëŸ¬(ê°€ìŠ¤ì˜¨ìˆ˜ê¸°(ë³´ì¼ëŸ¬) ì„¤ì¹˜ì¥ì†Œ,ì„¤ì¹˜ë°©ë²•ì€ KGS GC 208 2017, KGS GC 209 2017, FU 551 ê¸°ì¤€ì— ë”°ë¼ ì í•©í•˜ê²Œ ì„¤ì¹˜ì—¬ë¶€ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">46.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê°œë°©í˜•ì—°ì†Œê¸° ì„¤ì¹˜ì‹¤(í™˜í’ê¸°ë‚˜ í™˜ê¸°êµ¬ ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">47.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë°˜ë°€íí˜•ì—°ì†Œê¸°(ê¸‰ê¸°êµ¬ ë° ë°°ê¸°í†µ ì„¤ì¹˜, ë°°ê¸°í†µì´ ê°€ì—°ì„± ë¬¼ì§ˆì˜ ì²œì • ë²½ ë“± í†µê³¼ì‹œ ê¸ˆì† ì™¸ì˜ ë¶ˆì—°ì¬ë£Œë¡œ ë‹¨ì—´ì¡°ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">48.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë°°ê¸°í†µ êµ¬ì¡° ë° ì¬ë£Œ(ë°°ê¸°í†µ ëì€ ë°°ê¸°ê°€ ë°©í•´ë°›ì§€ ì•ŠëŠ” êµ¬ì¡°ì´ê³ , ë°°ê¸°ê°€ ë°©í•´ë°›ì§€ ì•ŠëŠ” ìœ„ì¹˜ì— ì„¤ì¹˜ í™•ì¸, ì¬ë£ŒëŠ” ìŠ¤í…Œì¸ë¦¬ìŠ¤ê°•íŒì´ë‚˜ ë‚´ì—´,ë‚´ì‹ì„± ì¬ë£Œ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- 4í˜ì´ì§€ (3/4 í¬ê¸°) -->
                    <div class="insp-page" style="width: 210mm; height: 223mm; margin: 0 auto; padding: 2mm 10mm 8mm 10mm; box-sizing: border-box; background: #fff;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px; line-height: 1.4;">
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">[ê²€ì‚¬ê¸°ì¤€,ë°©ë²• ë° ê²€ì‚¬ê²°ê³¼]</td>
                                <td style="border: 1px solid #000; padding: 2px; width: 30px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; width: 18px; text-align: center;">49.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë°€íí˜•ì—°ì†Œê¸°(ê¸‰ê¸°êµ¬, ë°°ê¸°í†µê³¼ ë²½ê³¼ ì‚¬ì´ì— ë°°ê¸°ê°€ìŠ¤ê°€ ì‹¤ë‚´ë¡œ ìœ ì…ë˜ì§€ ì•Šë„ë¡ ë°€íì¡°ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">50.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë°°ê¸°íŒ¬ ë“±(ìì—°ë°°ê¸°ì‹ ë°˜ë°€íí˜• ë° ë°€íí˜•ì—°ì†Œê¸°ì˜ ë°°ê¸°í†µëì€ ë°°ê¸°ê°€ ë°©í•´ë˜ì§€ ì•„ë‹ˆí•˜ëŠ” êµ¬ì¡°ì´ê³  ì¥ì• ë¬¼ ë˜ëŠ” ì™¸ê¸°ì˜ íë¦„ìœ¼ë¡œ ë°°ê¸°ê°€ ë°©í•´ë°›ì§€ ì•„ë‹ˆí•˜ëŠ” ìœ„ì¹˜ì— ì„¤ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">51.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ë°°ê¸°íŒ¬ì˜ ë°°ê¸°ê°€ìŠ¤ ì ‘ì´‰ë¶€ë¶„(ë°€íí˜• ë˜ëŠ” ë°˜ë°€íí˜• ì—°ì†Œê¸°ì˜ ë°°ê¸°íŒ¬ê³¼ ë°°ê¸°ê°€ìŠ¤ ì ‘ì´‰ë¶€ë¶„ì€ ë¶ˆì—°ì„± ì¬ë£Œ)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">ê·¸ ë°–ì˜ ê¸°ì¤€: ë„ë²• : ë„ë²• ì‹œí–‰ê·œì¹™ ë³„í‘œ7 ì œ1í˜¸ 5), ì œ2í˜¸ 6) ë° ì œ3í˜¸ 3)</td>
                                <td style="border: 1px solid #000; padding: 2px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">52.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê°€ìŠ¤ìš©í’ˆ(ê²€ì‚¬ëŒ€ìƒì— í•´ë‹¹ë˜ëŠ” ê²½ìš° ê²€ì‚¬í•©ê²©í’ˆ ì—¬ë¶€ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr style="background: #fff3e0;">
                                <td style="border: 1px solid #000; padding: 2px 4px; font-weight: bold;" colspan="2">ê¸°ìˆ  ê¸°ì¤€: ë„ë²• : ë„ë²• ì‹œí–‰ê·œì¹™ ë³„í‘œ7 ì œ1í˜¸, ì œ2í˜¸ ì œ3í˜¸ ë‚˜ëª©</td>
                                <td style="border: 1px solid #000; padding: 2px; text-align: center; font-weight: bold;">íŒì •</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">53.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ì„¤ë¹„ì‘ë™ìƒí™© ì ê²€(ê°€ìŠ¤ì‚¬ìš©ìëŠ” 1ì¼1íšŒì´ìƒ ì„¤ë¹„ì˜ ì‘ë™ìƒí™©ì„ ì ê²€í•˜ê³  ì´ìƒ ìˆì„ì‹œ ì¦‰ì‹œ ë³´ìˆ˜ ë“± í•„ìš” ì¡°ì¹˜)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">54.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê°€ìŠ¤ì‹œì„¤ì ê²€(ì••ë ¥ì¡°ì •ê¸°ëŠ” ë§¤ 1ë…„ì— 1íšŒì´ìƒ &lt;í•„í„° ë˜ëŠ” ìŠ¤íŠ¸ë ˆì´ë„ˆ ì²­ì†ŒëŠ” 3ë…„ì— 1íšŒ(ê·¸ì´í›„ëŠ” 4ë…„ì— 1íšŒ ì´ìƒ)ì´ìƒ&gt; ì‘ë™ìœ ë¬´ ë° ì•ˆì „ì ê²€ í™•ì¸, ì •ì••ê¸°ì™€ í•„í„°ì˜ ê²½ìš° ì„¤ì¹˜í›„ 3ë…„ 1íšŒ ì´ìƒ(ê·¸ ì´í›„ 4ë…„ì— 1íšŒ ì´ìƒ)ë¶„í•´ì ê²€ ì‹¤ì‹œ ë° ì‘ë™ìƒí™©ì„ ì ê²€í•˜ê³  ê·¸ ì‹œì„¤ì´ë‚˜ ì„¤ë¹„ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™ë  ìˆ˜ ìˆë„ë¡ ì¡°ì¹˜ í™•ì¸, 1ì£¼ì¼ì— 1íšŒ ì´ìƒ ì‘ë™ìƒí™© ì ê²€ í™•ì¸) FU551 3.3.4, 3.3.6ì—ì˜í•œ ì ê²€</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">55.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">ê°€ìŠ¤ëˆ„ì¶œê²½ë³´ê¸° ì ê²€(ì •ì••ê¸°ì‹¤ì— ì„¤ì¹˜ëœ ê°€ìŠ¤ëˆ„ì¶œê²½ë³´ê¸° 1ì£¼ì¼ì— 1íšŒì´ìƒ ì‘ë™ìƒí™© ì ê²€ ë° ì‘ë™ì´ ë¶ˆëŸ‰í•  ë•Œì—ëŠ” ì¦‰ì‹œ êµì²´ ë˜ëŠ” ìˆ˜ë¦¬ ë“± ì •ìƒì ì¸ ì‘ë™ì—¬ë¶€ í™•ì¸)</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 1px; text-align: center;">56.</td>
                                <td style="border: 1px solid #000; padding: 1px 3px;">COê²€ì§€ê¸° ì„¤ì¹˜ ì—¬ë¶€ í™•ì¸</td>
                                <td style="border: 1px solid #000; padding: 1px;"></td>
                            </tr>
                        </table>
                        
                        <div style="margin-top: 2mm; font-size: 16px; color: #333;">*ì‘ì„±ë°©ë²•: íŒì •ë€ì— ì í•©(â—‹), ë¶€ì í•©(Ã—), í•´ë‹¹ì—†ìŒ(/)ìœ¼ë¡œ í‘œê¸°</div>
                        
                        <!-- ê²€ì‚¬ì› ì˜ê²¬ -->
                        <div style="margin-top: 3mm;">
                            <div style="font-weight: bold; font-size: 14px; margin-bottom: 1mm;">[ê²€ì‚¬ì› ì˜ê²¬ë“±]</div>
                            <table style="width: 100%; border-collapse: collapse; font-size: 16px;">
                                <tr>
                                    <td style="border: 1px solid #000; padding: 4px 6px; background: #f5f5f5; font-weight: bold; width: 18%;">ê³ ê°í™•ì¸</td>
                                    <td style="border: 1px solid #000; padding: 4px 6px; height: 20px;"></td>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #000; padding: 4px 6px; background: #f5f5f5; font-weight: bold; vertical-align: top;">ì ê²€ê²°ê³¼ íŠ¹ì´ì‚¬í•­<br>ë° ê²€ì‚¬ì› ì˜ê²¬ë“±</td>
                                    <td style="border: 1px solid #000; padding: 4px 6px; height: 50px;"></td>
                                </tr>
                            </table>
                        </div>
                        
                        <!-- ê²€ì‚¬ê²°ê³¼ -->
                        <div style="margin-top: 3mm;">
                            <div style="font-weight: bold; font-size: 14px; margin-bottom: 1mm;">[ê²€ì‚¬ê²°ê³¼]</div>
                            <table style="width: 100%; border-collapse: collapse; font-size: 16px;">
                                <tr>
                                    <td style="border: 1px solid #000; padding: 5px; text-align: center; width: 25%; font-size: 14px;">${d['ì‹œì„¤ë²ˆí˜¸'] || ''}</td>
                                    <td style="border: 1px solid #000; padding: 5px; text-align: center; width: 30%; font-size: 14px;">${d['ì‹œì„¤ëª…'] || ''}</td>
                                    <td style="border: 1px solid #000; padding: 5px;" colspan="2"></td>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #000; padding: 4px 6px; background: #f5f5f5; font-weight: bold; text-align: center;">ê²€ì‚¬ì¼ì</td>
                                    <td style="border: 1px solid #000; padding: 4px 6px; text-align: center;">${d['ê²€ì‚¬ì¼'] || ''}</td>
                                    <td style="border: 1px solid #000; padding: 4px 6px; background: #f5f5f5; font-weight: bold; text-align: center; width: 15%;">ê²€ì‚¬ê²°ê³¼</td>
                                    <td style="border: 1px solid #000; padding: 4px 6px; text-align: center;">${d['ê²€ì‚¬ê²°ê³¼'] || 'ì í•©,ë¶€ì í•©'}</td>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #000; padding: 4px 6px; background: #f5f5f5; font-weight: bold; text-align: center;">ê²€ì‚¬ì</td>
                                    <td style="border: 1px solid #000; padding: 4px 6px; text-align: center;">${d['ê²€ì‚¬ì›'] || ''}</td>
                                    <td style="border: 1px solid #000; padding: 4px 6px; text-align: center;">ê²€ì‚¬í™•ì¸</td>
                                    <td style="border: 1px solid #000; padding: 4px 6px; text-align: right;">(ì¸)</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}   

            function initMap(locations) {
            const mapContainer = document.getElementById('mapContainer');
            if (!mapContainer || typeof kakao === 'undefined') { setTimeout(() => initMap(locations), 500); return; }
            kakao.maps.load(function() {
                const mapOption = { center: new kakao.maps.LatLng(35.1796, 129.0756), level: 7 };
                const map = new kakao.maps.Map(mapContainer, mapOption);
                const geocoder = new kakao.maps.services.Geocoder();
                const bounds = new kakao.maps.LatLngBounds();
                let processedCount = 0;
                let totalCount = locations.length;
                locations.forEach((location) => {
                    const address = location['ìƒˆì£¼ì†Œ'];
                    if (!address) { processedCount++; return; }
                    geocoder.addressSearch(address, function(result, status) {
                        processedCount++;
                        state.mapLoadingProgress = Math.floor((processedCount / totalCount) * 100);
                        if (status === kakao.maps.services.Status.OK && result[0]) {
                            const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                            bounds.extend(coords);
                            const marker = new kakao.maps.Marker({ position: coords, map: map });
                            const customOverlay = new kakao.maps.CustomOverlay({
                                position: coords,
                                content: '<div style="padding:3px 8px;background:#fff;border:1px solid #333;border-radius:4px;font-size:11px;font-weight:bold;white-space:nowrap;box-shadow:1px 1px 3px rgba(0,0,0,0.3);">' + location['ì‹œì„¤ëª…'] + '</div>',
                                yAnchor: 2.5, map: map
                            });
                        }
                        if (processedCount === totalCount) {
                            setTimeout(function() { if (!bounds.isEmpty()) map.setBounds(bounds); state.isLoadingMap = false; }, 300);
                        }
                    });
                });
            });
        }

        // ======================== ë¶„ê¸° íƒ­ ê´€ë ¨ í•¨ìˆ˜ ========================
        function getQuarterFilteredData() {
            const qColumns = ['ì‹œì„¤ë²ˆí˜¸', 'ì‹œì„¤ëª…', 'í–‰ì •êµ¬ì—­', 'ìƒˆì£¼ì†Œ', 'ê¸°ì¤€ì¼', 'ê²€ì‚¬ì¼', 'í•„ì¦ë²ˆí˜¸'];
            const currentAppData = state.applicationData[state.targetYear] || [];
            let filteredData = currentAppData.filter(row => row['ê²€ì‚¬ê²°ê³¼'] === 'í•©ê²©');
            if (state.quarter.selectedQuarter) {
                const quarterMonths = { '1ë¶„ê¸°': [1, 2, 3], '2ë¶„ê¸°': [4, 5, 6], '3ë¶„ê¸°': [7, 8, 9], '4ë¶„ê¸°': [10, 11, 12] };
                const months = quarterMonths[state.quarter.selectedQuarter] || [];
                filteredData = filteredData.filter(row => {
                    const baseDate = row['ê¸°ì¤€ì¼'];
                    if (!baseDate) return false;
                    const month = parseInt(baseDate.split('-')[1]);
                    return months.includes(month);
                });
            }
            if (state.quarter.selectedRecipient) {
                const regions = state.quarter.recipients[state.quarter.selectedRecipient] || [];
                filteredData = filteredData.filter(row => {
                    const rowRegion = row['í–‰ì •êµ¬ì—­'] || '';
                    return regions.some(r => rowRegion.includes(r) || rowRegion === r);
                });
            }
            filteredData.sort((a, b) => (a['í–‰ì •êµ¬ì—­'] || '').localeCompare(b['í–‰ì •êµ¬ì—­'] || '', 'ko'));
            return { filteredData, quarterColumns: qColumns };
        }

        function downloadQuarterExcel() {
            const { filteredData, quarterColumns: qColumns } = getQuarterFilteredData();
            if (filteredData.length === 0) { alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
            const exportData = filteredData.map(row => { const obj = {}; qColumns.forEach(col => { obj[col] = row[col] || ''; }); return obj; });
            const worksheet = XLSX.utils.json_to_sheet(exportData, { header: qColumns });
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'ë¶„ê¸°í˜„í™©');
            XLSX.writeFile(workbook, `ë¶„ê¸°í˜„í™©_${state.targetYear}ë…„_${state.quarter.selectedQuarter || 'ì „ì²´'}_${state.quarter.selectedRecipient || 'ì „ì²´'}_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        function downloadQuarterCSV() {
            const { filteredData, quarterColumns: qColumns } = getQuarterFilteredData();
            if (filteredData.length === 0) { alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
            const csvContent = [qColumns.join(','), ...filteredData.map(row => qColumns.map(col => { const value = row[col] || ''; return value.includes(',') || value.includes('"') ? `"${value.replace(/"/g, '""')}"` : value; }).join(','))].join('\n');
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ë¶„ê¸°í˜„í™©_${state.targetYear}ë…„_${state.quarter.selectedQuarter || 'ì „ì²´'}_${state.quarter.selectedRecipient || 'ì „ì²´'}_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function printQuarterReport() {
            const { filteredData, quarterColumns: qColumns } = getQuarterFilteredData();
            if (filteredData.length === 0) { alert('ì¸ì‡„í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
            const groupedData = {};
            filteredData.forEach(row => { const region = row['í–‰ì •êµ¬ì—­'] || 'ê¸°íƒ€'; if (!groupedData[region]) groupedData[region] = []; groupedData[region].push(row); });
            const ROWS_PER_PAGE = 34;
            let pages = [];
            Object.keys(groupedData).sort((a, b) => a.localeCompare(b, 'ko')).forEach(region => {
                const regionData = groupedData[region];
                for (let i = 0; i < regionData.length; i += ROWS_PER_PAGE) {
                    pages.push({ region: region, data: regionData.slice(i, i + ROWS_PER_PAGE) });
                }
            });
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html><html><head><title>ë¶„ê¸°ë³„ ê²€ì‚¬í˜„í™©</title>
                <style>
                    @page { size: A4 portrait; margin: 10mm; }
                    body { font-family: 'Malgun Gothic', sans-serif; font-size: 10px; }
                    .page { page-break-after: always; } .page:last-child { page-break-after: avoid; }
                    table { width: 100%; border-collapse: collapse; }
                    th, td { border: 1px solid #333; padding: 3px 5px; text-align: left; }
                    th { background-color: #2563eb; color: white; font-size: 9px; }
                    td { font-size: 9px; }
                    .header-info { margin-bottom: 10px; font-size: 12px; font-weight: bold; }
                    .page-info { text-align: right; font-size: 9px; margin-bottom: 5px; }
                </style></head><body>
                ${pages.map((page, pageIdx) => `
                    <div class="page">
                        <div class="header-info">${state.targetYear}ë…„ ${state.quarter.selectedQuarter || ''} ê²€ì‚¬í˜„í™© ${state.quarter.selectedRecipient ? `- ${state.quarter.selectedRecipient}` : ''}</div>
                        <div class="page-info">í˜ì´ì§€ ${pageIdx + 1} / ${pages.length} | í–‰ì •êµ¬ì—­: ${page.region}</div>
                        <table><thead><tr><th style="width:25px;">No</th>${qColumns.map(col => `<th>${col}</th>`).join('')}</tr></thead>
                        <tbody>${page.data.map((row, idx) => `<tr><td>${idx + 1}</td>${qColumns.map(col => `<td>${row[col] || ''}</td>`).join('')}</tr>`).join('')}</tbody></table>
                    </div>
                `).join('')}
                </body></html>
            `);
            printWindow.document.close();
            setTimeout(() => { printWindow.print(); }, 500);
        }
        // ======================== ë Œë”ë§ í•¨ìˆ˜ ========================
        function render() {
            try {
                updateFilters();
                const app = document.getElementById('app');
                if (!app) { console.error('#app ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
                app.innerHTML = renderApp();
                attachEventListeners();
            } catch (error) {
                console.error('ë Œë”ë§ ì˜¤ë¥˜:', error);
                const app = document.getElementById('app');
                if (app) app.innerHTML = `<div class="p-6 bg-red-100 border border-red-400 text-red-700 rounded">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}</div>`;
            }
        }

        function renderApp() {
            return `
                <div class="min-h-screen bg-gradient-to-b from-sky-400 to-sky-200">
                    ${renderHeader()}
                    ${renderTabs()}
                    <div class="container mx-auto px-4 py-6">${renderContent()}</div>
                    ${renderFooter()}
                    ${state.isLoading ? renderLoadingModal() : ''}
                    ${state.showDuplicateModal ? renderDuplicateModal() : ''}
                    ${state.showDeleteModal ? renderDeleteModal() : ''}
                    ${state.showAppDeleteModal ? renderAppDeleteModal() : ''}
                    ${state.showDetailModal ? renderDetailModal() : ''}
                    ${state.showAppDetailModal ? renderAppDetailModal() : ''}
                    ${state.showMapModal ? renderMapModal() : ''}
                    ${state.showCertificateModal ? renderCertificateModal() : ''}
                     ${state.showInspectionSheetModal ? renderInspectionSheetModal() : ''}
                </div>
            `;
        }

        function renderHeader() {
            const years = Array.from({ length: 10 }, (_, i) => state.currentYear - i);
            return `
                <div class="bg-gradient-to-r from-sky-400 to-sky-500 text-white">
                    <div class="container mx-auto px-4 py-6">
                        <div class="flex items-center justify-between flex-wrap gap-4">
                            <div>
                                <h1 class="text-3xl font-bold">ê³µì¸ê²€ì‚¬ê¸°ê´€</h1>
                                <p class="text-lg">ì•ˆì „ê´€ë¦¬ì‹œìŠ¤í…œ v2.1</p>
                            </div>
                            <div class="text-right">
                                <label class="block text-sm mb-1">ë‹¹í•´ ì—°ë„</label>
                                <select id="yearSelect" class="px-4 py-2 text-gray-900 rounded border-2 border-white">
                                    ${years.map(year => `<option value="${year}" ${year === state.selectedYear ? 'selected' : ''}>${year}ë…„</option>`).join('')}
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTabs() {
            const tabs = ['í†µí•©', 'ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥', 'ë¶„ê¸°', 'ê²½ë¡œë‹¹', 'ë§¤ì¶œë¶„ì„', 'ì·¨ì†Œ', 'ìë£Œì‹¤', 'ê´€ë¦¬ì'];
            return `
                <div class="bg-white border-b shadow-sm">
                    <div class="container mx-auto px-4">
                        <div class="flex gap-1 overflow-x-auto">
                            ${tabs.map(tab => `
                                <button class="tab-btn px-6 py-3 font-semibold whitespace-nowrap ${state.activeTab === tab ? 'bg-blue-600 text-white border-b-4 border-blue-800' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}" data-tab="${tab}">${tab}</button>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderContent() {
            if (state.showWelcome && Object.keys(state.data).length === 0 && state.activeTab === 'í†µí•©') return renderWelcome();
            if (state.activeTab === 'ê´€ë¦¬ì') return renderAdmin();
            if (state.activeTab === 'ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥') return renderApplicationTab();
            if (state.activeTab === 'ë¶„ê¸°') return renderQuarterTab();
            if (state.activeTab === 'ë§¤ì¶œë¶„ì„') return renderSalesAnalysisTab();
            if (state.activeTab === 'ê²½ë¡œë‹¹') return renderPathwayTab();
            if (state.activeTab === 'ìë£Œì‹¤') return renderResourceTab();
            if (state.activeTab === 'ì·¨ì†Œ') return renderCancellationTab();
            return renderMainTab();
        }

        function renderWelcome() {
            return `
                <div class="flex items-center justify-center min-h-96">
                    <div class="bg-white p-12 rounded-2xl shadow-2xl max-w-2xl text-center">
                        <h2 class="text-4xl font-bold mb-6 text-blue-600">ğŸ‘‹ í™˜ì˜í•©ë‹ˆë‹¤!</h2>
                        <p class="text-xl mb-8 text-gray-700">ê³µì¸ê²€ì‚¬ê¸°ê´€ ì•ˆì „ê´€ë¦¬ì‹œìŠ¤í…œ</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <button id="sampleDataBtn" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-6 rounded-xl hover:from-blue-600 hover:to-blue-700 shadow-lg transform hover:scale-105 transition-all">
                                <div class="text-4xl mb-3">ğŸ¯</div>
                                <div class="text-lg font-bold mb-2">ìƒ˜í”Œ ë°ì´í„°</div>
                                <div class="text-sm opacity-90">í…ŒìŠ¤íŠ¸ìš© 2ê±´ ìƒì„±</div>
                            </button>
                            <label class="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-6 rounded-xl hover:from-green-600 hover:to-green-700 shadow-lg transform hover:scale-105 transition-all cursor-pointer">
                                <div class="text-4xl mb-3">ğŸ“</div>
                                <div class="text-lg font-bold mb-2">íŒŒì¼ ì—…ë¡œë“œ</div>
                                <div class="text-sm opacity-90">Excel/CSV ê°€ì ¸ì˜¤ê¸°</div>
                                <input type="file" id="welcomeFileInput" accept=".csv,.xlsx,.xls" class="hidden" />
                            </label>
                        </div>
                        <button id="emptyStartBtn" class="mt-6 text-gray-500 hover:text-gray-700 underline">ë¹ˆ í™”ë©´ìœ¼ë¡œ ì‹œì‘</button>
                    </div>
                </div>
            `;
        }

        function renderAdmin() {
            if (!state.showAdmin) {
                return `
                    <div class="flex items-center justify-center h-96">
                        <div class="bg-white p-8 rounded-lg shadow-lg w-96">
                            <h2 class="text-xl font-bold mb-4">ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
                            <input type="password" id="adminPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" class="w-full px-4 py-2 border rounded mb-4" />
                            <button id="adminLoginBtn" class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">ë¡œê·¸ì¸</button>
                        </div>
                    </div>
                `;
            }
            const totalMainData = Object.values(state.data).reduce((sum, yearData) => sum + yearData.length, 0);
            const totalAppData = Object.values(state.applicationData).reduce((sum, yearData) => sum + (yearData ? yearData.length : 0), 0);
            return `
                <div class="p-6 bg-white rounded-lg">
                    <h2 class="text-2xl font-bold mb-6">ì‹œìŠ¤í…œ ê´€ë¦¬</h2>
                    <div class="space-y-6">
                        <div class="border-b pb-4">
                            <h3 class="text-lg font-semibold mb-4">ì‹œìŠ¤í…œ ì •ë³´</h3>
                            <div class="bg-gray-50 p-4 rounded space-y-2 text-sm">
                                <p><strong>ë²„ì „:</strong> 2.1.0</p>
                                <p><strong>ì „ì²´ ë°ì´í„°:</strong> ${totalMainData}ê±´</p>
                                <p><strong>ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥:</strong> ${totalAppData}ê±´</p>
                                <p><strong>ì €ì¥ ê³µê°„:</strong> ${getStorageSize()} MB / ~5 MB</p>
                            </div>
                        </div>
                        <div class="border-b pb-4">
                            <h3 class="text-lg font-semibold mb-4 text-red-600">ìœ„í—˜ êµ¬ì—­</h3>
                            <button id="clearAllBtn" class="w-full bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 font-semibold">ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMainTab() {
            const uniqueRegions = [...new Set((state.data[state.selectedYear] || []).map(row => (row['í–‰ì •êµ¬ì—­'] || '').replace(/[\\\/]/g, '').trim()).filter(Boolean))].sort();
            const totalPages = Math.ceil(state.filteredData.length / state.itemsPerPage);
            const paginatedData = state.filteredData.slice((state.currentPage - 1) * state.itemsPerPage, state.currentPage * state.itemsPerPage);

            return `
                <div>
                    <div class="bg-white rounded-lg p-4 mb-4 shadow">
                        <div class="flex gap-2 mb-4 flex-wrap">
                            <button id="uploadBtn" class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">ğŸ“¤ ì—…ë¡œë“œ</button>
                            <div class="relative">
                                <button id="downloadBtn" class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</button>
                                ${state.showDownloadMenu ? `
                                    <div class="absolute top-full mt-1 right-0 bg-white border rounded shadow-lg z-20 w-48">
                                        <button id="downloadExcelBtn" class="flex items-center gap-2 w-full px-4 py-3 hover:bg-gray-100 text-left">ğŸ“Š Excel ë‹¤ìš´ë¡œë“œ</button>
                                        <button id="downloadCSVBtn" class="flex items-center gap-2 w-full px-4 py-3 hover:bg-gray-100 text-left border-t">ğŸ“„ CSV ë‹¤ìš´ë¡œë“œ</button>
                                    </div>
                                ` : ''}
                            </div>
                            <button id="sampleBtn" class="flex items-center gap-2 bg-teal-600 text-white px-4 py-2 rounded hover:bg-teal-700">ğŸ¯ ìƒ˜í”Œ ë°ì´í„°</button>
                            <button id="editToggleBtn" class="flex items-center gap-2 bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">âœï¸ ${state.isEditing ? 'ì™„ë£Œ' : 'í¸ì§‘'}</button>
                            <button id="saveBtn" class="flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">ğŸ’¾ ì €ì¥</button>
                            <button id="copyBtn" class="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">ğŸ“‹ ì‹ ì²­</button>
                            <button id="deleteBtn" class="flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">ğŸ—‘ï¸ ì‚­ì œ</button>
                            <button id="detailBtn" class="flex items-center gap-2 bg-pink-600 text-white px-4 py-2 rounded hover:bg-pink-700">ğŸ‘ï¸ ìƒì„¸ë³´ê¸°/ì¶”ê°€</button>
                        </div>
                        ${state.uploadedFileName ? `
                            <div class="mb-4 px-3 py-2 bg-blue-50 border border-blue-200 rounded text-sm flex items-center justify-between">
                                <span>ğŸ“‚ <strong>${state.uploadedFileName}</strong> (${(state.data[state.selectedYear] || []).length}ê±´)</span>
                                ${state.lastSaved ? `<span class="text-gray-600 text-xs">ë§ˆì§€ë§‰ ì €ì¥: ${state.lastSaved.toLocaleTimeString()}</span>` : ''}
                            </div>
                        ` : ''}
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-2">
                            <div class="relative">
                                <label class="block text-xs font-semibold mb-1">í–‰ì •êµ¬ì—­</label>
                                <button id="regionDropdownBtn" class="w-full px-2 py-1 border rounded text-left text-xs bg-white hover:bg-gray-50">
                                    ${state.filters.region.length === 0 ? 'ì„ íƒ...' : state.filters.region.join(', ')}
                                </button>
                                ${state.showRegionDropdown ? `
                                    <div class="absolute top-full left-0 right-0 border border-t-0 rounded-b bg-white z-50 max-h-32 overflow-y-auto text-xs">
                                        <div class="space-y-1 p-1">
                                            ${uniqueRegions.length === 0 ? `<div class="text-gray-400 py-2 px-1">ë°ì´í„° ì—†ìŒ</div>` : `
                                                <label class="flex items-center cursor-pointer hover:bg-blue-50 px-1 py-0.5 rounded">
                                                    <input type="checkbox" id="selectAllRegions" ${state.filters.region.length === uniqueRegions.length && uniqueRegions.length > 0 ? 'checked' : ''} class="mr-1" />
                                                    <span class="font-semibold text-blue-700">ì „ì²´</span>
                                                </label>
                                                ${uniqueRegions.map(region => `
                                                    <label class="flex items-center cursor-pointer hover:bg-gray-50 px-1 py-0.5 rounded region-checkbox">
                                                        <input type="checkbox" value="${region}" ${state.filters.region.includes(region) ? 'checked' : ''} class="mr-1" />
                                                        <span>${region}</span>
                                                    </label>
                                                `).join('')}
                                            `}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                            <div>
                                <label class="block text-xs font-semibold mb-1">ê²€ìƒ‰</label>
                                <div class="flex gap-1">
                                    <input type="text" id="searchInput" value="${state.searchTerm}" placeholder="ê²€ìƒ‰..." class="flex-1 px-2 py-1 border rounded text-xs" />
                                    <button id="searchBtn" class="px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs">ğŸ”</button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold mb-1">ê¸°ì¤€ì›”</label>
                                <select id="mainBaseMonthFilter" class="w-full px-2 py-1 border rounded text-xs">
                                    <option value="">ì „ì²´</option>
                                    ${Array.from({length: 12}, (_, i) => `<option value="${i+1}" ${state.filters.month === String(i+1) ? 'selected' : ''}>${i+1}ì›”</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold mb-1">ê²€ì‚¬ì´ë ¥</label>
                                <select id="mainInspectionHistoryFilter" class="w-full px-2 py-1 border rounded text-xs">
                                    <option value="">ì „ì²´</option>
                                    <option value="Y" ${state.filters.inspectionHistory === 'Y' ? 'selected' : ''}>Y</option>
                                    <option value="N" ${state.filters.inspectionHistory === 'N' ? 'selected' : ''}>N</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold mb-1">í•„í„° ì´ˆê¸°í™”</label>
                                <button id="mainFilterResetBtn" class="w-full px-2 py-1 bg-gray-500 text-white rounded hover:bg-gray-600 text-xs">ğŸ”„ ì´ˆê¸°í™”</button>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="overflow-x-auto" style="max-height: 600px;">
                            <table class="w-full border-collapse" style="table-layout: fixed; min-width: 2520px;">
                                <thead class="bg-blue-600 text-white sticky top-0 z-10">
                                    <tr>
                                        <th class="border px-2 py-2 sticky left-0 bg-blue-600 z-20" style="width: 50px;">
                                            <input type="checkbox" id="selectAllRows" ${state.selectedRows.size === state.filteredData.length && state.filteredData.length > 0 ? 'checked' : ''} />
                                        </th>
                                        ${columns.map(col => `<th class="border px-3 py-2 text-sm" style="width: 120px;"><div class="truncate" title="${col}">${col}</div></th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${paginatedData.map((row, idx) => {
                                        const actualIdx = (state.currentPage - 1) * state.itemsPerPage + idx;
                                        return `
                                           <tr class="${state.selectedRows.has(actualIdx) ? 'bg-yellow-100' : 'hover:bg-gray-50'}">
                                                <td class="border px-2 py-2 text-center sticky left-0 ${state.selectedRows.has(actualIdx) ? 'bg-yellow-100' : 'bg-white'} z-10" style="width: 50px;">
                                                    <input type="checkbox" class="row-checkbox" data-idx="${actualIdx}" ${state.selectedRows.has(actualIdx) ? 'checked' : ''} />
                                                </td>
                                                ${columns.map(col => `
                                                    <td class="border px-3 py-2 text-sm" style="width: 120px; max-width: 120px;">
                                                        ${state.isEditing ? `
                                                            <input type="text" value="${row[col] || ''}" class="table-cell-input cell-edit" data-idx="${actualIdx}" data-col="${col}" />
                                                        ` : `
                                                            <div class="truncate ${col === 'ì‚¬ìš©ëŸ‰' ? 'text-right' : ''}" title="${row[col] || '-'}">${col === 'ì‚¬ìš©ëŸ‰' ? (formatCurrency(row[col]) || '-') : (row[col] || '-')}</div>
                                                        `}
                                                    </td>
                                                `).join('')}
                                            </tr>
                                        `;
                                    }).join('')}
                                    ${paginatedData.length === 0 ? `<tr><td colspan="${columns.length + 2}" class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">ğŸ“‹</div><div>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div></td></tr>` : ''}
                                </tbody>
                            </table>
                        </div>
                        <div class="flex items-center justify-between px-4 py-3 border-t bg-gray-50">
                            <div class="text-sm text-gray-600">
                                ì „ì²´ ${state.filteredData.length}ê±´
                                ${state.filteredData.length > 0 ? ` ì¤‘ ${((state.currentPage - 1) * state.itemsPerPage) + 1}-${Math.min(state.currentPage * state.itemsPerPage, state.filteredData.length)}ê±´ í‘œì‹œ` : ''}
                                ${state.selectedRows.size > 0 ? ` (${state.selectedRows.size}ê±´ ì„ íƒë¨)` : ''}
                            </div>
                            <div class="flex items-center gap-2">
                                <button id="prevPageBtn" ${state.currentPage === 1 ? 'disabled' : ''} class="p-2 border rounded hover:bg-gray-100 disabled:opacity-50">â—€</button>
                                <span class="px-4 py-2">${state.currentPage} / ${totalPages || 1}</span>
                                <button id="nextPageBtn" ${state.currentPage === totalPages || totalPages === 0 ? 'disabled' : ''} class="p-2 border rounded hover:bg-gray-100 disabled:opacity-50">â–¶</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderApplicationTab() {
            const currentAppData = state.applicationData[state.targetYear] || [];
            const uniqueAppRegions = [...new Set(currentAppData.map(row => row['í–‰ì •êµ¬ì—­']).filter(Boolean))].sort();
            let filteredApplicationData = currentAppData.map((row, idx) => row !== null && row !== undefined ? {...row, _originalIdx: idx} : null).filter(row => row !== null);
            
            if (state.applicationFilters.region.length > 0) filteredApplicationData = filteredApplicationData.filter(row => state.applicationFilters.region.includes(row['í–‰ì •êµ¬ì—­']));
            if (state.applicationFilters.inspector) filteredApplicationData = filteredApplicationData.filter(row => row['ê²€ì‚¬ì›'] === state.applicationFilters.inspector);
            if (state.applicationFilters.inspectionResult) {
            if (state.applicationFilters.inspectionResult === 'ê³µë€') {
                filteredApplicationData = filteredApplicationData.filter(row => !row['ê²€ì‚¬ê²°ê³¼'] || row['ê²€ì‚¬ê²°ê³¼'] === '' || row['ê²€ì‚¬ê²°ê³¼'] === 'ê³µë€');
            } else {
                filteredApplicationData = filteredApplicationData.filter(row => row['ê²€ì‚¬ê²°ê³¼'] === state.applicationFilters.inspectionResult);
            }
        }
            if (state.applicationFilters.applicationDateTo) filteredApplicationData = filteredApplicationData.filter(row => row['ì‹ ì²­ì¼'] <= state.applicationFilters.applicationDateTo);
            if (state.applicationFilters.inspectionDateFrom) filteredApplicationData = filteredApplicationData.filter(row => row['ê²€ì‚¬ì¼'] >= state.applicationFilters.inspectionDateFrom);
            if (state.applicationFilters.inspectionDateTo) filteredApplicationData = filteredApplicationData.filter(row => row['ê²€ì‚¬ì¼'] <= state.applicationFilters.inspectionDateTo);
            if (state.applicationFilters.fee) filteredApplicationData = filteredApplicationData.filter(row => String(row['ìˆ˜ìˆ˜ë£Œ']).includes(state.applicationFilters.fee));
            if (state.applicationSearchTerm) filteredApplicationData = filteredApplicationData.filter(row => Object.values(row).some(val => String(val).toLowerCase().includes(state.applicationSearchTerm.toLowerCase())));
            
            filteredApplicationData.sort((a, b) => { const certA = a['í•„ì¦ë²ˆí˜¸'] || ''; const certB = b['í•„ì¦ë²ˆí˜¸'] || ''; if (!certA && !certB) return 0; if (!certA) return -1; if (!certB) return 1; return certB.localeCompare(certA); });
            
            const totalAppPages = Math.ceil(filteredApplicationData.length / state.itemsPerPage);
            const paginatedAppData = filteredApplicationData.slice((state.currentApplicationPage - 1) * state.itemsPerPage, state.currentApplicationPage * state.itemsPerPage);

            return `
                <div>
                    <div class="bg-white rounded-lg p-4 mb-4 shadow">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-1">í•´ë‹¹ë…„ë„</label>
                                    <select id="targetYearSelect" class="px-3 py-2 border rounded">
                                        ${state.yearRange.map(year => `<option value="${year}" ${year === state.targetYear ? 'selected' : ''}>${year}ë…„</option>`).join('')}
                                    </select>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-1">ê²€ì‚¬ì˜ˆì •ë…„ë„</label>
                                    <select id="inspectionYearSelect" class="px-3 py-2 border rounded">
                                        ${state.yearRange.map(year => `<option value="${year}" ${year === state.inspectionYear ? 'selected' : ''}>${year}ë…„</option>`).join('')}
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-2 mb-4 flex-wrap">
                            <button id="appUploadBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">ğŸ“¤ ì—…ë¡œë“œ</button>
                            <button id="appAddRowBtn" class="px-4 py-2 bg-teal-600 text-white rounded hover:bg-teal-700">í–‰ ì¶”ê°€</button>
                            <button id="appDeleteRowBtn" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">ğŸ—‘ï¸ í–‰ ì‚­ì œ</button>
                            <button id="appEditToggleBtn" class="px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700">${state.isEditingApplication ? 'í¸ì§‘ì™„ë£Œ' : 'í¸ì§‘'}</button>
                            <button id="appSaveBtn" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">ì €ì¥</button>
                            <div class="relative">
                                <button id="appDownloadBtn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</button>
                                ${state.showAppDownloadMenu ? `
                                    <div class="absolute top-full mt-1 right-0 bg-white border rounded shadow-lg z-20 w-48">
                                        <button id="appDownloadExcelBtn" class="flex items-center gap-2 w-full px-4 py-3 hover:bg-gray-100 text-left">ğŸ“Š Excel ë‹¤ìš´ë¡œë“œ</button>
                                        <button id="appDownloadCSVBtn" class="flex items-center gap-2 w-full px-4 py-3 hover:bg-gray-100 text-left border-t">ğŸ“„ CSV ë‹¤ìš´ë¡œë“œ</button>
                                    </div>
                                ` : ''}
                            </div>
                            <button id="appMapBtn" class="px-4 py-2 bg-green-700 text-white rounded hover:bg-green-800">ğŸ—ºï¸ MAP</button>
                            <button id="cutBtn" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">âœ‚ï¸ ë‚´ë…„ìœ¼ë¡œ</button>
                            <button id="cancelBtn" class="px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700">ì·¨ì†Œ</button>
                            <button id="appDetailBtn" class="px-4 py-2 bg-pink-600 text-white rounded hover:bg-pink-700">ğŸ‘ï¸ ìƒì„¸ë³´ê¸°</button>
                            <button id="certificateBtn" class="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700">ğŸ“œ ì¦ëª…ì„œ</button>
                            <button id="inspectionSheetBtn" class="px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700">ğŸ“‹ ê²€ì‚¬í‘œ</button>
                                   </div>
                        <div class="grid grid-cols-4 gap-4 mb-4">
                            <div><label class="block text-sm font-semibold mb-1">í–‰ì •êµ¬ì—­</label><select id="appRegionFilter" class="w-full px-3 py-2 border rounded text-sm"><option value="">ì „ì²´</option>${uniqueAppRegions.map(r => `<option value="${r}" ${state.applicationFilters.region.includes(r) ? 'selected' : ''}>${r}</option>`).join('')}</select></div>
                            <div><label class="block text-sm font-semibold mb-1">ê²€ì‚¬ì›</label><select id="appInspectorFilter" class="w-full px-3 py-2 border rounded text-sm"><option value="">ì„ íƒ</option>${state.inspectors.map(i => `<option value="${i}" ${state.applicationFilters.inspector === i ? 'selected' : ''}>${i}</option>`).join('')}</select></div>
                            <div><label class="block text-sm font-semibold mb-1">ê²€ì‚¬ê²°ê³¼</label><select id="appResultFilter" class="w-full px-3 py-2 border rounded text-sm"><option value="">ì„ íƒ</option>${state.inspectionResults.map(r => `<option value="${r}" ${state.applicationFilters.inspectionResult === r ? 'selected' : ''}>${r}</option>`).join('')}</select></div>
                            <div><label class="block text-sm font-semibold mb-1">ì ‘ìˆ˜ì²˜</label><select id="appReceiptFilter" class="w-full px-3 py-2 border rounded text-sm"><option value="">ì„ íƒ</option>${state.receiptLocations.map(l => `<option value="${l}" ${state.applicationFilters.receiptLocation === l ? 'selected' : ''}>${l}</option>`).join('')}</select></div>
                        </div>
                        <div class="grid grid-cols-4 gap-4 mb-4">
                            <div><label class="block text-sm font-semibold mb-1">ì‹ ì²­ì¼</label><div class="flex gap-1"><input type="date" id="appDateFrom" value="${state.applicationFilters.applicationDateFrom}" class="flex-1 px-2 py-2 border rounded text-sm" /><input type="date" id="appDateTo" value="${state.applicationFilters.applicationDateTo}" class="flex-1 px-2 py-2 border rounded text-sm" /></div></div>
                            <div><label class="block text-sm font-semibold mb-1">ê²€ì‚¬ì¼</label><div class="flex gap-1"><input type="date" id="appInspDateFrom" value="${state.applicationFilters.inspectionDateFrom}" class="flex-1 px-2 py-2 border rounded text-sm" /><input type="date" id="appInspDateTo" value="${state.applicationFilters.inspectionDateTo}" class="flex-1 px-2 py-2 border rounded text-sm" /></div></div>
                            <div><label class="block text-sm font-semibold mb-1">ê¸°ì¤€ì›”</label><select id="appBaseMonthFilter" class="w-full px-3 py-2 border rounded text-sm"><option value="">ì„ íƒ</option>${Array.from({length: 12}, (_, i) => `<option value="${i+1}" ${state.applicationFilters.baseMonth === String(i+1) ? 'selected' : ''}>${i+1}ì›”</option>`).join('')}</select></div>
                            <div><label class="block text-sm font-semibold mb-1">ìˆ˜ìˆ˜ë£Œ</label><input type="text" id="appFeeFilter" value="${state.applicationFilters.fee}" placeholder="ìˆ˜ìˆ˜ë£Œ ì…ë ¥" class="w-full px-3 py-2 border rounded text-sm" /></div>
                        </div>
                        <div class="flex gap-4 items-end mb-4">
                            <div class="flex-1"><label class="block text-sm font-semibold mb-1">ê²€ìƒ‰</label><div class="flex gap-1"><input type="text" id="appSearchInput" value="${state.applicationSearchTerm}" placeholder="ì‹œì„¤ëª…, ì‹œì„¤ë²ˆí˜¸, ì£¼ì†Œ ë“± ê²€ìƒ‰..." class="flex-1 px-3 py-2 border rounded text-sm" /><button id="appSearchBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">ğŸ”</button></div></div>
                            <button id="appFilterResetBtn" class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 text-sm">ğŸ”„ í•„í„° ì´ˆê¸°í™”</button>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="overflow-x-auto" style="max-height: 600px;">
                            <table class="w-full border-collapse text-sm" style="table-layout: fixed; min-width: 2600px;">
                                <thead class="bg-blue-600 text-white sticky top-0 z-10">
                                    <tr>
                                     <th class="border px-2 py-2 sticky left-0 top-0 bg-blue-600 z-30" style="width: 50px;"><input type="checkbox" id="selectAllAppRows" ${state.selectedApplicationRows.size === filteredApplicationData.length && filteredApplicationData.length > 0 ? 'checked' : ''} /></th>  
                                      ${applicationColumns.map((col, colIdx) => `<th class="border px-2 py-2 ${colIdx === 0 ? 'sticky left-[50px] top-0 bg-blue-600 z-30' : colIdx === 1 ? 'sticky left-[170px] top-0 bg-blue-600 z-30' : ''}" style="width: ${columnWidths[col]};"><div class="truncate" title="${col}">${col}</div></th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${paginatedAppData.map((row, idx) => {
                                        const originalIdx = row._originalIdx;
                                        return `
                                            <tr class="${state.selectedApplicationRows.has(originalIdx) ? 'bg-yellow-200' : 'hover:bg-gray-50'}">
                                                <td class="border px-2 py-1 text-center sticky left-0 z-10 ${state.selectedApplicationRows.has(originalIdx) ? 'bg-yellow-200' : 'bg-white'}" style="width: 50px;"><input type="checkbox" class="app-row-checkbox" data-idx="${originalIdx}" ${state.selectedApplicationRows.has(originalIdx) ? 'checked' : ''} /></td>
${applicationColumns.map((col, colIdx) => `
    <td class="border px-2 py-1 text-sm ${colIdx === 0 ? 'sticky left-[50px] z-10 ' + (state.selectedApplicationRows.has(originalIdx) ? 'bg-yellow-200' : 'bg-white') : colIdx === 1 ? 'sticky left-[170px] z-10 ' + (state.selectedApplicationRows.has(originalIdx) ? 'bg-yellow-200' : 'bg-white') : ''}" style="width: ${columnWidths[col]};">
                                                        ${state.isEditingApplication ? `
                                                            ${col.includes('ì¼') ? `<input type="date" value="${row[col] || ''}" class="table-cell-input app-cell-edit" data-idx="${originalIdx}" data-col="${col}" />` :
                                                            col === 'ê²€ì‚¬ì›' ? `<select class="table-cell-input app-cell-edit" data-idx="${originalIdx}" data-col="${col}"><option value="">ì„ íƒ</option>${state.inspectors.map(i => `<option value="${i}" ${i === row[col] ? 'selected' : ''}>${i}</option>`).join('')}</select>` :
                                                            col === 'ê²€ì‚¬ê²°ê³¼' ? `<select class="table-cell-input app-cell-edit" data-idx="${originalIdx}" data-col="${col}"><option value="">ì„ íƒ</option>${state.inspectionResults.map(r => `<option value="${r}" ${r === row[col] ? 'selected' : ''}>${r}</option>`).join('')}</select>` :
                                                            col === 'ì ‘ìˆ˜ì²˜' ? `<select class="table-cell-input app-cell-edit" data-idx="${originalIdx}" data-col="${col}"><option value="">ì„ íƒ</option>${state.receiptLocations.map(l => `<option value="${l}" ${l === row[col] ? 'selected' : ''}>${l}</option>`).join('')}</select>` :
                                                            `<input type="text" value="${row[col] || ''}" class="table-cell-input app-cell-edit" data-idx="${originalIdx}" data-col="${col}" />`}
                                                        ` : `<div class="truncate ${col === 'ìˆ˜ìˆ˜ë£Œ' || col === 'ì‚¬ìš©ëŸ‰' ? 'text-right' : ''}" title="${row[col] || '-'}">${col === 'ìˆ˜ìˆ˜ë£Œ' || col === 'ì‚¬ìš©ëŸ‰' ? (formatCurrency(row[col]) || '-') : (row[col] || '-')}</div>`}
                                                    </td>
                                                `).join('')}
                                            </tr>
                                        `;
                                    }).join('')}
                                    ${paginatedAppData.length === 0 ? `<tr><td colspan="${applicationColumns.length + 2}" class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">ğŸ“‹</div><div>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div></td></tr>` : ''}
                                </tbody>
                            </table>
                        </div>
                        <div class="flex items-center justify-between px-4 py-3 border-t bg-gray-50">
                            <div class="text-sm text-gray-600">ì „ì²´ ${filteredApplicationData.length}ê±´ ${state.selectedApplicationRows.size > 0 ? ` (${state.selectedApplicationRows.size}ê±´ ì„ íƒë¨)` : ''}</div>
                            <div class="flex items-center gap-2">
                                <button id="appPrevPageBtn" ${state.currentApplicationPage === 1 ? 'disabled' : ''} class="p-2 border rounded hover:bg-gray-100 disabled:opacity-50">â—€</button>
                                <span class="px-4 py-2">${state.currentApplicationPage} / ${totalAppPages || 1}</span>
                                <button id="appNextPageBtn" ${state.currentApplicationPage === totalAppPages || totalAppPages === 0 ? 'disabled' : ''} class="p-2 border rounded hover:bg-gray-100 disabled:opacity-50">â–¶</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderQuarterTab() {
            const qColumns = ['ì‹œì„¤ë²ˆí˜¸', 'ì‹œì„¤ëª…', 'í–‰ì •êµ¬ì—­', 'ìƒˆì£¼ì†Œ', 'ê¸°ì¤€ì¼', 'ê²€ì‚¬ì¼', 'í•„ì¦ë²ˆí˜¸'];
            const recipientList = Object.keys(state.quarter.recipients);
            const currentAppData = state.applicationData[state.targetYear] || [];
            let filteredData = currentAppData.filter(row => row['ê²€ì‚¬ê²°ê³¼'] === 'í•©ê²©');
            if (state.quarter.selectedQuarter) {
                const quarterMonths = { '1ë¶„ê¸°': [1, 2, 3], '2ë¶„ê¸°': [4, 5, 6], '3ë¶„ê¸°': [7, 8, 9], '4ë¶„ê¸°': [10, 11, 12] };
                const months = quarterMonths[state.quarter.selectedQuarter] || [];
                filteredData = filteredData.filter(row => { const baseDate = row['ê²€ì‚¬ì¼']; if (!baseDate) return false; const month = parseInt(baseDate.split('-')[1]); return months.includes(month); });
            }
            if (state.quarter.selectedRecipient) {
                const regions = state.quarter.recipients[state.quarter.selectedRecipient] || [];
                filteredData = filteredData.filter(row => { const rowRegion = row['í–‰ì •êµ¬ì—­'] || ''; return regions.some(r => rowRegion.includes(r) || rowRegion === r); });
            }
            filteredData.sort((a, b) => (a['í–‰ì •êµ¬ì—­'] || '').localeCompare(b['í–‰ì •êµ¬ì—­'] || '', 'ko'));

            return `
                <div>
                    <div class="bg-blue-50 border border-blue-300 rounded-lg p-4 mb-4"><h2 class="text-xl font-bold text-blue-800 flex items-center gap-2"><span>ğŸ“Š</span> ë¶„ê¸°ë³„ ê²€ì‚¬í˜„í™©: ${state.targetYear}ë…„</h2></div>
                    <div class="bg-white rounded-lg p-4 mb-4 shadow">
                        <div class="flex gap-4 items-end flex-wrap">
                            <div><label class="block text-sm font-semibold mb-1">í•´ë‹¹ë…„ë„</label><select id="quarterTargetYearSelect" class="px-3 py-2 border rounded">${state.yearRange.map(year => `<option value="${year}" ${year === state.targetYear ? 'selected' : ''}>${year}ë…„</option>`).join('')}</select></div>
                            <div><label class="block text-sm font-semibold mb-1">ë¶„ê¸° ì„ íƒ</label><select id="quarterSelect" class="px-3 py-2 border rounded"><option value="">ì „ì²´</option>${state.quarter.quarters.map(q => `<option value="${q}" ${state.quarter.selectedQuarter === q ? 'selected' : ''}>${q}</option>`).join('')}</select></div>
                            <div><label class="block text-sm font-semibold mb-1">ìˆ˜ì‹ ì²˜</label><select id="recipientSelect" class="px-3 py-2 border rounded min-w-[200px]"><option value="">ì „ì²´</option>${recipientList.map(r => `<option value="${r}" ${state.quarter.selectedRecipient === r ? 'selected' : ''}>${r}</option>`).join('')}</select></div>
                            <button id="quarterDownloadExcelBtn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">ğŸ“¥ Excel ë‹¤ìš´ë¡œë“œ</button>
                            <button id="quarterDownloadCSVBtn" class="px-4 py-2 bg-teal-600 text-white rounded hover:bg-teal-700">ğŸ“„ CSV ë‹¤ìš´ë¡œë“œ</button>
                            <button id="quarterPrintBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">ğŸ–¨ï¸ ì¸ì‡„</button>
                            <button id="quarterResetBtn" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">ğŸ”„ ì´ˆê¸°í™”</button>
                        </div>
                    </div>
                    <div id="quarterPrintArea" class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="overflow-x-auto" style="max-height: 600px;">
                            <table class="w-full border-collapse text-sm" style="table-layout: fixed;">
                                <thead class="bg-blue-600 text-white sticky top-0 z-10">
                                    <tr><th class="border px-2 py-2" style="width: 50px;">No</th>${qColumns.map(col => `<th class="border px-2 py-2" style="width: ${col === 'ìƒˆì£¼ì†Œ' ? '250px' : col === 'ì‹œì„¤ëª…' ? '150px' : col === 'ì‹œì„¤ë²ˆí˜¸' ? '130px' : col === 'í•„ì¦ë²ˆí˜¸' ? '140px' : '100px'};">${col}</th>`).join('')}</tr>
                                </thead>
                                <tbody>
                                    ${filteredData.map((row, idx) => `<tr class="hover:bg-gray-50"><td class="border px-2 py-1 text-center">${idx + 1}</td>${qColumns.map(col => `<td class="border px-2 py-1 text-sm"><div class="truncate" title="${row[col] || '-'}">${row[col] || '-'}</div></td>`).join('')}</tr>`).join('')}
                                    ${filteredData.length === 0 ? `<tr><td colspan="${qColumns.length + 1}" class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">ğŸ“Š</div><div>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div><div class="text-sm mt-2">ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥ì—ì„œ ê²€ì‚¬ê²°ê³¼ê°€ "í•©ê²©"ì¸ ë°ì´í„°ë§Œ í‘œì‹œë©ë‹ˆë‹¤.</div></td></tr>` : ''}
                                </tbody>
                            </table>
                        </div>
                        <div class="flex items-center justify-between px-4 py-3 border-t bg-gray-50"><div class="text-sm text-gray-600">ì „ì²´ ${filteredData.length}ê±´ ${state.quarter.selectedQuarter ? ` | ${state.quarter.selectedQuarter}` : ''} ${state.quarter.selectedRecipient ? ` | ${state.quarter.selectedRecipient}` : ''}</div></div>
                    </div>
                </div>
            `;
        }

        function renderCancellationTab() {
    const currentCancelData = state.cancellationData[state.targetYear] || [];
    const cancelColsHtml = cancellationColumns.map(function(col) {
        const width = col === 'ìƒˆì£¼ì†Œ' ? '200px' : col === 'ì‹œì„¤ëª…' ? '150px' : '100px';
        return '<th class="border px-2 py-2" style="width: ' + width + ';"><div class="truncate" title="' + col + '">' + col + '</div></th>';
    }).join('');
    const yearOptionsHtml = state.yearRange.map(function(year) {
        const selected = year === state.targetYear ? 'selected' : '';
        return '<option value="' + year + '" ' + selected + '>' + year + 'ë…„</option>';
    }).join('');
    let rowsHtml = '';
    if (currentCancelData.length === 0) {
        rowsHtml = '<tr><td colspan="' + (cancellationColumns.length + 2) + '" class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">ğŸš«</div><div>ì·¨ì†Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div></td></tr>';
    } else {
        currentCancelData.forEach(function(row, idx) {
            const cellsHtml = cancellationColumns.map(function(col) {
                const val = row[col] || '-';
                return '<td class="border px-2 py-1 text-sm"><div class="truncate" title="' + val + '">' + val + '</div></td>';
            }).join('');
            const isSelected = state.selectedCancellationRows.has(idx);
            rowsHtml += '<tr class="' + (isSelected ? 'bg-yellow-100' : 'hover:bg-gray-50') + '"><td class="border px-2 py-1 text-center"><input type="checkbox" class="cancel-row-checkbox" data-idx="' + idx + '" ' + (isSelected ? 'checked' : '') + ' /></td><td class="border px-2 py-1 text-center">' + (idx + 1) + '</td>' + cellsHtml + '</tr>';
        });
    }
    return '<div>' +
        '<div class="bg-orange-50 border border-orange-300 rounded-lg p-4 mb-4">' +
            '<h2 class="text-xl font-bold text-orange-800 flex items-center gap-2"><span>ğŸš«</span> ì·¨ì†ŒëŒ€ì¥: ' + state.targetYear + 'ë…„</h2>' +
            '<p class="text-sm text-orange-600 mt-1">ì´ ' + currentCancelData.length + 'ê±´</p>' +
        '</div>' +
        '<div class="bg-white rounded-lg p-4 mb-4 shadow">' +
            '<div class="flex gap-4 items-center mb-4">' +
                '<div><label class="block text-sm font-semibold mb-1">í•´ë‹¹ë…„ë„</label><select id="cancelTargetYearSelect" class="px-3 py-2 border rounded">' + yearOptionsHtml + '</select></div>' +
                '<button id="cancelDeleteBtn" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">ğŸ—‘ï¸ ì‚­ì œ</button>' +
            '</div>' +
        '</div>' +
        '<div class="bg-white rounded-lg shadow overflow-hidden">' +
            '<div class="overflow-x-auto" style="max-height: 600px;">' +
                '<table class="w-full border-collapse text-sm" style="table-layout: fixed; min-width: 1400px;">' +
                    '<thead class="bg-orange-600 text-white sticky top-0 z-10">' +
                        '<tr><th class="border px-2 py-2" style="width: 50px;"><input type="checkbox" id="selectAllCancelRows" ' + (state.selectedCancellationRows.size === currentCancelData.length && currentCancelData.length > 0 ? 'checked' : '') + ' /></th><th class="border px-2 py-2" style="width: 50px;">No</th>' + cancelColsHtml + '</tr>' +
                    '</thead>' +
                    '<tbody>' + rowsHtml + '</tbody>' +
                '</table>' +
            '</div>' +
            '<div class="flex items-center justify-between px-4 py-3 border-t bg-gray-50"><div class="text-sm text-gray-600">ì „ì²´ ' + currentCancelData.length + 'ê±´' + (state.selectedCancellationRows.size > 0 ? ' (' + state.selectedCancellationRows.size + 'ê±´ ì„ íƒë¨)' : '') + '</div></div>' +
        '</div>' +
    '</div>';
}

        function renderFooter() {
            return `
                <div class="container mx-auto px-4 py-4 text-sm text-gray-600 flex items-center justify-between flex-wrap gap-4">
                    <p>ê²€ìƒ‰ê²°ê³¼ (Total: ${state.filteredData.length}ê°œ)</p>
                    <div class="flex items-center gap-4">
                        ${state.lastSaved ? `<p class="text-xs text-gray-500">ë§ˆì§€ë§‰ ì €ì¥: ${state.lastSaved.toLocaleTimeString()}</p>` : ''}
                        <p class="text-xs text-green-600 font-semibold">ğŸ’¾ ì˜êµ¬ ì €ì¥ ëª¨ë“œ</p>
                    </div>
                </div>
            `;
        }
        function renderSalesAnalysisTab() {
            const currentAppData = state.applicationData[state.targetYear] || [];
            const baseMonthStats = {};
            const appMonthStats = {};
            const allRegions = new Set();
            
            currentAppData.forEach(row => {
                const region = row['í–‰ì •êµ¬ì—­'] || 'ë¯¸ë¶„ë¥˜';
                const fee = parseInt(String(row['ìˆ˜ìˆ˜ë£Œ'] || '0').replace(/,/g, '')) || 0;
                allRegions.add(region);
                const baseDate = row['ê¸°ì¤€ì¼'];
                if (baseDate) {
                    const baseMonth = parseInt(baseDate.split('-')[1]);
                    if (baseMonth >= 1 && baseMonth <= 12) {
                        if (!baseMonthStats[baseMonth]) baseMonthStats[baseMonth] = {};
                        if (!baseMonthStats[baseMonth][region]) baseMonthStats[baseMonth][region] = { count: 0, fee: 0 };
                        baseMonthStats[baseMonth][region].count++;
                        baseMonthStats[baseMonth][region].fee += fee;
                    }
                }
                const appDate = row['ì‹ ì²­ì¼'];
                if (appDate) {
                    const appMonth = parseInt(appDate.split('-')[1]);
                    if (appMonth >= 1 && appMonth <= 12) {
                        if (!appMonthStats[appMonth]) appMonthStats[appMonth] = {};
                        if (!appMonthStats[appMonth][region]) appMonthStats[appMonth][region] = { count: 0, fee: 0 };
                        appMonthStats[appMonth][region].count++;
                        appMonthStats[appMonth][region].fee += fee;
                    }
                }
            });
            
            const sortedRegions = [...allRegions].sort((a, b) => a.localeCompare(b, 'ko'));
            
            function createMonthTable(stats, title, bgColor) {
                let totalCount = 0, totalFee = 0;
                const monthTotals = {}, regionTotals = {};
                for (let m = 1; m <= 12; m++) {
                    monthTotals[m] = { count: 0, fee: 0 };
                    if (stats[m]) sortedRegions.forEach(region => { if (stats[m][region]) { monthTotals[m].count += stats[m][region].count; monthTotals[m].fee += stats[m][region].fee; } });
                }
                sortedRegions.forEach(region => {
                    regionTotals[region] = { count: 0, fee: 0 };
                    for (let m = 1; m <= 12; m++) {
                        if (stats[m] && stats[m][region]) { regionTotals[region].count += stats[m][region].count; regionTotals[region].fee += stats[m][region].fee; totalCount += stats[m][region].count; totalFee += stats[m][region].fee; }
                    }
                });
                return `
                    <div class="mb-8">
                        <h3 class="text-lg font-bold mb-3 ${bgColor} text-white px-4 py-2 rounded">${title}</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse text-sm">
                                <thead class="bg-gray-100">
                                    <tr><th class="border px-2 py-2 sticky left-0 bg-gray-100 z-10">í–‰ì •êµ¬ì—­</th>${Array.from({length: 12}, (_, i) => `<th class="border px-2 py-1 text-center" colspan="2">${i+1}ì›”</th>`).join('')}<th class="border px-2 py-1 text-center bg-yellow-100" colspan="2">í•©ê³„</th></tr>
                                    <tr><th class="border px-2 py-1 sticky left-0 bg-gray-100 z-10"></th>${Array.from({length: 12}, () => `<th class="border px-1 py-1 text-xs">ê±´ìˆ˜</th><th class="border px-1 py-1 text-xs">ìˆ˜ìˆ˜ë£Œ</th>`).join('')}<th class="border px-1 py-1 text-xs bg-yellow-100">ê±´ìˆ˜</th><th class="border px-1 py-1 text-xs bg-yellow-100">ìˆ˜ìˆ˜ë£Œ</th></tr>
                                </thead>
                                <tbody>
                                    ${sortedRegions.map(region => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="border px-2 py-1 font-semibold sticky left-0 bg-white z-10">${region}</td>
                                            ${Array.from({length: 12}, (_, i) => { const m = i + 1; const data = stats[m] && stats[m][region] ? stats[m][region] : { count: 0, fee: 0 }; return `<td class="border px-1 py-1 text-center">${data.count || '-'}</td><td class="border px-1 py-1 text-right">${data.fee ? data.fee.toLocaleString() : '-'}</td>`; }).join('')}
                                            <td class="border px-1 py-1 text-center font-bold bg-yellow-50">${regionTotals[region].count || '-'}</td>
                                            <td class="border px-1 py-1 text-right font-bold bg-yellow-50">${regionTotals[region].fee ? regionTotals[region].fee.toLocaleString() : '-'}</td>
                                        </tr>
                                    `).join('')}
                                    <tr class="bg-blue-50 font-bold">
                                        <td class="border px-2 py-1 sticky left-0 bg-blue-50 z-10">ì›” í•©ê³„</td>
                                        ${Array.from({length: 12}, (_, i) => { const m = i + 1; return `<td class="border px-1 py-1 text-center">${monthTotals[m].count || '-'}</td><td class="border px-1 py-1 text-right">${monthTotals[m].fee ? monthTotals[m].fee.toLocaleString() : '-'}</td>`; }).join('')}
                                        <td class="border px-1 py-1 text-center bg-green-100">${totalCount || '-'}</td>
                                        <td class="border px-1 py-1 text-right bg-green-100">${totalFee ? totalFee.toLocaleString() : '-'}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            return `
                <div>
                    <div class="bg-purple-50 border border-purple-300 rounded-lg p-4 mb-4">
                        <h2 class="text-xl font-bold text-purple-800 flex items-center gap-2"><span>ğŸ“Š</span> ë§¤ì¶œë¶„ì„: ${state.targetYear}ë…„</h2>
                        <p class="text-sm text-purple-600 mt-1">ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥ ë°ì´í„° ê¸°ì¤€ (ì´ ${currentAppData.length}ê±´)</p>
                    </div>
                    <div class="bg-white rounded-lg p-4 mb-4 shadow">
                        <div class="flex gap-4 items-center mb-4">
                            <div><label class="block text-sm font-semibold mb-1">í•´ë‹¹ë…„ë„</label><select id="salesTargetYearSelect" class="px-3 py-2 border rounded">${state.yearRange.map(year => `<option value="${year}" ${year === state.targetYear ? 'selected' : ''}>${year}ë…„</option>`).join('')}</select></div>
                            <div class="flex-1"></div>
                            <div class="text-sm text-gray-600"><span class="font-semibold">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:</span> ${new Date().toLocaleTimeString()}</div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        ${createMonthTable(baseMonthStats, 'ğŸ“… ê¸°ì¤€ì›”ë³„ / í–‰ì •êµ¬ì—­ë³„ ê±´ìˆ˜ ë° ìˆ˜ìˆ˜ë£Œ', 'bg-blue-600')}
                        ${createMonthTable(appMonthStats, 'ğŸ“ ì‹ ì²­ì›”ë³„ / í–‰ì •êµ¬ì—­ë³„ ê±´ìˆ˜ ë° ìˆ˜ìˆ˜ë£Œ', 'bg-green-600')}
                    </div>
                </div>
            `;
        }

        function renderPathwayTab() {
            const currentPathwayData = state.pathwayData[state.selectedYear] || [];
            let filteredPathwayData = [...currentPathwayData];
            if (state.pathway.filters.region) filteredPathwayData = filteredPathwayData.filter(row => row['í–‰ì •êµ¬ì—­'] === state.pathway.filters.region);
            if (state.pathway.searchTerm) filteredPathwayData = filteredPathwayData.filter(row => Object.values(row).some(val => String(val).toLowerCase().includes(state.pathway.searchTerm.toLowerCase())));
            const totalPathwayPages = Math.ceil(filteredPathwayData.length / state.itemsPerPage);
            const paginatedPathwayData = filteredPathwayData.slice((state.pathway.currentPage - 1) * state.itemsPerPage, state.pathway.currentPage * state.itemsPerPage);

            return `
                <div>
                    <div class="bg-yellow-50 border border-yellow-300 rounded-lg p-4 mb-4"><h2 class="text-xl font-bold text-yellow-800 flex items-center gap-2"><span>ğŸ </span> ê²½ë¡œë‹¹ ì ê²€: ${state.selectedYear}ë…„</h2></div>
                    <div class="bg-white rounded-lg p-4 mb-4 shadow">
                        <div class="flex gap-2 mb-4 flex-wrap">
                            <button id="pathwayUploadBtn" class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">ğŸ“¤ ì—…ë¡œë“œ (Excel/CSV)</button>
                            <button id="pathwayDownloadBtn" class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</button>
                            <button id="pathwayDeleteBtn" class="flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">ğŸ—‘ï¸ ì‚­ì œ</button>
                            <button id="pathwaySaveBtn" class="flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">ğŸ’¾ ì €ì¥</button>
                            <button id="pathwayEditToggleBtn" class="flex items-center gap-2 bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">âœï¸ ${state.pathway.isEditing ? 'ì™„ë£Œ' : 'í¸ì§‘'}</button>
                            <button id="pathwayAddRowBtn" class="flex items-center gap-2 bg-teal-600 text-white px-4 py-2 rounded hover:bg-teal-700">â• í–‰ ì¶”ê°€</button>
                            <button id="pathwayMapBtn" class="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">ğŸ—ºï¸ MAP</button>
                        </div>
                        <div class="flex gap-4 items-end">
                            <div><label class="block text-sm font-semibold mb-1">í–‰ì •êµ¬ì—­</label><select id="pathwayRegionFilter" class="px-3 py-2 border rounded"><option value="">ì „ì²´</option>${pathwayOptions.regions.map(r => `<option value="${r}" ${state.pathway.filters.region === r ? 'selected' : ''}>${r}</option>`).join('')}</select></div>
                            <div class="flex-1"><label class="block text-sm font-semibold mb-1">ê²€ìƒ‰</label><input type="text" id="pathwaySearchInput" value="${state.pathway.searchTerm}" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥..." class="w-full px-3 py-2 border rounded" /></div>
                            <button id="pathwaySearchBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">ğŸ” ì¡°íšŒ</button>
                            <button id="pathwayResetBtn" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">ğŸ”„ ì´ˆê¸°í™”</button>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="overflow-x-auto" style="max-height: 600px;">
                            <table class="w-full border-collapse text-sm" style="table-layout: fixed; min-width: 2000px;">
                                <thead class="bg-blue-600 text-white sticky top-0 z-10">
                                    <tr>
                                        <th class="border px-2 py-2" style="width: 50px;"><input type="checkbox" id="selectAllPathwayRows" ${state.pathway.selectedRows.size === filteredPathwayData.length && filteredPathwayData.length > 0 ? 'checked' : ''} /></th>
                                        ${pathwayColumns.map(col => `<th class="border px-2 py-2" style="width: ${col === 'ìƒˆì£¼ì†Œ' ? '200px' : col === 'ì‹œì„¤ëª…' ? '150px' : '100px'};"><div class="truncate" title="${col}">${col}</div></th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${paginatedPathwayData.map((row, idx) => {
                                        const actualIdx = (state.pathway.currentPage - 1) * state.itemsPerPage + idx;
                                        return `
                                            <tr class="${state.pathway.selectedRows.has(actualIdx) ? 'bg-yellow-100' : 'hover:bg-gray-50'}">
                                                <td class="border px-2 py-1 text-center" style="width: 50px;"><input type="checkbox" class="pathway-row-checkbox" data-idx="${actualIdx}" ${state.pathway.selectedRows.has(actualIdx) ? 'checked' : ''} /></td>
                                                ${pathwayColumns.map(col => `
                                                    <td class="border px-2 py-1 text-sm">
                                                        ${state.pathway.isEditing ? `
                                                            ${col === 'ì‚¬ìš©ê°€ìŠ¤' ? `<select class="table-cell-input pathway-cell-edit" data-idx="${actualIdx}" data-col="${col}"><option value="">ì„ íƒ</option>${pathwayOptions.gas.map(g => `<option value="${g}" ${g === row[col] ? 'selected' : ''}>${g}</option>`).join('')}</select>` :
                                                            col === 'ì°¨ë‹¨ê¸°' || col === 'íƒ€ì´ë¨¸' || col === 'COê²½ë³´ê¸°' ? `<select class="table-cell-input pathway-cell-edit" data-idx="${actualIdx}" data-col="${col}"><option value="">ì„ íƒ</option>${pathwayOptions.device.map(d => `<option value="${d}" ${d === row[col] ? 'selected' : ''}>${d}</option>`).join('')}</select>` :
                                                            col === 'ëˆ„ì„¤' ? `<select class="table-cell-input pathway-cell-edit" data-idx="${actualIdx}" data-col="${col}"><option value="">ì„ íƒ</option>${pathwayOptions.leak.map(l => `<option value="${l}" ${l === row[col] ? 'selected' : ''}>${l}</option>`).join('')}</select>` :
                                                            col === 'ì ê²€ì' ? `<select class="table-cell-input pathway-cell-edit" data-idx="${actualIdx}" data-col="${col}"><option value="">ì„ íƒ</option>${pathwayOptions.inspectors.map(i => `<option value="${i}" ${i === row[col] ? 'selected' : ''}>${i}</option>`).join('')}</select>` :
                                                            col === 'ì ê²€ì¼' ? `<input type="date" value="${row[col] || ''}" class="table-cell-input pathway-cell-edit" data-idx="${actualIdx}" data-col="${col}" />` :
                                                            `<input type="text" value="${row[col] || ''}" class="table-cell-input pathway-cell-edit" data-idx="${actualIdx}" data-col="${col}" />`}
                                                        ` : `<div class="truncate" title="${row[col] || '-'}">${row[col] || '-'}</div>`}
                                                    </td>
                                                `).join('')}
                                            </tr>
                                        `;
                                    }).join('')}
                                    ${paginatedPathwayData.length === 0 ? `<tr><td colspan="${pathwayColumns.length + 1}" class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">ğŸ </div><div>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div></td></tr>` : ''}
                                </tbody>
                            </table>
                        </div>
                        <div class="flex items-center justify-between px-4 py-3 border-t bg-gray-50">
                            <div class="text-sm text-gray-600">ì „ì²´ ${filteredPathwayData.length}ê±´ ${state.pathway.selectedRows.size > 0 ? ` (${state.pathway.selectedRows.size}ê±´ ì„ íƒë¨)` : ''}</div>
                            <div class="flex items-center gap-2">
                                <button id="pathwayPrevPageBtn" ${state.pathway.currentPage === 1 ? 'disabled' : ''} class="p-2 border rounded hover:bg-gray-100 disabled:opacity-50">â—€</button>
                                <span class="px-4 py-2">${state.pathway.currentPage} / ${totalPathwayPages || 1}</span>
                                <button id="pathwayNextPageBtn" ${state.pathway.currentPage === totalPathwayPages || totalPathwayPages === 0 ? 'disabled' : ''} class="p-2 border rounded hover:bg-gray-100 disabled:opacity-50">â–¶</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderResourceTab() {
            const currentResourceData = state.resourceData[state.selectedYear] || [];
            let filteredResourceData = [...currentResourceData];
            if (state.resource.currentFolder) filteredResourceData = filteredResourceData.filter(row => row['í´ë”'] === state.resource.currentFolder);
            if (state.resource.searchTerm) filteredResourceData = filteredResourceData.filter(row => Object.values(row).some(val => String(val).toLowerCase().includes(state.resource.searchTerm.toLowerCase())));
            const uniqueFolders = [...new Set(currentResourceData.map(row => row['í´ë”']).filter(Boolean))].sort();
            const resourceColumns = ['í´ë”', 'íŒŒì¼ëª…', 'íŒŒì¼í˜•ì‹', 'íŒŒì¼í¬ê¸°', 'ì„¤ëª…', 'ë“±ë¡ì¼', 'ë“±ë¡ì'];
            const getFileIcon = (fileType) => { const type = (fileType || '').toLowerCase(); if (type.includes('pdf')) return 'ğŸ“•'; if (type.includes('xls') || type.includes('excel')) return 'ğŸ“Š'; if (type.includes('hwp')) return 'ğŸ“˜'; if (type.includes('doc') || type.includes('word')) return 'ğŸ“„'; if (type.includes('ppt')) return 'ğŸ“™'; if (type.includes('jpg') || type.includes('png') || type.includes('gif') || type.includes('image')) return 'ğŸ–¼ï¸'; if (type.includes('zip') || type.includes('rar')) return 'ğŸ—œï¸'; return 'ğŸ“'; };

            return `
                <div>
                    <div class="bg-indigo-50 border border-indigo-300 rounded-lg p-4 mb-4">
                        <h2 class="text-xl font-bold text-indigo-800 flex items-center gap-2"><span>ğŸ“</span> ìë£Œì‹¤: ${state.selectedYear}ë…„</h2>
                        <p class="text-sm text-indigo-600 mt-1">PDF, Excel, í•œê¸€ ë“± ë‹¤ì–‘í•œ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                    <div class="bg-white rounded-lg p-4 mb-4 shadow">
                        <div class="flex gap-2 mb-4 flex-wrap">
                            <label class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 cursor-pointer">ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œ<input type="file" id="resourceFileUpload" multiple accept=".pdf,.xlsx,.xls,.hwp,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.zip,.rar,.csv" class="hidden" /></label>
                            <button id="resourceDownloadSelectedBtn" class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">ğŸ“¥ ì„ íƒ ë‹¤ìš´ë¡œë“œ</button>
                            <button id="resourceDeleteBtn" class="flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">ğŸ—‘ï¸ ì‚­ì œ</button>
                            <button id="resourceExportListBtn" class="flex items-center gap-2 bg-teal-600 text-white px-4 py-2 rounded hover:bg-teal-700">ğŸ“‹ ëª©ë¡ ë‚´ë³´ë‚´ê¸°</button>
                        </div>
                        <div class="flex gap-4 items-end">
                            <div><label class="block text-sm font-semibold mb-1">í´ë”</label><select id="resourceFolderFilter" class="px-3 py-2 border rounded min-w-[150px]"><option value="">ì „ì²´</option>${uniqueFolders.map(f => `<option value="${f}" ${state.resource.currentFolder === f ? 'selected' : ''}>${f}</option>`).join('')}</select></div>
                            <div class="flex-1"><label class="block text-sm font-semibold mb-1">ê²€ìƒ‰</label><input type="text" id="resourceSearchInput" value="${state.resource.searchTerm}" placeholder="íŒŒì¼ëª…, ì„¤ëª… ë“± ê²€ìƒ‰..." class="w-full px-3 py-2 border rounded" /></div>
                            <button id="resourceSearchBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">ğŸ” ì¡°íšŒ</button>
                            <button id="resourceResetBtn" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">ğŸ”„ ì´ˆê¸°í™”</button>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="overflow-x-auto" style="max-height: 600px;">
                            <table class="w-full border-collapse text-sm">
                                <thead class="bg-indigo-600 text-white sticky top-0 z-10">
                                    <tr>
                                        <th class="border px-2 py-2" style="width: 50px;"><input type="checkbox" id="selectAllResourceRows" ${state.resource.selectedFiles.size === filteredResourceData.length && filteredResourceData.length > 0 ? 'checked' : ''} /></th>
                                        <th class="border px-2 py-2" style="width: 50px;">No</th>
                                        <th class="border px-2 py-2" style="width: 50px;">í˜•ì‹</th>
                                        ${resourceColumns.map(col => `<th class="border px-3 py-2" style="width: ${col === 'ì„¤ëª…' ? '200px' : col === 'íŒŒì¼ëª…' ? '200px' : '100px'};">${col}</th>`).join('')}
                                        <th class="border px-2 py-2" style="width: 80px;">ë‹¤ìš´ë¡œë“œ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${filteredResourceData.map((row, idx) => `
                                        <tr class="${state.resource.selectedFiles.has(idx) ? 'bg-yellow-100' : 'hover:bg-gray-50'}">
                                            <td class="border px-2 py-1 text-center"><input type="checkbox" class="resource-row-checkbox" data-idx="${idx}" ${state.resource.selectedFiles.has(idx) ? 'checked' : ''} /></td>
                                            <td class="border px-2 py-1 text-center">${idx + 1}</td>
                                            <td class="border px-2 py-1 text-center text-xl">${getFileIcon(row['íŒŒì¼í˜•ì‹'])}</td>
                                            ${resourceColumns.map(col => `
                                                <td class="border px-3 py-1">
                                                    ${col === 'ë“±ë¡ì¼' ? `<input type="date" value="${row[col] || ''}" class="w-full px-2 py-1 border rounded text-sm resource-cell-edit" data-idx="${idx}" data-col="${col}" />` :
                                                    col === 'íŒŒì¼ëª…' ? `<div class="truncate font-medium text-blue-600" title="${row[col] || ''}">${row[col] || '-'}</div>` :
                                                    col === 'íŒŒì¼í¬ê¸°' ? `<div class="text-right text-gray-600">${row[col] || '-'}</div>` :
                                                    `<input type="text" value="${row[col] || ''}" class="w-full px-2 py-1 border rounded text-sm resource-cell-edit" data-idx="${idx}" data-col="${col}" />`}
                                                </td>
                                            `).join('')}
                                            <td class="border px-2 py-1 text-center">${row['fileId'] ? `<button class="resource-download-btn px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600" data-idx="${idx}">ğŸ“¥</button>` : '-'}</td>
                                        </tr>
                                    `).join('')}
                                    ${filteredResourceData.length === 0 ? `<tr><td colspan="${resourceColumns.length + 4}" class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">ğŸ“</div><div>íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div><div class="text-sm mt-2">PDF, Excel, í•œê¸€ ë“± íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.</div></td></tr>` : ''}
                                </tbody>
                            </table>
                        </div>
                        <div class="flex items-center justify-between px-4 py-3 border-t bg-gray-50">
                            <div class="text-sm text-gray-600">ì „ì²´ ${filteredResourceData.length}ê±´ ${state.resource.selectedFiles.size > 0 ? ` (${state.resource.selectedFiles.size}ê±´ ì„ íƒë¨)` : ''}</div>
                            <div class="text-xs text-gray-500">ì§€ì› í˜•ì‹: PDF, Excel, í•œê¸€, Word, PowerPoint, ì´ë¯¸ì§€, ì••ì¶•íŒŒì¼</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ======================== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ========================
        function attachEventListeners() {
            try {
               document.querySelectorAll('.tab-btn').forEach(btn => { btn.addEventListener('click', (e) => { const tab = e.target.dataset.tab; if (tab === 'ë§¤ì¶œë¶„ì„' && !state.salesUnlocked) { const pwd = prompt('ë§¤ì¶œë¶„ì„ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:'); if (pwd === '1278') { state.salesUnlocked = true; state.activeTab = tab; render(); } else if (pwd !== null) { alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); } return; } if (tab === 'ìë£Œì‹¤' && !state.resourceUnlocked) { const pwd = prompt('ìë£Œì‹¤ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:'); if (pwd === '1278') { state.resourceUnlocked = true; state.activeTab = tab; render(); } else if (pwd !== null) { alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); } return; } state.activeTab = tab; render(); }); });
                const yearSelect = document.getElementById('yearSelect');
                if (yearSelect) yearSelect.addEventListener('change', (e) => { state.selectedYear = parseInt(e.target.value); render(); });
                const sampleDataBtn = document.getElementById('sampleDataBtn');
                if (sampleDataBtn) sampleDataBtn.addEventListener('click', createSampleData);
                const welcomeFileInput = document.getElementById('welcomeFileInput');
                if (welcomeFileInput) welcomeFileInput.addEventListener('change', (e) => handleFileUpload(e.target.files[0]));
                const emptyStartBtn = document.getElementById('emptyStartBtn');
                if (emptyStartBtn) emptyStartBtn.addEventListener('click', () => { state.showWelcome = false; render(); });
                const adminLoginBtn = document.getElementById('adminLoginBtn');
                if (adminLoginBtn) adminLoginBtn.addEventListener('click', () => { const pwd = document.getElementById('adminPassword').value; if (pwd === 'kgt7848848!') { state.showAdmin = true; render(); } else { alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); } });
                const clearAllBtn = document.getElementById('clearAllBtn');
                if (clearAllBtn) clearAllBtn.addEventListener('click', clearAllData);
                const uploadBtn = document.getElementById('uploadBtn');
                if (uploadBtn) { const input = document.createElement('input'); input.type = 'file'; input.accept = '.csv,.xlsx,.xls'; uploadBtn.addEventListener('click', () => input.click()); input.addEventListener('change', (e) => handleFileUpload(e.target.files[0])); }
                const downloadBtn = document.getElementById('downloadBtn');
                if (downloadBtn) downloadBtn.addEventListener('click', () => { state.showDownloadMenu = !state.showDownloadMenu; render(); });
                const downloadExcelBtn = document.getElementById('downloadExcelBtn');
                if (downloadExcelBtn) downloadExcelBtn.addEventListener('click', downloadAsExcel);
                const downloadCSVBtn = document.getElementById('downloadCSVBtn');
                if (downloadCSVBtn) downloadCSVBtn.addEventListener('click', downloadAsCSV);
                const sampleBtn = document.getElementById('sampleBtn');
                if (sampleBtn) sampleBtn.addEventListener('click', createSampleData);
                const editToggleBtn = document.getElementById('editToggleBtn');
                if (editToggleBtn) editToggleBtn.addEventListener('click', () => { state.isEditing = !state.isEditing; render(); });
                const saveBtn = document.getElementById('saveBtn');
                if (saveBtn) saveBtn.addEventListener('click', () => { const saved = saveDataToStorage(); if (saved) alert('ğŸ’¾ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.'); else alert('âŒ ì €ì¥ ì‹¤íŒ¨!'); });
                const copyBtn = document.getElementById('copyBtn');
                if (copyBtn) copyBtn.addEventListener('click', copyToApplication);
                const deleteBtn = document.getElementById('deleteBtn');
                if (deleteBtn) deleteBtn.addEventListener('click', deleteSelectedRows);
                const detailBtn = document.getElementById('detailBtn');
                if (detailBtn) detailBtn.addEventListener('click', openDetailModal);
                const regionDropdownBtn = document.getElementById('regionDropdownBtn');
                if (regionDropdownBtn) regionDropdownBtn.addEventListener('click', () => { state.showRegionDropdown = !state.showRegionDropdown; render(); });
                const searchBtn = document.getElementById('searchBtn');
                if (searchBtn) searchBtn.addEventListener('click', () => { const searchInput = document.getElementById('searchInput'); if (searchInput) state.searchTerm = searchInput.value; state.currentPage = 1; render(); });
                const searchInput = document.getElementById('searchInput');
                if (searchInput) searchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { state.searchTerm = e.target.value; state.currentPage = 1; render(); } });
                const mainBaseMonthFilter = document.getElementById('mainBaseMonthFilter');
                if (mainBaseMonthFilter) mainBaseMonthFilter.addEventListener('change', (e) => { state.filters.month = e.target.value; state.currentPage = 1; render(); });
                const mainInspectionHistoryFilter = document.getElementById('mainInspectionHistoryFilter');
                if (mainInspectionHistoryFilter) mainInspectionHistoryFilter.addEventListener('change', (e) => { state.filters.inspectionHistory = e.target.value; state.currentPage = 1; render(); });
                const mainFilterResetBtn = document.getElementById('mainFilterResetBtn');
                if (mainFilterResetBtn) mainFilterResetBtn.addEventListener('click', () => { state.filters = { region: [], month: '', inspectionHistory: '' }; state.searchTerm = ''; state.currentPage = 1; state.showRegionDropdown = false; render(); });
                const selectAllRows = document.getElementById('selectAllRows');
                if (selectAllRows) selectAllRows.addEventListener('change', () => { if (selectAllRows.checked) state.selectedRows = new Set(state.filteredData.map((_, i) => i)); else state.selectedRows = new Set(); render(); });
                document.querySelectorAll('.row-checkbox').forEach(checkbox => { checkbox.addEventListener('change', (e) => { const idx = parseInt(e.target.dataset.idx); if (e.target.checked) state.selectedRows.add(idx); else state.selectedRows.delete(idx); }); });
                document.querySelectorAll('.cell-edit').forEach(input => { input.addEventListener('change', (e) => { const idx = parseInt(e.target.dataset.idx); const col = e.target.dataset.col; state.data[state.selectedYear][idx][col] = e.target.value; }); });
                const selectAllRegions = document.getElementById('selectAllRegions');
                if (selectAllRegions) selectAllRegions.addEventListener('change', (e) => { const uniqueRegions = [...new Set((state.data[state.selectedYear] || []).map(row => (row['í–‰ì •êµ¬ì—­'] || '').replace(/[\\\/]/g, '').trim()).filter(Boolean))]; state.filters.region = e.target.checked ? [...uniqueRegions] : []; render(); });
                document.querySelectorAll('.region-checkbox').forEach(checkbox => { checkbox.addEventListener('change', (e) => { const region = e.target.value; if (e.target.checked) state.filters.region.push(region); else state.filters.region = state.filters.region.filter(r => r !== region); render(); }); });
                const prevPageBtn = document.getElementById('prevPageBtn');
                if (prevPageBtn) prevPageBtn.addEventListener('click', () => { state.currentPage = Math.max(1, state.currentPage - 1); render(); });
                const nextPageBtn = document.getElementById('nextPageBtn');
                if (nextPageBtn) nextPageBtn.addEventListener('click', () => { const totalPages = Math.ceil(state.filteredData.length / state.itemsPerPage); state.currentPage = Math.min(totalPages, state.currentPage + 1); render(); });

                // ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥ íƒ­
                const targetYearSelect = document.getElementById('targetYearSelect');
                if (targetYearSelect) targetYearSelect.addEventListener('change', (e) => { state.targetYear = parseInt(e.target.value); render(); });
                const inspectionYearSelect = document.getElementById('inspectionYearSelect');
                if (inspectionYearSelect) inspectionYearSelect.addEventListener('change', (e) => { state.inspectionYear = parseInt(e.target.value); render(); });
                const appUploadBtn = document.getElementById('appUploadBtn');
                if (appUploadBtn) { const appInput = document.createElement('input'); appInput.type = 'file'; appInput.accept = '.csv,.xlsx,.xls'; appUploadBtn.addEventListener('click', () => appInput.click()); appInput.addEventListener('change', async (e) => { const file = e.target.files[0]; if (!file) return; try { state.isLoading = true; state.loadingProgress = 30; render(); const fileExt = file.name.split('.').pop().toLowerCase(); let parsedData; if (fileExt === 'xlsx' || fileExt === 'xls') parsedData = await parseExcelFile(file); else if (fileExt === 'csv') parsedData = await parseCSVFile(file); if (!parsedData || !Array.isArray(parsedData)) throw new Error('íŒŒì¼ì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); parsedData.forEach(row => { if (row['ì›”ì‚¬ìš©ì˜ˆì •ëŸ‰'] && !row['ì‚¬ìš©ëŸ‰']) row['ì‚¬ìš©ëŸ‰'] = row['ì›”ì‚¬ìš©ì˜ˆì •ëŸ‰']; if (row['ë¹„ê³ '] && !row['ë©”ëª¨2']) row['ë©”ëª¨2'] = row['ë¹„ê³ ']; }); if (!state.applicationData[state.targetYear]) state.applicationData[state.targetYear] = []; state.applicationData[state.targetYear] = [...parsedData, ...state.applicationData[state.targetYear]]; state.isLoading = false; saveDataToStorage(); alert(`âœ… ${parsedData.length}ê°œì˜ ë°ì´í„°ê°€ ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥ì— ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`); render(); } catch (error) { state.isLoading = false; alert('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜: ' + error.message); render(); } }); }
                const appAddRowBtn = document.getElementById('appAddRowBtn');
                if (appAddRowBtn) appAddRowBtn.addEventListener('click', addApplicationRow);
                const appDeleteRowBtn = document.getElementById('appDeleteRowBtn');
                if (appDeleteRowBtn) appDeleteRowBtn.addEventListener('click', deleteSelectedApplicationRows);
                const appSaveBtn = document.getElementById('appSaveBtn');
                if (appSaveBtn) appSaveBtn.addEventListener('click', () => { saveDataToStorage(); alert('ğŸ’¾ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.'); });
                const appDownloadBtn = document.getElementById('appDownloadBtn');
                if (appDownloadBtn) appDownloadBtn.addEventListener('click', () => { state.showAppDownloadMenu = !state.showAppDownloadMenu; render(); });
                const appDownloadExcelBtn = document.getElementById('appDownloadExcelBtn');
                if (appDownloadExcelBtn) appDownloadExcelBtn.addEventListener('click', () => { const currentAppData = state.applicationData[state.targetYear] || []; const dataToDownload = state.selectedApplicationRows.size > 0 ? currentAppData.filter((_, idx) => state.selectedApplicationRows.has(idx)) : currentAppData; if (dataToDownload.length === 0) { alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; } const worksheet = XLSX.utils.json_to_sheet(dataToDownload, { header: applicationColumns }); const workbook = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(workbook, worksheet, 'ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥'); XLSX.writeFile(workbook, `ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥_${state.targetYear}_${new Date().toISOString().split('T')[0]}.xlsx`); state.showAppDownloadMenu = false; render(); });
                const appDownloadCSVBtn = document.getElementById('appDownloadCSVBtn');
                if (appDownloadCSVBtn) appDownloadCSVBtn.addEventListener('click', () => { const currentAppData = state.applicationData[state.targetYear] || []; const dataToDownload = state.selectedApplicationRows.size > 0 ? currentAppData.filter((_, idx) => state.selectedApplicationRows.has(idx)) : currentAppData; if (dataToDownload.length === 0) { alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; } const csvContent = [applicationColumns.join(','), ...dataToDownload.map(row => applicationColumns.map(col => { const value = row[col] || ''; return value.includes(',') || value.includes('"') ? `"${value.replace(/"/g, '""')}"` : value; }).join(','))].join('\n'); const BOM = '\uFEFF'; const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' }); const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = `ì‹ ì²­ì ‘ìˆ˜ëŒ€ì¥_${state.targetYear}_${new Date().toISOString().split('T')[0]}.csv`; link.click(); state.showAppDownloadMenu = false; render(); });
                const appEditToggleBtn = document.getElementById('appEditToggleBtn');
                if (appEditToggleBtn) appEditToggleBtn.addEventListener('click', () => { state.isEditingApplication = !state.isEditingApplication; render(); });
                const selectAllAppRows = document.getElementById('selectAllAppRows');
                if (selectAllAppRows) selectAllAppRows.addEventListener('change', (e) => { const currentAppData = state.applicationData[state.targetYear] || []; if (e.target.checked) state.selectedApplicationRows = new Set(currentAppData.map((_, i) => i)); else state.selectedApplicationRows = new Set(); render(); });
                document.querySelectorAll('.app-row-checkbox').forEach(checkbox => { checkbox.addEventListener('change', (e) => { const idx = parseInt(e.target.dataset.idx); if (e.target.checked) state.selectedApplicationRows.add(idx); else state.selectedApplicationRows.delete(idx); }); });
                document.querySelectorAll('.app-cell-edit').forEach(input => { input.addEventListener('change', (e) => { const idx = parseInt(e.target.dataset.idx); const col = e.target.dataset.col; state.applicationData[state.targetYear][idx][col] = e.target.value; if (col === 'ì‹ ì²­ì¼' && e.target.value) { const certNumber = generateCertificateNumber(e.target.value, idx); state.applicationData[state.targetYear][idx]['í•„ì¦ë²ˆí˜¸'] = certNumber; render(); } saveDataToStorage(); }); });
                const cutBtn = document.getElementById('cutBtn');
                if (cutBtn) cutBtn.addEventListener('click', cutToInspectionYear);
                const cancelBtn = document.getElementById('cancelBtn');
                if (cancelBtn) cancelBtn.addEventListener('click', moveToCancel);
                const appMapBtn = document.getElementById('appMapBtn');
                if (appMapBtn) appMapBtn.addEventListener('click', () => { const currentAppData = state.applicationData[state.targetYear] || []; const selectedData = state.selectedApplicationRows.size > 0 ? currentAppData.filter((_, idx) => state.selectedApplicationRows.has(idx)) : []; if (selectedData.length === 0) { alert('ì§€ë„ì— í‘œì‹œí•  í–‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; } state.mapData = selectedData; state.showMapModal = true; state.isLoadingMap = true; state.mapLoadingProgress = 0; render(); setTimeout(() => initMap(selectedData), 100); });
                const appDetailBtn = document.getElementById('appDetailBtn');
                if (appDetailBtn) appDetailBtn.addEventListener('click', openAppDetailModal);
                const certificateBtn = document.getElementById('certificateBtn');
                if (certificateBtn) certificateBtn.addEventListener('click', () => { if (state.selectedApplicationRows.size !== 1) { alert('ì¦ëª…ì„œë¥¼ ì¶œë ¥í•  ë°ì´í„°ë¥¼ 1ê°œë§Œ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; } const selectedIdx = Array.from(state.selectedApplicationRows)[0]; const currentAppData = state.applicationData[state.targetYear] || []; state.certificateData = {...currentAppData[selectedIdx]}; state.showCertificateModal = true; render(); });
              const inspectionSheetBtn = document.getElementById('inspectionSheetBtn');
if (inspectionSheetBtn) inspectionSheetBtn.addEventListener('click', () => { if (state.selectedApplicationRows.size !== 1) { alert('ê²€ì‚¬í‘œë¥¼ ì¶œë ¥í•  ë°ì´í„°ë¥¼ 1ê°œë§Œ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; } const selectedIdx = Array.from(state.selectedApplicationRows)[0]; const currentAppData = state.applicationData[state.targetYear] || []; state.inspectionSheetData = {...currentAppData[selectedIdx]}; state.showInspectionSheetModal = true; render(); });
                // ì¦ëª…ì„œ ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                const certPrintBtn = document.getElementById('certPrintBtn');
                if (certPrintBtn) certPrintBtn.addEventListener('click', () => window.print());
const certSaveBtn = document.getElementById('certSaveBtn');
if (certSaveBtn) certSaveBtn.addEventListener('click', () => { 
    state.showCertSaveMenu = !state.showCertSaveMenu; 
    render(); 
});

const certSavePDFBtn = document.getElementById('certSavePDFBtn');
if (certSavePDFBtn) certSavePDFBtn.addEventListener('click', async () => {
    const d = state.certificateData;
    const element = document.getElementById('certificatePrintArea');
    if (!element) { alert('ì¦ëª…ì„œ ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
    try {
        const canvas = await html2canvas(element, { scale: 2, useCORS: true, backgroundColor: '#ffffff' });
        const imgData = canvas.toDataURL('image/png');
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        const pdfWidth = 210;
        const pdfHeight = 297;
        const imgWidth = pdfWidth - 20;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        const xPos = 10;
        const yPos = 10;
        pdf.addImage(imgData, 'PNG', xPos, yPos, imgWidth, imgHeight);
        pdf.save(`ì •ê¸°ê²€ì‚¬ì¦ëª…ì„œ_${d['ì‹œì„¤ëª…'] || 'ë¯¸ì§€ì •'}_${new Date().toISOString().split('T')[0]}.pdf`);
        state.showCertSaveMenu = false;
        render();
    } catch (error) {
        console.error('PDF ì €ì¥ ì˜¤ë¥˜:', error);
        alert('PDF ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
});

const certSaveExcelBtn = document.getElementById('certSaveExcelBtn');
                if (certSaveExcelBtn) certSaveExcelBtn.addEventListener('click', () => {
                    const d = state.certificateData;
                    const certData = [{
                        'ì‹œì„¤ë²ˆí˜¸': d['ì‹œì„¤ë²ˆí˜¸'] || '',
                        'í•„ì¦ë²ˆí˜¸': d['í•„ì¦ë²ˆí˜¸'] || '',
                        'ê¸°ì¤€ì¼': d['ê¸°ì¤€ì¼'] || '',
                        'ìƒí˜¸': d['ì‹œì„¤ëª…'] || '',
                        'ì‚¬ì—…ì˜ì¢…ë¥˜': 'íŠ¹ì •ì‚¬ìš©',
                        'ì‚¬ë¬´ì†Œì†Œì¬ì§€': d['êµ¬ì£¼ì†Œ'] || '',
                        'ëŒ€í‘œì': d['ëŒ€í‘œìëª…'] || '',
                        'ì‚¬ì—…ì†Œì†Œì¬ì§€': d['ìƒˆì£¼ì†Œ'] || '',
                        'ê²€ì‚¬ê¸°ê´€ì£¼ì†Œ': 'ë¶€ì‚°ê´‘ì—­ì‹œ í•´ìš´ëŒ€êµ¬ ì„ ìˆ˜ì´Œë¡œ 169-8',
                        'ë‹´ë‹¹ë¶€ì„œ': 'ì•ˆì „ ê²€ì‚¬íŒ€',
                        'ì „í™”ë²ˆí˜¸': '051-784-8848',
                        'ê²€ì‚¬ì›ì„±ëª…': d['ê²€ì‚¬ì›'] || '',
                        'ê²€ì‚¬ì—°ì›”ì¼': d['ê²€ì‚¬ì¼'] || '',
                        'ì›”ì‚¬ìš©ì˜ˆì •ëŸ‰': d['ì‚¬ìš©ëŸ‰'] || '',
                        'ì‹œì„¤ì „í™”ë²ˆí˜¸': d['ì „í™”ë²ˆí˜¸'] || ''
                    }];
                    const worksheet = XLSX.utils.json_to_sheet(certData);
                    const workbook = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(workbook, worksheet, 'ì •ê¸°ê²€ì‚¬ì¦ëª…ì„œ');
                    XLSX.writeFile(workbook, `ì •ê¸°ê²€ì‚¬ì¦ëª…ì„œ_${d['ì‹œì„¤ëª…'] || 'ë¯¸ì§€ì •'}_${new Date().toISOString().split('T')[0]}.xlsx`);
                    state.showCertSaveMenu = false;
                    render();
                });

                const certSaveCSVBtn = document.getElementById('certSaveCSVBtn');
                if (certSaveCSVBtn) certSaveCSVBtn.addEventListener('click', () => {
                    const d = state.certificateData;
                    const headers = ['ì‹œì„¤ë²ˆí˜¸', 'í•„ì¦ë²ˆí˜¸', 'ê¸°ì¤€ì¼', 'ìƒí˜¸', 'ì‚¬ì—…ì˜ì¢…ë¥˜', 'ì‚¬ë¬´ì†Œì†Œì¬ì§€', 'ëŒ€í‘œì', 'ì‚¬ì—…ì†Œì†Œì¬ì§€', 'ê²€ì‚¬ê¸°ê´€ì£¼ì†Œ', 'ë‹´ë‹¹ë¶€ì„œ', 'ì „í™”ë²ˆí˜¸', 'ê²€ì‚¬ì›ì„±ëª…', 'ê²€ì‚¬ì—°ì›”ì¼', 'ì›”ì‚¬ìš©ì˜ˆì •ëŸ‰', 'ì‹œì„¤ì „í™”ë²ˆí˜¸'];
                    const values = [
                        d['ì‹œì„¤ë²ˆí˜¸'] || '', d['í•„ì¦ë²ˆí˜¸'] || '', d['ê¸°ì¤€ì¼'] || '', d['ì‹œì„¤ëª…'] || '', 'íŠ¹ì •ì‚¬ìš©',
                        d['êµ¬ì£¼ì†Œ'] || '', d['ëŒ€í‘œìëª…'] || '', d['ìƒˆì£¼ì†Œ'] || '', 'ë¶€ì‚°ê´‘ì—­ì‹œ í•´ìš´ëŒ€êµ¬ ì„ ìˆ˜ì´Œë¡œ 169-8',
                        'ì•ˆì „ ê²€ì‚¬íŒ€', '051-784-8848', d['ê²€ì‚¬ì›'] || '', d['ê²€ì‚¬ì¼'] || '', d['ì‚¬ìš©ëŸ‰'] || '', d['ì „í™”ë²ˆí˜¸'] || ''
                    ];
                    const csvContent = [
                        headers.join(','),
                        values.map(v => v.includes(',') || v.includes('"') ? `"${v.replace(/"/g, '""')}"` : v).join(',')
                    ].join('\n');
                    const BOM = '\uFEFF';
                    const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `ì •ê¸°ê²€ì‚¬ì¦ëª…ì„œ_${d['ì‹œì„¤ëª…'] || 'ë¯¸ì§€ì •'}_${new Date().toISOString().split('T')[0]}.csv`;
                    link.click();
                    state.showCertSaveMenu = false;
                    render();
                });

                const certCloseBtn = document.getElementById('certCloseBtn');
                if (certCloseBtn) certCloseBtn.addEventListener('click', () => { 
                    state.showCertificateModal = false; 
                    state.showCertSaveMenu = false;
                    render(); 
                });
                const inspSheetPrintBtn = document.getElementById('inspSheetPrintBtn');
                if (inspSheetPrintBtn) inspSheetPrintBtn.addEventListener('click', () => {
                    alert('ğŸ’¡ ì¸ì‡„ ì„¤ì • ì•ˆë‚´\\n\\n1. ìš©ì§€: A4\\n2. ì–‘ë©´ ì¸ì‡„: ê¸´ ìª½ìœ¼ë¡œ ë„˜ê¹€\\n3. ì—¬ë°±: ì—†ìŒ ë˜ëŠ” ìµœì†Œ\\n\\ní”„ë¦°í„° ì„¤ì •ì—ì„œ "ì–‘ë©´ ì¸ì‡„"ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    window.print();
                });
                const inspSheetCloseBtn = document.getElementById('inspSheetCloseBtn');
                if (inspSheetCloseBtn) inspSheetCloseBtn.addEventListener('click', () => { state.showInspectionSheetModal = false; render(); });
                                const appSearchBtn = document.getElementById('appSearchBtn');
                if (appSearchBtn) appSearchBtn.addEventListener('click', () => { const searchInput = document.getElementById('appSearchInput'); if (searchInput) state.applicationSearchTerm = searchInput.value; state.currentApplicationPage = 1; render(); });
                const appSearchInput = document.getElementById('appSearchInput');
                if (appSearchInput) appSearchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { state.applicationSearchTerm = e.target.value; state.currentApplicationPage = 1; render(); } });
                const appRegionFilter = document.getElementById('appRegionFilter');
                if (appRegionFilter) appRegionFilter.addEventListener('change', (e) => { state.applicationFilters.region = e.target.value ? [e.target.value] : []; state.currentApplicationPage = 1; render(); });
                const appInspectorFilter = document.getElementById('appInspectorFilter');
                if (appInspectorFilter) appInspectorFilter.addEventListener('change', (e) => { state.applicationFilters.inspector = e.target.value; state.currentApplicationPage = 1; render(); });
                const appResultFilter = document.getElementById('appResultFilter');
                if (appResultFilter) appResultFilter.addEventListener('change', (e) => { state.applicationFilters.inspectionResult = e.target.value; state.currentApplicationPage = 1; render(); });
                const appReceiptFilter = document.getElementById('appReceiptFilter');
                if (appReceiptFilter) appReceiptFilter.addEventListener('change', (e) => { state.applicationFilters.receiptLocation = e.target.value; state.currentApplicationPage = 1; render(); });
                const appBaseMonthFilter = document.getElementById('appBaseMonthFilter');
                if (appBaseMonthFilter) appBaseMonthFilter.addEventListener('change', (e) => { state.applicationFilters.baseMonth = e.target.value; state.currentApplicationPage = 1; render(); });
                const appDateFrom = document.getElementById('appDateFrom');
                if (appDateFrom) appDateFrom.addEventListener('change', (e) => { state.applicationFilters.applicationDateFrom = e.target.value; state.currentApplicationPage = 1; render(); });
                const appDateTo = document.getElementById('appDateTo');
                if (appDateTo) appDateTo.addEventListener('change', (e) => { state.applicationFilters.applicationDateTo = e.target.value; state.currentApplicationPage = 1; render(); });
                const appInspDateFrom = document.getElementById('appInspDateFrom');
                if (appInspDateFrom) appInspDateFrom.addEventListener('change', (e) => { state.applicationFilters.inspectionDateFrom = e.target.value; state.currentApplicationPage = 1; render(); });
                const appInspDateTo = document.getElementById('appInspDateTo');
                if (appInspDateTo) appInspDateTo.addEventListener('change', (e) => { state.applicationFilters.inspectionDateTo = e.target.value; state.currentApplicationPage = 1; render(); });
                const appFeeFilter = document.getElementById('appFeeFilter');
                if (appFeeFilter) appFeeFilter.addEventListener('change', (e) => { state.applicationFilters.fee = e.target.value; state.currentApplicationPage = 1; render(); });
                const appFilterResetBtn = document.getElementById('appFilterResetBtn');
                if (appFilterResetBtn) appFilterResetBtn.addEventListener('click', () => { state.applicationFilters = { region: [], inspector: '', receiptLocation: '', inspectionResult: '', applicationDateFrom: '', applicationDateTo: '', inspectionDateFrom: '', inspectionDateTo: '', baseMonth: '', fee: '', facilityCert: '', certificateStatus: '', insuranceStatus: '' }; state.applicationSearchTerm = ''; state.currentApplicationPage = 1; render(); });
                const appPrevPageBtn = document.getElementById('appPrevPageBtn');
                if (appPrevPageBtn) appPrevPageBtn.addEventListener('click', () => { state.currentApplicationPage = Math.max(1, state.currentApplicationPage - 1); render(); });
                const appNextPageBtn = document.getElementById('appNextPageBtn');
                if (appNextPageBtn) appNextPageBtn.addEventListener('click', () => { const currentAppData = state.applicationData[state.targetYear] || []; const totalPages = Math.ceil(currentAppData.length / state.itemsPerPage); state.currentApplicationPage = Math.min(totalPages, state.currentApplicationPage + 1); render(); });

                // ëª¨ë‹¬ ë²„íŠ¼ë“¤
                const cancelDupBtn = document.getElementById('cancelDupBtn');
                if (cancelDupBtn) cancelDupBtn.addEventListener('click', () => { state.showDuplicateModal = false; render(); });
                const confirmDupBtn = document.getElementById('confirmDupBtn');
                if (confirmDupBtn) confirmDupBtn.addEventListener('click', confirmDuplicateCopy);
                const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
                if (cancelDeleteBtn) cancelDeleteBtn.addEventListener('click', () => { state.showDeleteModal = false; render(); });
                const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
                if (confirmDeleteBtn) confirmDeleteBtn.addEventListener('click', confirmDelete);
                const cancelAppDeleteBtn = document.getElementById('cancelAppDeleteBtn');
                if (cancelAppDeleteBtn) cancelAppDeleteBtn.addEventListener('click', () => { state.showAppDeleteModal = false; render(); });
                const confirmAppDeleteBtn = document.getElementById('confirmAppDeleteBtn');
                if (confirmAppDeleteBtn) confirmAppDeleteBtn.addEventListener('click', confirmAppDelete);
                const detailCancelBtn = document.getElementById('detailCancelBtn');
                if (detailCancelBtn) detailCancelBtn.addEventListener('click', closeDetailModal);
                const detailCloseBtn = document.getElementById('detailCloseBtn');
                if (detailCloseBtn) detailCloseBtn.addEventListener('click', closeDetailModal);
                const detailSaveBtn = document.getElementById('detailSaveBtn');
                if (detailSaveBtn) detailSaveBtn.addEventListener('click', saveFromDetailModal);
                const detailAddBtn = document.getElementById('detailAddBtn');
                if (detailAddBtn) detailAddBtn.addEventListener('click', () => { columns.forEach(col => { const input = document.getElementById(`detail-${col}`); if (input) state.detailModalData[col] = input.value; }); addFromDetailModal(); });
                const appDetailCancelBtn = document.getElementById('appDetailCancelBtn');
                if (appDetailCancelBtn) appDetailCancelBtn.addEventListener('click', closeAppDetailModal);
                const appDetailCloseBtn = document.getElementById('appDetailCloseBtn');
                if (appDetailCloseBtn) appDetailCloseBtn.addEventListener('click', closeAppDetailModal);
                const appDetailSaveBtn = document.getElementById('appDetailSaveBtn');
                if (appDetailSaveBtn) appDetailSaveBtn.addEventListener('click', saveFromAppDetailModal);
                const appDetailAddBtn = document.getElementById('appDetailAddBtn');
                if (appDetailAddBtn) appDetailAddBtn.addEventListener('click', addFromAppDetailModal);
                const mapCloseBtn = document.getElementById('mapCloseBtn');
                if (mapCloseBtn) mapCloseBtn.addEventListener('click', () => { state.showMapModal = false; state.mapData = []; state.isLoadingMap = false; render(); });
                const mapCancelBtn = document.getElementById('mapCancelBtn');
                if (mapCancelBtn) mapCancelBtn.addEventListener('click', () => { state.showMapModal = false; state.mapData = []; state.isLoadingMap = false; render(); });
                const mapPrintBtn = document.getElementById('mapPrintBtn');
                if (mapPrintBtn) mapPrintBtn.addEventListener('click', () => window.print());

                // ë¶„ê¸° íƒ­ ì´ë²¤íŠ¸
                const quarterTargetYearSelect = document.getElementById('quarterTargetYearSelect');
                if (quarterTargetYearSelect) quarterTargetYearSelect.addEventListener('change', (e) => { state.targetYear = parseInt(e.target.value); render(); });
                const quarterSelect = document.getElementById('quarterSelect');
                if (quarterSelect) quarterSelect.addEventListener('change', (e) => { state.quarter.selectedQuarter = e.target.value; render(); });
                const recipientSelect = document.getElementById('recipientSelect');
                if (recipientSelect) recipientSelect.addEventListener('change', (e) => { state.quarter.selectedRecipient = e.target.value; render(); });
                const quarterDownloadExcelBtn = document.getElementById('quarterDownloadExcelBtn');
                if (quarterDownloadExcelBtn) quarterDownloadExcelBtn.addEventListener('click', downloadQuarterExcel);
                const quarterDownloadCSVBtn = document.getElementById('quarterDownloadCSVBtn');
                if (quarterDownloadCSVBtn) quarterDownloadCSVBtn.addEventListener('click', downloadQuarterCSV);
                const quarterPrintBtn = document.getElementById('quarterPrintBtn');
                if (quarterPrintBtn) quarterPrintBtn.addEventListener('click', printQuarterReport);
                const quarterResetBtn = document.getElementById('quarterResetBtn');
                if (quarterResetBtn) quarterResetBtn.addEventListener('click', () => { state.quarter.selectedQuarter = ''; state.quarter.selectedRecipient = ''; render(); });
                const salesTargetYearSelect = document.getElementById('salesTargetYearSelect');
                if (salesTargetYearSelect) salesTargetYearSelect.addEventListener('change', (e) => { state.targetYear = parseInt(e.target.value); render(); });
                
                // ì·¨ì†Œ íƒ­ ì´ë²¤íŠ¸
                const cancelTargetYearSelect = document.getElementById('cancelTargetYearSelect');
                if (cancelTargetYearSelect) cancelTargetYearSelect.addEventListener('change', (e) => { state.targetYear = parseInt(e.target.value); render(); });
                const selectAllCancelRows = document.getElementById('selectAllCancelRows');
                if (selectAllCancelRows) selectAllCancelRows.addEventListener('change', (e) => { const currentData = state.cancellationData[state.targetYear] || []; if (e.target.checked) state.selectedCancellationRows = new Set(currentData.map((_, i) => i)); else state.selectedCancellationRows = new Set(); render(); });
                document.querySelectorAll('.cancel-row-checkbox').forEach(checkbox => { checkbox.addEventListener('change', (e) => { const idx = parseInt(e.target.dataset.idx); if (e.target.checked) state.selectedCancellationRows.add(idx); else state.selectedCancellationRows.delete(idx); }); });
                const cancelTabDeleteBtn = document.getElementById('cancelDeleteBtn');
                if (cancelTabDeleteBtn) cancelTabDeleteBtn.addEventListener('click', () => { if (state.selectedCancellationRows.size === 0) { alert('ì‚­ì œí•  í–‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; } if (confirm(state.selectedCancellationRows.size + 'ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { const currentData = state.cancellationData[state.targetYear] || []; state.cancellationData[state.targetYear] = currentData.filter((_, idx) => !state.selectedCancellationRows.has(idx)); state.selectedCancellationRows = new Set(); saveDataToStorage(); alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'); render(); } });


                
                // ê²½ë¡œë‹¹ íƒ­ ì´ë²¤íŠ¸
                const pathwayUploadBtn = document.getElementById('pathwayUploadBtn');
                if (pathwayUploadBtn) { const pathwayInput = document.createElement('input'); pathwayInput.type = 'file'; pathwayInput.accept = '.csv,.xlsx,.xls'; pathwayUploadBtn.addEventListener('click', () => pathwayInput.click()); pathwayInput.addEventListener('change', async (e) => { const file = e.target.files[0]; if (!file) return; try { state.isLoading = true; state.loadingProgress = 30; render(); const fileExt = file.name.split('.').pop().toLowerCase(); let parsedData; if (fileExt === 'xlsx' || fileExt === 'xls') parsedData = await parseExcelFile(file); else if (fileExt === 'csv') parsedData = await parseCSVFile(file); if (!state.pathwayData[state.selectedYear]) state.pathwayData[state.selectedYear] = []; state.pathwayData[state.selectedYear] = [...parsedData, ...state.pathwayData[state.selectedYear]]; state.isLoading = false; saveDataToStorage(); alert(`âœ… ${parsedData.length}ê°œì˜ ë°ì´í„°ê°€ ê²½ë¡œë‹¹ì— ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`); render(); } catch (error) { state.isLoading = false; alert('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜: ' + error.message); render(); } }); }
                const pathwayDownloadBtn = document.getElementById('pathwayDownloadBtn');
                if (pathwayDownloadBtn) pathwayDownloadBtn.addEventListener('click', () => { const dataToDownload = state.pathway.selectedRows.size > 0 ? (state.pathwayData[state.selectedYear] || []).filter((_, idx) => state.pathway.selectedRows.has(idx)) : (state.pathwayData[state.selectedYear] || []); if (dataToDownload.length === 0) { alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; } const worksheet = XLSX.utils.json_to_sheet(dataToDownload, { header: pathwayColumns }); const workbook = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(workbook, worksheet, 'ê²½ë¡œë‹¹'); XLSX.writeFile(workbook, `ê²½ë¡œë‹¹_${state.selectedYear}_${new Date().toISOString().split('T')[0]}.xlsx`); });
                const pathwayDeleteBtn = document.getElementById('pathwayDeleteBtn');
                if (pathwayDeleteBtn) pathwayDeleteBtn.addEventListener('click', () => { if (state.pathway.selectedRows.size === 0) { alert('ì‚­ì œí•  í–‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; } if (confirm(`${state.pathway.selectedRows.size}ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) { const currentData = state.pathwayData[state.selectedYear] || []; state.pathwayData[state.selectedYear] = currentData.filter((_, idx) => !state.pathway.selectedRows.has(idx)); state.pathway.selectedRows = new Set(); saveDataToStorage(); alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'); render(); } });
                const pathwaySaveBtn = document.getElementById('pathwaySaveBtn');
                if (pathwaySaveBtn) pathwaySaveBtn.addEventListener('click', () => { saveDataToStorage(); alert('ğŸ’¾ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.'); });
                const pathwayEditToggleBtn = document.getElementById('pathwayEditToggleBtn');
                if (pathwayEditToggleBtn) pathwayEditToggleBtn.addEventListener('click', () => { state.pathway.isEditing = !state.pathway.isEditing; render(); });
                const pathwayAddRowBtn = document.getElementById('pathwayAddRowBtn');
                if (pathwayAddRowBtn) pathwayAddRowBtn.addEventListener('click', () => { const newRow = {}; pathwayColumns.forEach(col => newRow[col] = ''); if (!state.pathwayData[state.selectedYear]) state.pathwayData[state.selectedYear] = []; state.pathwayData[state.selectedYear] = [newRow, ...state.pathwayData[state.selectedYear]]; saveDataToStorage(); render(); });
                const pathwayMapBtn = document.getElementById('pathwayMapBtn');
                if (pathwayMapBtn) pathwayMapBtn.addEventListener('click', () => { const selectedData = state.pathway.selectedRows.size > 0 ? (state.pathwayData[state.selectedYear] || []).filter((_, idx) => state.pathway.selectedRows.has(idx)) : []; if (selectedData.length === 0) { alert('ì§€ë„ì— í‘œì‹œí•  í–‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; } state.mapData = selectedData; state.showMapModal = true; state.isLoadingMap = true; state.mapLoadingProgress = 0; render(); setTimeout(() => initMap(selectedData), 100); });
                const pathwayRegionFilter = document.getElementById('pathwayRegionFilter');
                if (pathwayRegionFilter) pathwayRegionFilter.addEventListener('change', (e) => { state.pathway.filters.region = e.target.value; state.pathway.currentPage = 1; render(); });
                const pathwaySearchBtn = document.getElementById('pathwaySearchBtn');
                if (pathwaySearchBtn) pathwaySearchBtn.addEventListener('click', () => { const searchInput = document.getElementById('pathwaySearchInput'); if (searchInput) state.pathway.searchTerm = searchInput.value; state.pathway.currentPage = 1; render(); });
                const pathwaySearchInput = document.getElementById('pathwaySearchInput');
                if (pathwaySearchInput) pathwaySearchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { state.pathway.searchTerm = e.target.value; state.pathway.currentPage = 1; render(); } });
                const pathwayResetBtn = document.getElementById('pathwayResetBtn');
                if (pathwayResetBtn) pathwayResetBtn.addEventListener('click', () => { state.pathway.filters.region = ''; state.pathway.searchTerm = ''; state.pathway.currentPage = 1; render(); });
                const selectAllPathwayRows = document.getElementById('selectAllPathwayRows');
                if (selectAllPathwayRows) selectAllPathwayRows.addEventListener('change', (e) => { const currentData = state.pathwayData[state.selectedYear] || []; if (e.target.checked) state.pathway.selectedRows = new Set(currentData.map((_, i) => i)); else state.pathway.selectedRows = new Set(); render(); });
                document.querySelectorAll('.pathway-row-checkbox').forEach(checkbox => { checkbox.addEventListener('change', (e) => { const idx = parseInt(e.target.dataset.idx); if (e.target.checked) state.pathway.selectedRows.add(idx); else state.pathway.selectedRows.delete(idx); }); });
                document.querySelectorAll('.pathway-cell-edit').forEach(input => { input.addEventListener('change', (e) => { const idx = parseInt(e.target.dataset.idx); const col = e.target.dataset.col; if (!state.pathwayData[state.selectedYear]) state.pathwayData[state.selectedYear] = []; if (state.pathwayData[state.selectedYear][idx]) { state.pathwayData[state.selectedYear][idx][col] = e.target.value; saveDataToStorage(); } }); });
                const pathwayPrevPageBtn = document.getElementById('pathwayPrevPageBtn');
                if (pathwayPrevPageBtn) pathwayPrevPageBtn.addEventListener('click', () => { state.pathway.currentPage = Math.max(1, state.pathway.currentPage - 1); render(); });
                const pathwayNextPageBtn = document.getElementById('pathwayNextPageBtn');
                if (pathwayNextPageBtn) pathwayNextPageBtn.addEventListener('click', () => { const currentData = state.pathwayData[state.selectedYear] || []; const totalPages = Math.ceil(currentData.length / state.itemsPerPage); state.pathway.currentPage = Math.min(totalPages, state.pathway.currentPage + 1); render(); });

                // ìë£Œì‹¤ íƒ­ ì´ë²¤íŠ¸
                const resourceFileUpload = document.getElementById('resourceFileUpload');
                if (resourceFileUpload) { resourceFileUpload.addEventListener('change', async (e) => { const files = e.target.files; if (!files || files.length === 0) return; const formatFileSize = (bytes) => { if (bytes === 0) return '0 Bytes'; const k = 1024; const sizes = ['Bytes', 'KB', 'MB', 'GB']; const i = Math.floor(Math.log(bytes) / Math.log(k)); return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]; }; const getFileType = (fileName) => { const ext = fileName.split('.').pop().toLowerCase(); const typeMap = { 'pdf': 'PDF', 'xlsx': 'Excel', 'xls': 'Excel', 'hwp': 'í•œê¸€', 'doc': 'Word', 'docx': 'Word', 'ppt': 'PowerPoint', 'pptx': 'PowerPoint', 'jpg': 'ì´ë¯¸ì§€', 'jpeg': 'ì´ë¯¸ì§€', 'png': 'ì´ë¯¸ì§€', 'gif': 'ì´ë¯¸ì§€', 'zip': 'ì••ì¶•íŒŒì¼', 'rar': 'ì••ì¶•íŒŒì¼', 'csv': 'CSV' }; return typeMap[ext] || ext.toUpperCase(); }; if (!state.resourceData[state.selectedYear]) state.resourceData[state.selectedYear] = []; if (!state.resource.fileStorage[state.selectedYear]) state.resource.fileStorage[state.selectedYear] = {}; let uploadCount = 0; for (const file of files) { const fileId = 'file_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9); const reader = new FileReader(); reader.onload = function(event) { state.resource.fileStorage[state.selectedYear][fileId] = { name: file.name, type: file.type, data: event.target.result }; }; reader.readAsDataURL(file); const newRow = { 'í´ë”': '', 'íŒŒì¼ëª…': file.name, 'íŒŒì¼í˜•ì‹': getFileType(file.name), 'íŒŒì¼í¬ê¸°': formatFileSize(file.size), 'ì„¤ëª…': '', 'ë“±ë¡ì¼': new Date().toISOString().split('T')[0], 'ë“±ë¡ì': '', 'fileId': fileId }; state.resourceData[state.selectedYear] = [newRow, ...state.resourceData[state.selectedYear]]; uploadCount++; } saveDataToStorage(); alert(`âœ… ${uploadCount}ê°œì˜ íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`); e.target.value = ''; render(); }); }
                const resourceDownloadSelectedBtn = document.getElementById('resourceDownloadSelectedBtn');
                if (resourceDownloadSelectedBtn) resourceDownloadSelectedBtn.addEventListener('click', () => { if (state.resource.selectedFiles.size === 0) { alert('ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; } const currentData = state.resourceData[state.selectedYear] || []; const fileStorage = state.resource.fileStorage[state.selectedYear] || {}; state.resource.selectedFiles.forEach(idx => { const row = currentData[idx]; if (row && row.fileId && fileStorage[row.fileId]) { const fileInfo = fileStorage[row.fileId]; const link = document.createElement('a'); link.href = fileInfo.data; link.download = fileInfo.name; link.click(); } }); });
                document.querySelectorAll('.resource-download-btn').forEach(btn => { btn.addEventListener('click', (e) => { const idx = parseInt(e.target.dataset.idx); const currentData = state.resourceData[state.selectedYear] || []; const fileStorage = state.resource.fileStorage[state.selectedYear] || {}; const row = currentData[idx]; if (row && row.fileId && fileStorage[row.fileId]) { const fileInfo = fileStorage[row.fileId]; const link = document.createElement('a'); link.href = fileInfo.data; link.download = fileInfo.name; link.click(); } else { alert('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); } }); });
                const resourceDeleteBtn = document.getElementById('resourceDeleteBtn');
                if (resourceDeleteBtn) resourceDeleteBtn.addEventListener('click', () => { if (state.resource.selectedFiles.size === 0) { alert('ì‚­ì œí•  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; } if (confirm(`${state.resource.selectedFiles.size}ê°œ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) { const currentData = state.resourceData[state.selectedYear] || []; const fileStorage = state.resource.fileStorage[state.selectedYear] || {}; state.resource.selectedFiles.forEach(idx => { const row = currentData[idx]; if (row && row.fileId && fileStorage[row.fileId]) delete fileStorage[row.fileId]; }); state.resourceData[state.selectedYear] = currentData.filter((_, idx) => !state.resource.selectedFiles.has(idx)); state.resource.selectedFiles = new Set(); saveDataToStorage(); alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'); render(); } });
                const resourceExportListBtn = document.getElementById('resourceExportListBtn');
                if (resourceExportListBtn) resourceExportListBtn.addEventListener('click', () => { const currentData = state.resourceData[state.selectedYear] || []; if (currentData.length === 0) { alert('ë‚´ë³´ë‚¼ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.'); return; } const exportColumns = ['í´ë”', 'íŒŒì¼ëª…', 'íŒŒì¼í˜•ì‹', 'íŒŒì¼í¬ê¸°', 'ì„¤ëª…', 'ë“±ë¡ì¼', 'ë“±ë¡ì']; const worksheet = XLSX.utils.json_to_sheet(currentData.map(row => { const obj = {}; exportColumns.forEach(col => obj[col] = row[col] || ''); return obj; }), { header: exportColumns }); const workbook = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(workbook, worksheet, 'ìë£Œì‹¤ëª©ë¡'); XLSX.writeFile(workbook, `ìë£Œì‹¤ëª©ë¡_${state.selectedYear}_${new Date().toISOString().split('T')[0]}.xlsx`); });
                const resourceFolderFilter = document.getElementById('resourceFolderFilter');
                if (resourceFolderFilter) resourceFolderFilter.addEventListener('change', (e) => { state.resource.currentFolder = e.target.value; render(); });
                const resourceSearchBtn = document.getElementById('resourceSearchBtn');
                if (resourceSearchBtn) resourceSearchBtn.addEventListener('click', () => { const searchInput = document.getElementById('resourceSearchInput'); if (searchInput) state.resource.searchTerm = searchInput.value; render(); });
                const resourceSearchInput = document.getElementById('resourceSearchInput');
                if (resourceSearchInput) resourceSearchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { state.resource.searchTerm = e.target.value; render(); } });
                const resourceResetBtn = document.getElementById('resourceResetBtn');
                if (resourceResetBtn) resourceResetBtn.addEventListener('click', () => { state.resource.currentFolder = ''; state.resource.searchTerm = ''; render(); });
                const selectAllResourceRows = document.getElementById('selectAllResourceRows');
                if (selectAllResourceRows) selectAllResourceRows.addEventListener('change', (e) => { const currentData = state.resourceData[state.selectedYear] || []; if (e.target.checked) state.resource.selectedFiles = new Set(currentData.map((_, i) => i)); else state.resource.selectedFiles = new Set(); render(); });
                document.querySelectorAll('.resource-row-checkbox').forEach(checkbox => { checkbox.addEventListener('change', (e) => { const idx = parseInt(e.target.dataset.idx); if (e.target.checked) state.resource.selectedFiles.add(idx); else state.resource.selectedFiles.delete(idx); }); });
                document.querySelectorAll('.resource-cell-edit').forEach(input => { input.addEventListener('change', (e) => { const idx = parseInt(e.target.dataset.idx); const col = e.target.dataset.col; if (!state.resourceData[state.selectedYear]) state.resourceData[state.selectedYear] = []; if (state.resourceData[state.selectedYear][idx]) { state.resourceData[state.selectedYear][idx][col] = e.target.value; saveDataToStorage(); } }); });

            } catch (error) { console.error('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì²¨ë¶€ ì˜¤ë¥˜:', error); }
        }

        // ======================== ì´ˆê¸°í™” ========================
        window.addEventListener('load', async function() {
            try {
                const googleLoaded = await loadFromGoogleSheet();
                if (!googleLoaded) {
                    loadFromLocalStorage();
                }
                updateFilters();
                render();
            } catch (error) { 
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                loadFromLocalStorage();
                updateFilters();
                render();
            }
        });

        // ìë™ì €ì¥
        setInterval(() => {
            if (state.settings.autoSave && (Object.keys(state.data).length > 0 || Object.keys(state.applicationData).length > 0)) {
                saveDataToStorage();
            }
        }, state.settings.autoSaveInterval * 1000);
    </script>
</body>
</html>








